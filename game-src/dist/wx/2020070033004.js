var PLATFORM=0,DEBUG=!1,PUBLISH=!0,PROFILING=!1,ezasm=function(t){Math.clz32=Math.clz32||function(t){if(!(t>>>=0))return 32;for(var e=0,i=2147483648;!(t&i);)e++,i>>=1;return e},Math.imul=Math.imul||function(t,e){var i=65535&t,r=65535&e;return i*r+((t>>>16&65535)*r+i*(e>>>16&65535)<<16>>>0)};var e={},i=(console.log.bind(console),console.error.bind(console)),r=0,n=new ArrayBuffer(t),a=new Int8Array(n),o=new Uint8Array(n),s=new Int32Array(n);s[996]=8112,o.set([0,0,0,0,0,0,0,0,0,0,128,63,105,32,60,32,77,101,109,80,111,111,108,80,97,103,101,67,111,117,110,116,0,115,114,99,47,77,101,109,111,114,121,80,111,111,108,46,99,112,112,0,102,105,110,100,80,97,103,101,0,110,111,100,101,0,112,111,111,108,70,114,101,101,0,123,32,99,111,110,115,111,108,101,46,108,111,103,40,34,112,97,103,101,32,105,110,102,111,32,110,111,100,101,115,105,122,101,58,32,37,105,32,112,97,103,101,115,58,32,37,105,32,110,111,100,101,115,58,32,37,105,34,44,32,36,48,44,32,36,49,44,32,36,50,41,59,32,125,0,123,32,99,111,110,115,111,108,101,46,108,111,103,40,34,9,116,121,112,101,58,37,105,32,99,111,117,110,116,58,37,105,34,44,32,36,48,44,32,36,49,41,59,32,125,0,123,32,99,111,110,115,111,108,101,46,108,111,103,40,34,116,111,116,97,108,32,112,97,103,101,32,115,105,122,101,58,32,37,105,32,116,111,116,97,108,32,110,111,100,101,32,115,105,122,101,58,32,37,105,34,44,32,36,48,44,32,36,49,41,59,32,125,0,123,32,99,111,110,115,111,108,101,46,108,111,103,40,34,99,117,114,114,84,101,109,112,83,116,97,99,107,58,32,37,105,32,109,97,120,84,101,109,112,83,116,97,99,107,58,32,37,105,34,44,32,36,48,44,32,36,49,41,59,32,125,0,116,104,105,115,45,62,115,105,103,32,61,61,32,77,101,109,80,97,103,101,83,105,103,0,102,114,101,101,0,111,102,102,115,101,116,32,62,61,32,48,32,38,38,32,111,102,102,115,101,116,32,60,61,32,80,97,103,101,83,105,122,101,32,45,32,110,111,100,101,83,105,122,101,0,111,102,102,115,101,116,32,37,32,110,111,100,101,83,105,122,101,32,61,61,32,48,0,109,49,32,38,38,32,109,50,32,38,38,32,114,101,115,117,108,116,0,115,114,99,47,101,103,108,51,100,46,99,112,112,0,109,97,116,51,120,52,77,117,108,0,116,109,112,83,116,97,99,107,65,108,108,111,99,80,111,115,32,43,32,115,105,122,101,32,60,61,32,115,116,97,116,105,99,77,101,109,80,97,103,101,83,105,122,101,0,115,114,99,47,115,116,97,116,105,99,77,97,108,108,111,99,46,99,112,112,0,116,101,109,112,83,116,97,99,107,65,108,108,111,99,0,115,116,97,99,107,80,111,115,32,60,32,54,52,0,115,97,118,101,84,101,109,112,83,116,97,99,107,0,115,116,97,99,107,80,111,115,32,62,32,48,0,114,101,115,116,111,114,101,84,101,109,112,83,116,97,99,107,0,116,109,112,83,116,97,99,107,77,101,109,111,114,121,80,97,103,101,32,61,61,32,48,0,105,110,105,116,84,101,109,112,83,116,97,99,107,77,101,109,111,114,121,0,115,116,97,116,105,99,77,101,109,111,114,121,80,97,103,101,32,61,61,32,48,0,105,110,105,116,83,116,97,116,105,99,77,101,109,111,114,121,80,97,103,101,0,115,112,114,105,116,101,0,115,114,99,47,83,112,114,105,116,101,68,97,116,97,46,99,112,112,0,115,101,116,121,0,115,101,116,120,0,115,101,116,119,105,100,116,104,0,115,101,116,115,107,101,119,0,115,101,116,115,99,97,108,101,89,0,115,101,116,115,99,97,108,101,88,0,115,101,116,115,99,97,108,101,0,115,101,116,104,101,105,103,104,116,0,115,101,116,97,110,103,108,101,0,115,101,116,97,110,99,104,111,114,89,0,115,101,116,97,110,99,104,111,114,88,0,115,101,116,86,105,115,105,98,108,101,0,115,101,116,79,119,110,101,114,66,117,102,102,101,114,0,115,101,116,77,105,114,114,111,114,86,0,115,101,116,77,105,114,114,111,114,72,0,115,101,116,67,117,108,108,101,100,0,115,101,116,67,108,105,112,0,103,101,116,121,0,103,101,116,120,0,103,101,116,119,105,100,116,104,0,103,101,116,115,107,101,119,0,103,101,116,115,99,97,108,101,89,0,103,101,116,115,99,97,108,101,88,0,103,101,116,115,99,97,108,101,0,103,101,116,108,111,99,97,108,84,114,97,110,115,0,103,101,116,104,101,105,103,104,116,0,103,101,116,103,108,111,98,97,108,84,114,97,110,115,0,103,101,116,97,110,103,108,101,0,103,101,116,97,110,99,104,111,114,89,0,103,101,116,97,110,99,104,111,114,88,0,103,101,116,86,105,115,105,98,108,101,0,103,101,116,79,119,110,101,114,66,117,102,102,101,114,0,103,101,116,77,105,114,114,111,114,86,0,103,101,116,77,105,114,114,111,114,72,0,103,101,116,67,117,108,108,101,100,0,103,101,116,67,108,105,112,0,98,117,105,108,100,76,111,99,97,108,84,114,97,110,115,0,98,117,105,108,100,71,108,111,98,97,108,84,114,97,110,115],8);var h=[function(t,e,i){console.log("page info nodesize: %i pages: %i nodes: %i",t,e,i)},function(t,e){console.log("\ttype:%i count:%i",t,e)},function(t,e){console.log("total page size: %i total node size: %i",t,e)},function(t,e){console.log("currTempStack: %i maxTempStack: %i",t,e)}],l="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function c(t,e){return t?function(t,e,i){for(var r=e+i,n=e;t[n]&&!(n>=r);)++n;if(n-e>16&&t.subarray&&l)return l.decode(t.subarray(e,n));for(var a="";e<n;){var o=t[e++];if(128&o){var s=63&t[e++];if(192!=(224&o)){var h=63&t[e++];if((o=224==(240&o)?(15&o)<<12|s<<6|h:(7&o)<<18|s<<12|h<<6|63&t[e++])<65536)a+=String.fromCharCode(o);else{var c=o-65536;a+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else a+=String.fromCharCode((31&o)<<6|s)}else a+=String.fromCharCode(o)}return a}(o,t,e):""}function u(t){throw void 0!==t?(i(t),t=JSON.stringify(t)):t="","abort("+t+"). Build with -s ASSERTIONS=1 for more info."}var f=function(t,e,i){"use asm";var r=new t.Int8Array(i),n=new t.Int16Array(i),a=new t.Int32Array(i),o=new t.Uint8Array(i),s=new t.Uint16Array(i),h=new t.Float32Array(i),l=e.l|0,c=e.m|0,u=0,f=0,d=0,p=0,g=0,m=0,_=0,v=0.0,y=t.Math.abs,b=t.Math.sqrt,x=t.Math.cos,w=t.Math.sin,T=t.Math.acos,C=t.Math.imul,S=t.Math.clz32,A=e.a,P=e.b,k=e.c,M=e.d,I=e.e,E=e.f,B=e.g,R=e.h,O=e.i,D=e.j,L=e.k,z=4016,F=8112,H=0.0;function G(t){t=t|0;var e=0;e=z;z=z+t|0;z=z+15&-16;return e|0}function W(){return z|0}function j(t){t=t|0;z=t}function N(t,e){t=t|0;e=e|0;z=t;F=e}function V(t){t=t|0;var e=0,i=0,r=0,n=0,o=0,s=0,h=0,l=0;e=a[280]|0;do{if(e){if((a[e+8>>2]|0)==(t|0)){i=e;return i|0}r=a[281]|0;if(r){if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[282]|0;if(r){if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[283]|0;if(r){if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[284]|0;if(r){if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[285]|0;if(r){if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[286]|0;if(r){if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[287]|0;if(r){if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[288]|0;if(r){if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[289]|0;if(r){if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[290]|0;if(!r){n=1160;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[291]|0;if(!r){n=1164;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[292]|0;if(!r){n=1168;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[293]|0;if(!r){n=1172;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[294]|0;if(!r){n=1176;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[295]|0;if(!r){n=1180;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[296]|0;if(!r){n=1184;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[297]|0;if(!r){n=1188;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[298]|0;if(!r){n=1192;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[299]|0;if(!r){n=1196;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[300]|0;if(!r){n=1200;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[301]|0;if(!r){n=1204;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[302]|0;if(!r){n=1208;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[303]|0;if(!r){n=1212;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[304]|0;if(!r){n=1216;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[305]|0;if(!r){n=1220;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[306]|0;if(!r){n=1224;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[307]|0;if(!r){n=1228;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[308]|0;if(!r){n=1232;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[309]|0;if(!r){n=1236;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[310]|0;if(!r){n=1240;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}r=a[311]|0;if(!r){n=1244;break}if((a[r+8>>2]|0)==(t|0)){i=r;return i|0}else M(20,41,101,60)}else n=1156}else n=1152}else n=1148}else n=1144}else n=1140}else n=1136}else n=1132}else n=1128}else n=1124}else n=1120}while(0);e=(le(65539)|0)+15&-16;r=e;a[r+65520>>2]=-1103843725;a[r+8>>2]=t;a[r+4>>2]=0;o=r+16|0;a[e>>2]=o;e=65504-t|0;if((e|0)<(t|0))s=o;else{h=t;l=o;while(1){o=l+t|0;a[o+-4>>2]=0;a[l>>2]=o;h=h+t|0;if((h|0)>(e|0)){s=o;break}else l=o}}a[s>>2]=0;a[n>>2]=r;i=r;return i|0}function U(t,e){t=t|0;e=e|0;var i=0,r=0,n=0,o=0,s=0,h=0,l=0,c=0,u=0,f=0,d=0,p=0,g=0,m=0;i=t+11&-8;t=V(i)|0;r=a[t>>2]|0;t:do{if(!r){n=65504-i|0;if((n|0)<(i|0)){o=t;while(1){s=o+4|0;h=a[s>>2]|0;if(!h){l=(le(65539)|0)+15&-16;c=l;a[c+65520>>2]=-1103843725;a[c+8>>2]=i;a[c+4>>2]=0;u=c+16|0;a[l>>2]=u;a[u>>2]=0;a[s>>2]=c;f=c}else f=h;h=a[f>>2]|0;if(!h)o=f;else{d=f;p=h;break t}}}o=t;while(1){h=o+4|0;c=a[h>>2]|0;if(!c){s=(le(65539)|0)+15&-16;u=s;a[u+65520>>2]=-1103843725;a[u+8>>2]=i;a[u+4>>2]=0;l=u+16|0;a[s>>2]=l;s=i;g=l;do{l=g;g=g+i|0;a[g+-4>>2]=0;a[l>>2]=g;s=s+i|0}while((s|0)<=(n|0));a[g>>2]=0;a[h>>2]=u;m=u}else m=c;s=a[m>>2]|0;if(!s)o=m;else{d=m;p=s;break}}}else{d=t;p=r}}while(0);a[d>>2]=a[p>>2];r=p+-4|0;a[r>>2]=d;if(!e)return p|0;a[r>>2]=e&15|d;return p|0}function X(t){t=t|0;var e=0,i=0,r=0,n=0,o=0,s=0,h=0,l=0,c=0,u=0,f=0,d=0,p=0,g=0,m=0;if((t|0)>256){e=le(t+4|0)|0;a[e>>2]=0;i=e+4|0;return i|0}e=t+11&-8;t=V(e)|0;r=a[t>>2]|0;t:do{if(!r){n=65504-e|0;if((n|0)<(e|0)){o=t;while(1){s=o+4|0;h=a[s>>2]|0;if(!h){l=(le(65539)|0)+15&-16;c=l;a[c+65520>>2]=-1103843725;a[c+8>>2]=e;a[c+4>>2]=0;u=c+16|0;a[l>>2]=u;a[u>>2]=0;a[s>>2]=c;f=c}else f=h;h=a[f>>2]|0;if(!h)o=f;else{d=f;p=h;break t}}}o=t;while(1){h=o+4|0;c=a[h>>2]|0;if(!c){s=(le(65539)|0)+15&-16;u=s;a[u+65520>>2]=-1103843725;a[u+8>>2]=e;a[u+4>>2]=0;l=u+16|0;a[s>>2]=l;s=e;g=l;do{l=g;g=g+e|0;a[g+-4>>2]=0;a[l>>2]=g;s=s+e|0}while((s|0)<=(n|0));a[g>>2]=0;a[h>>2]=u;m=u}else m=c;s=a[m>>2]|0;if(!s)o=m;else{d=m;p=s;break}}}else{d=t;p=r}}while(0);a[d>>2]=a[p>>2];a[p+-4>>2]=d;i=p;return i|0}function J(t){t=t|0;var e=0,i=0,r=0,n=0,o=0;if(!t)M(69,41,150,74);e=t+-4|0;i=a[e>>2]|0;if(!i){de(e);return}r=i&-16;i=r;n=t-(i+16)|0;if((a[i+65520>>2]|0)!=-1103843725)M(335,41,44,359);if((n|0)<=-1)M(364,41,45,359);o=a[i+8>>2]|0;if((n|0)>(65504-o|0))M(364,41,45,359);if((n|0)%(o|0)|0|0)M(409,41,46,359);a[e>>2]=0;a[t>>2]=a[r>>2];a[r>>2]=t;return}function K(){var t=0,e=0,i=0,r=0,n=0,o=0,s=0,h=0,l=0,c=0,u=0,f=0,d=0,p=0,g=0,m=0,_=0,v=0,y=0,b=0,x=0,w=0,T=0,S=0,A=0,P=0,k=0,M=0,I=0,R=0,O=0,D=0,L=0,F=0,H=0,G=0,W=0,j=0,N=0,V=0,U=0,X=0,J=0,K=0;t=z;z=z+64|0;e=t;i=e+4|0;r=e+8|0;n=e+12|0;o=e+16|0;s=e+20|0;h=e+24|0;l=e+28|0;c=e+32|0;u=e+36|0;f=e+40|0;d=e+44|0;p=e+48|0;g=e+52|0;m=e+56|0;_=e+60|0;v=0;y=0;b=0;while(1){x=a[1120+(v<<2)>>2]|0;if(!x){w=y;T=b;S=25;break}A=e;P=A+64|0;do{a[A>>2]=0;A=A+4|0}while((A|0)<(P|0));A=a[x+8>>2]|0;P=65504/(A|0)|0;if((P|0)>0){k=A>>2;M=0;I=x+12|0;while(1){R=a[I>>2]|0;O=e+((R&15)<<2)|0;if(R|0)a[O>>2]=(a[O>>2]|0)+1;M=M+1|0;if((M|0)==(P|0))break;else I=I+(k<<2)|0}}k=a[x>>2]|0;if(!k)D=0;else{I=k;k=0;while(1){M=k+1|0;I=a[I>>2]|0;if(!I){D=M;break}else k=M}}k=P-D|0;I=b+65524|0;M=a[x+4>>2]|0;if(!M){L=1;F=k;H=I;G=A}else{O=1;R=k;k=I;I=M;while(1){M=O+1|0;W=a[I+8>>2]|0;j=65504/(W|0)|0;if((j|0)>0){N=W>>2;V=0;U=I+12|0;while(1){X=a[U>>2]|0;J=e+((X&15)<<2)|0;if(X|0)a[J>>2]=(a[J>>2]|0)+1;V=V+1|0;if((V|0)==(j|0))break;else U=U+(N<<2)|0}}N=a[I>>2]|0;if(!N)K=0;else{U=N;N=0;while(1){V=N+1|0;U=a[U>>2]|0;if(!U){K=V;break}else N=V}}N=j+R-K|0;U=k+65524|0;I=a[I+4>>2]|0;if(!I){L=M;F=N;H=U;G=W;break}else{O=M;R=N;k=U}}}k=C(G,F)|0;B(0,G|0,L|0,F|0)|0;R=a[e>>2]|0;if(R|0)E(1,0,R|0)|0;R=a[i>>2]|0;if(R|0)E(1,1,R|0)|0;R=a[r>>2]|0;if(R|0)E(1,2,R|0)|0;R=a[n>>2]|0;if(R|0)E(1,3,R|0)|0;R=a[o>>2]|0;if(R|0)E(1,4,R|0)|0;R=a[s>>2]|0;if(R|0)E(1,5,R|0)|0;R=a[h>>2]|0;if(R|0)E(1,6,R|0)|0;R=a[l>>2]|0;if(R|0)E(1,7,R|0)|0;R=a[c>>2]|0;if(R|0)E(1,8,R|0)|0;R=a[u>>2]|0;if(R|0)E(1,9,R|0)|0;R=a[f>>2]|0;if(R|0)E(1,10,R|0)|0;R=a[d>>2]|0;if(R|0)E(1,11,R|0)|0;R=a[p>>2]|0;if(R|0)E(1,12,R|0)|0;R=a[g>>2]|0;if(R|0)E(1,13,R|0)|0;R=a[m>>2]|0;if(R|0)E(1,14,R|0)|0;R=a[_>>2]|0;if(R|0)E(1,15,R|0)|0;R=k+y|0;v=v+1|0;if(v>>>0>=32){w=R;T=H;S=25;break}else{y=R;b=H}}if((S|0)==25){E(2,T|0,w|0)|0;E(3,a[934]|0,a[935]|0)|0;z=t;return}}function Y(t,e,i,r){t=t|0;e=+e;i=+i;r=+r;return}function Q(t,e,i,r,n){t=+t;e=+e;i=+i;r=+r;n=n|0;var a=0.0,o=0.0,s=0.0,l=0.0,c=0.0,u=0.0,f=0.0;a=t+t;o=e+e;s=i+i;l=a*t;c=o*t;u=s*t;t=o*e;f=s*e;e=s*i;i=a*r;a=o*r;o=s*r;h[n>>2]=1.0-(t+e);h[n+4>>2]=c-o;h[n+8>>2]=u+a;h[n+12>>2]=0.0;h[n+16>>2]=c+o;h[n+20>>2]=1.0-(l+e);h[n+24>>2]=f-i;h[n+28>>2]=0.0;h[n+32>>2]=u-a;h[n+36>>2]=f+i;h[n+40>>2]=1.0-(l+t);h[n+44>>2]=0.0;return}function q(){var t=0,e=0,i=0;t=X(48)|0;e=t+4|0;i=e+44|0;do{a[e>>2]=0;e=e+4|0}while((e|0)<(i|0));h[t+40>>2]=1.0;h[t+20>>2]=1.0;h[t>>2]=1.0;return t|0}function Z(t,e,i){t=t|0;e=e|0;i=i|0;var r=0.0,n=0.0,a=0.0,o=0,s=0,l=0,c=0,u=0,f=0,d=0,p=0;if((t|0)!=0&(e|0)!=0&(i|0)!=0){r=+h[t>>2];n=+h[t+16>>2];a=+h[t+32>>2];o=e+4|0;s=e+8|0;h[i>>2]=r*+h[e>>2]+n*+h[o>>2]+a*+h[s>>2];l=e+16|0;c=e+20|0;u=e+24|0;h[i+16>>2]=r*+h[l>>2]+n*+h[c>>2]+a*+h[u>>2];f=e+32|0;d=e+36|0;p=e+40|0;h[i+32>>2]=r*+h[f>>2]+n*+h[d>>2]+a*+h[p>>2];a=+h[t+4>>2];n=+h[t+20>>2];r=+h[t+36>>2];h[i+4>>2]=a*+h[e>>2]+n*+h[o>>2]+r*+h[s>>2];h[i+20>>2]=a*+h[l>>2]+n*+h[c>>2]+r*+h[u>>2];h[i+36>>2]=a*+h[f>>2]+n*+h[d>>2]+r*+h[p>>2];r=+h[t+8>>2];n=+h[t+24>>2];a=+h[t+40>>2];h[i+8>>2]=r*+h[e>>2]+n*+h[o>>2]+a*+h[s>>2];h[i+24>>2]=r*+h[l>>2]+n*+h[c>>2]+a*+h[u>>2];h[i+40>>2]=r*+h[f>>2]+n*+h[d>>2]+a*+h[p>>2];a=+h[t+12>>2];n=+h[t+28>>2];r=+h[t+44>>2];h[i+12>>2]=+h[e+12>>2]+(a*+h[e>>2]+n*+h[o>>2]+r*+h[s>>2]);h[i+28>>2]=+h[e+28>>2]+(a*+h[l>>2]+n*+h[c>>2]+r*+h[u>>2]);h[i+44>>2]=+h[e+44>>2]+(a*+h[f>>2]+n*+h[d>>2]+r*+h[p>>2]);return}else M(432,451,21,465)}function $(t,e,i,r,n,a,o){t=+t;e=+e;i=+i;r=+r;n=+n;a=+a;o=o|0;var s=0;h[o>>2]=+h[o>>2]*t;s=o+16|0;h[s>>2]=+h[s>>2]*t;s=o+32|0;h[s>>2]=+h[s>>2]*t;s=o+4|0;h[s>>2]=+h[s>>2]*e;s=o+20|0;h[s>>2]=+h[s>>2]*e;s=o+36|0;h[s>>2]=+h[s>>2]*e;s=o+8|0;h[s>>2]=+h[s>>2]*i;s=o+24|0;h[s>>2]=+h[s>>2]*i;s=o+40|0;h[s>>2]=+h[s>>2]*i;h[o+12>>2]=r;h[o+28>>2]=n;h[o+44>>2]=a;return}function tt(t,e,i,r){t=t|0;e=e|0;i=+i;r=r|0;var n=0.0,a=0.0,o=0.0,s=0.0,l=0.0,c=0.0,u=0.0,f=0.0,d=0.0,p=0.0,g=0.0,m=0.0,_=0.0,v=0.0,y=0.0,b=0.0;n=+h[t>>2];a=+h[t+4>>2];o=+h[t+8>>2];s=+h[t+12>>2];l=+h[e>>2];c=+h[e+4>>2];u=+h[e+8>>2];f=+h[e+12>>2];d=n*l+a*c+o*u+s*f;if(d<0.0){p=-l;g=-d;m=-c;_=-f;v=-u}else{p=l;g=d;m=c;_=f;v=u}if(1.0-g>1.0e-06){u=+T(+g);g=1.0/+w(+u);y=+w(+(u*i))*g;b=+w(+((1.0-i)*u))*g}else{y=i;b=1.0-i}h[r>>2]=n*b+p*y;h[r+4>>2]=a*b+m*y;h[r+8>>2]=o*b+v*y;h[r+12>>2]=s*b+_*y;return}function et(t){t=t|0;if(!(a[930]|0)){a[930]=le(t)|0;a[932]=t;return}else M(658,520,11,680)}function it(t){t=t|0;if(!(a[933]|0)){a[933]=le(t)|0;me(1248,0,256)|0;return}else M(614,520,40,638)}function rt(){var t=0,e=0;t=a[936]|0;if((t|0)>0){e=t+-1|0;a[936]=e;a[934]=a[1248+(e<<2)>>2];return}else M(584,520,55,597)}function nt(){var t=0,e=0;t=a[936]|0;if((t|0)<64){e=a[934]|0;a[936]=t+1;a[1248+(t<<2)>>2]=e;return}else M(556,520,49,570)}function at(t){t=t|0;var e=0,i=0,r=0,n=0,o=0,s=0,h=0;e=a[932]|0;if((e|0)<(t|0)){i=le(t)|0;return i|0}r=a[931]|0;n=(a[930]|0)+r|0;if((r+t|0)>(e|0)){o=le(e)|0;a[930]=o;a[931]=0;s=o;h=0}else{s=n;h=r}a[931]=h+t;i=s;return i|0}function ot(t){t=t|0;var e=0,i=0;e=a[934]|0;i=e+t|0;if((i|0)>(a[932]|0))M(475,520,70,541);t=(a[933]|0)+e|0;a[934]=i;if((i|0)<=(a[935]|0))return t|0;a[935]=i;return t|0}function st(t,e){t=t|0;e=e|0;if(!t)M(701,708,160,1098);else{se(t+48|0,e,t+72|0);e=t+44|0;n[e>>1]=n[e>>1]|8;return}}function ht(t,e){t=t|0;e=e|0;var i=0.0,r=0.0,a=0.0,o=0,s=0,l=0,c=0.0,u=0.0,f=0.0,d=0.0,p=0.0,g=0.0,m=0.0,_=0.0,v=0.0,b=0.0,T=0.0,C=0,S=0,A=0,P=0,k=0,I=0,E=0;if(!t)M(701,708,208,1082);i=+h[t+16>>2];r=+h[t+8>>2]*i;a=i*+h[t+12>>2];o=t+44|0;s=n[o>>1]|0;l=s&65535;i=(l&1|0)==0?r:-r;r=(l&2|0)==0?a:-a;l=t+48|0;a=+h[t+32>>2]*i;c=+h[t+28>>2];if(+y(+c)>.001){u=c*.017453292519943295;c=+x(+u);f=+w(+u);u=i*c+a*f;h[l>>2]=u;d=c*0.0+r*f;h[t+52>>2]=d;p=a*c-i*f;g=r*c-f*0.0;f=+h[t+20>>2]*+h[t+36>>2];c=+h[t+24>>2]*+h[t+40>>2];m=+h[t>>2]-u*f-p*c;_=g;v=p;b=+h[t+4>>2]-d*f;T=g*c}else{h[l>>2]=i;h[t+52>>2]=0.0;c=+h[t+20>>2]*+h[t+36>>2];g=+h[t+24>>2]*+h[t+40>>2];m=+h[t>>2]-i*c-a*g;_=r;v=a;b=+h[t+4>>2]-c*0.0;T=r*g}h[t+56>>2]=v;h[t+60>>2]=_;h[t+64>>2]=m;h[t+68>>2]=b-T;if(!e){C=s;S=t+46|0;A=n[S>>1]|0;P=A+1<<16>>16;n[S>>1]=P;k=C&-13;I=k|4;n[o>>1]=I;E=P&65535;return E|0}ae(l,e);C=n[o>>1]|0;S=t+46|0;A=n[S>>1]|0;P=A+1<<16>>16;n[S>>1]=P;k=C&-13;I=k|4;n[o>>1]=I;E=P&65535;return E|0}function lt(t){t=t|0;var e=0,i=0,r=0,n=0,o=0,s=0,l=0,c=0,u=0,f=0.0,d=0.0,p=0.0,g=0.0,m=0.0,_=0.0;e=z;z=z+32|0;i=e;h[i>>2]=0.0;r=i+4|0;h[r>>2]=0.0;n=a[t+36>>2]|0;a[i+8>>2]=n;o=i+12|0;h[o>>2]=0.0;s=i+16|0;h[s>>2]=0.0;l=i+20|0;c=a[t+40>>2]|0;a[l>>2]=c;u=i+24|0;a[u>>2]=n;n=i+28|0;a[n>>2]=c;c=t+72|0;he(i,c);t=i+8|0;he(t,c);he(s,c);he(u,c);f=+h[i>>2];d=+h[r>>2];p=+h[t>>2];g=f<p?f:p;m=f>p?f:p;p=+h[o>>2];f=d<p?d:p;_=d>p?d:p;p=+h[s>>2];d=g<p?g:p;g=m>p?m:p;p=+h[l>>2];m=f<p?f:p;f=_>p?_:p;p=+h[u>>2];_=+h[n>>2];h[376]=d<p?d:p;h[377]=m<_?m:_;h[378]=g>p?g:p;h[379]=f>_?f:_;z=e;return 1504}function ct(t,e,i,r,n){t=t|0;e=+e;i=+i;r=+r;n=+n;var o=0,s=0,l=0,c=0,u=0,f=0,d=0,p=0,g=0,m=0.0,_=0.0,v=0.0,y=0.0,b=0.0,x=0.0;o=z;z=z+32|0;s=o;h[s>>2]=0.0;l=s+4|0;h[l>>2]=0.0;c=a[t+36>>2]|0;a[s+8>>2]=c;u=s+12|0;h[u>>2]=0.0;f=s+16|0;h[f>>2]=0.0;d=s+20|0;p=a[t+40>>2]|0;a[d>>2]=p;g=s+24|0;a[g>>2]=c;c=s+28|0;a[c>>2]=p;p=t+72|0;he(s,p);t=s+8|0;he(t,p);he(f,p);he(g,p);m=+h[s>>2];_=+h[l>>2];v=+h[t>>2];y=m<v?m:v;b=m>v?m:v;v=+h[u>>2];m=_<v?_:v;x=_>v?_:v;v=+h[f>>2];_=y<v?y:v;y=b>v?b:v;v=+h[d>>2];b=m<v?m:v;m=x>v?x:v;v=+h[g>>2];x=+h[c>>2];z=o;return(m>x?m:x)<=i|((_<v?_:v)>=r?0:!((y>v?y:v)<=e))&!((b<x?b:x)>=n)^1|0}function ut(t){t=t|0;if(!t)M(701,708,117,1074);else return(n[t+44>>1]&128)!=0|0;return 0}function ft(t){t=t|0;if(!t)M(701,708,109,1064);else return(n[t+44>>1]&32)!=0|0;return 0}function dt(t){t=t|0;if(!t)M(701,708,111,1053);else return(n[t+44>>1]&1)!=0|0;return 0}function pt(t){t=t|0;if(!t)M(701,708,113,1042);else return(n[t+44>>1]&2)!=0|0;return 0}function gt(t){t=t|0;if(!t)M(701,708,115,1027);else return(n[t+44>>1]&64)!=0|0;return 0}function mt(t){t=t|0;if(!t)M(701,708,108,1016);else return(n[t+44>>1]&16)!=0|0;return 0}function _t(t){t=t|0;if(!t)M(701,708,103,1005);else return+ +h[t+20>>2];return+0}function vt(t){t=t|0;if(!t)M(701,708,104,994);else return+ +h[t+24>>2];return+0}function yt(t){t=t|0;if(!t)M(701,708,105,985);else return+ +h[t+28>>2];return+0}function bt(t){t=t|0;if(!t)M(701,708,153,970);else return((n[t+44>>1]&8)==0?0:t+72|0)|0;return 0}function xt(t){t=t|0;if(!t)M(701,708,101,960);else return+ +h[t+40>>2];return+0}function wt(t){t=t|0;if(!t)M(701,708,146,946);else return((n[t+44>>1]&4)==0?0:t+48|0)|0;return 0}function Tt(t){t=t|0;if(!t)M(701,708,102,937);else return+ +h[t+16>>2];return+0}function Ct(t){t=t|0;if(!t)M(701,708,98,927);else return+ +h[t+8>>2];return+0}function St(t){t=t|0;if(!t)M(701,708,99,917);else return+ +h[t+12>>2];return+0}function At(t){t=t|0;if(!t)M(701,708,106,909);else return+ +h[t+32>>2];return+0}function Pt(t){t=t|0;if(!t)M(701,708,100,900);else return+ +h[t+36>>2];return+0}function kt(t){t=t|0;if(!t)M(701,708,96,895);else return+ +h[t>>2];return+0}function Mt(t){t=t|0;if(!t)M(701,708,97,890);else return+ +h[t+4>>2];return+0}function It(){var t=0,e=0,i=0;t=X(96)|0;e=t;i=e+96|0;do{a[e>>2]=0;e=e+4|0}while((e|0)<(i|0));h[t+8>>2]=1.0;h[t+12>>2]=1.0;h[t+16>>2]=1.0;h[t+84>>2]=1.0;h[t+72>>2]=1.0;h[t+60>>2]=1.0;h[t+48>>2]=1.0;n[t+44>>1]=16;return t|0}function Et(t,e){t=t|0;e=e|0;var i=0;if(!t)M(701,708,118,882);else{i=t+44|0;t=s[i>>1]|0;n[i>>1]=e?t|128:t&65407;return}}function Bt(t,e){t=t|0;e=e|0;var i=0;if(!t)M(701,708,110,872);else{i=t+44|0;t=s[i>>1]|0;n[i>>1]=e?t|32:t&65503;return}}function Rt(t,e){t=t|0;e=e|0;var i=0,r=0,a=0;if(!t)M(701,708,112,861);i=t+44|0;t=n[i>>1]|0;r=t&65535;if(!((t&1)!=0^e)){a=0;return a|0}n[i>>1]=(e?r|1:r&65522)&65523;a=1;return a|0}function Ot(t,e){t=t|0;e=e|0;var i=0,r=0,a=0;if(!t)M(701,708,114,850);i=t+44|0;t=n[i>>1]|0;r=t&65535;if(!((t&2)!=0^e)){a=0;return a|0}n[i>>1]=(e?r|2:r&65521)&65523;a=1;return a|0}function Dt(t,e){t=t|0;e=e|0;var i=0;if(!t)M(701,708,116,835);else{i=t+44|0;t=s[i>>1]|0;n[i>>1]=e?t|64:t&65471;return}}function Lt(t,e){t=t|0;e=e|0;var i=0;if(!t)M(701,708,121,824);else{i=t+44|0;t=s[i>>1]|0;n[i>>1]=e?t|16:t&65511;return}}function zt(t,e){t=t|0;e=+e;var i=0,r=0;if(!t)M(701,708,103,813);i=t+20|0;if(!(+y(+(+h[i>>2]-e))>.0001)){r=0;return r|0}h[i>>2]=e;i=t+44|0;n[i>>1]=n[i>>1]&-13;r=1;return r|0}function Ft(t,e){t=t|0;e=+e;var i=0,r=0;if(!t)M(701,708,104,802);i=t+24|0;if(!(+y(+(+h[i>>2]-e))>.0001)){r=0;return r|0}h[i>>2]=e;i=t+44|0;n[i>>1]=n[i>>1]&-13;r=1;return r|0}function Ht(t,e){t=t|0;e=+e;var i=0,r=0;if(!t)M(701,708,105,793);i=t+28|0;if(!(+y(+(+h[i>>2]-e))>.0001)){r=0;return r|0}h[i>>2]=e;i=t+44|0;n[i>>1]=n[i>>1]&-13;r=1;return r|0}function Gt(t,e){t=t|0;e=+e;var i=0,r=0;if(!t)M(701,708,101,783);i=t+40|0;if(!(+y(+(+h[i>>2]-e))>.0001)){r=0;return r|0}h[i>>2]=e;i=t+44|0;n[i>>1]=n[i>>1]&-13;r=1;return r|0}function Wt(t,e){t=t|0;e=+e;var i=0,r=0;if(!t)M(701,708,102,774);i=t+16|0;if(!(+y(+(+h[i>>2]-e))>.0001)){r=0;return r|0}h[i>>2]=e;i=t+44|0;n[i>>1]=n[i>>1]&-13;r=1;return r|0}function jt(t,e){t=t|0;e=+e;var i=0,r=0;if(!t)M(701,708,98,764);i=t+8|0;if(!(+y(+(+h[i>>2]-e))>.0001)){r=0;return r|0}h[i>>2]=e;i=t+44|0;n[i>>1]=n[i>>1]&-13;r=1;return r|0}function Nt(t,e){t=t|0;e=+e;var i=0,r=0;if(!t)M(701,708,99,754);i=t+12|0;if(!(+y(+(+h[i>>2]-e))>.0001)){r=0;return r|0}h[i>>2]=e;i=t+44|0;n[i>>1]=n[i>>1]&-13;r=1;return r|0}function Vt(t,e){t=t|0;e=+e;var i=0,r=0;if(!t)M(701,708,106,746);i=t+32|0;if(!(+y(+(+h[i>>2]-e))>.0001)){r=0;return r|0}h[i>>2]=e;i=t+44|0;n[i>>1]=n[i>>1]&-13;r=1;return r|0}function Ut(t,e){t=t|0;e=+e;var i=0,r=0;if(!t)M(701,708,100,737);i=t+36|0;if(!(+y(+(+h[i>>2]-e))>.0001)){r=0;return r|0}h[i>>2]=e;i=t+44|0;n[i>>1]=n[i>>1]&-13;r=1;return r|0}function Xt(t,e){t=t|0;e=+e;var i=0,r=0;if(!t)M(701,708,96,732);if(!(+y(+(+h[t>>2]-e))>.0001)){i=0;return i|0}h[t>>2]=e;r=t+44|0;n[r>>1]=n[r>>1]&-13;i=1;return i|0}function Jt(t,e){t=t|0;e=+e;var i=0,r=0;if(!t)M(701,708,97,727);i=t+4|0;if(!(+y(+(+h[i>>2]-e))>.0001)){r=0;return r|0}h[i>>2]=e;i=t+44|0;n[i>>1]=n[i>>1]&-13;r=1;return r|0}function Kt(t,e){t=t|0;e=e|0;var i=0,n=0.0,o=0.0,s=0.0,l=0.0,c=0.0,u=0.0,f=0.0,d=0.0,p=0.0,g=0.0,m=0.0,_=0.0;i=t<<4;n=+h[380];if(!(r[3776]|0)){o=+h[937];h[1584+(i<<2)>>2]=n*o;s=+h[938];h[1584+((i|1)<<2)>>2]=+h[381]*s;h[1584+((i|2)<<2)>>2]=o*+h[382];h[1584+((i|3)<<2)>>2]=s*+h[383];h[1584+((i|4)<<2)>>2]=o*+h[384];h[1584+((i|5)<<2)>>2]=s*+h[385]}else{s=+h[908];o=+h[381];l=+h[928];c=+h[912];u=+h[916];f=+h[382];d=+h[383];p=+h[384];g=+h[385];m=+h[920]+(s*p+l*g);_=c*p+u*g+ +h[924];g=+h[937];h[1584+(i<<2)>>2]=(n*s+o*l)*g;p=+h[938];h[1584+((i|1)<<2)>>2]=(n*c+o*u)*p;h[1584+((i|2)<<2)>>2]=(s*f+l*d)*g;h[1584+((i|3)<<2)>>2]=(c*f+u*d)*p;h[1584+((i|4)<<2)>>2]=m*g;h[1584+((i|5)<<2)>>2]=_*p}if(e&1|0){a[1584+((i|8)<<2)>>2]=a[388];a[1584+((i|9)<<2)>>2]=a[389];a[1584+((i|10)<<2)>>2]=a[390];a[1584+((i|11)<<2)>>2]=a[391];a[1584+((i|6)<<2)>>2]=a[392];a[1584+((i|7)<<2)>>2]=a[393]}if(!(e&2)){e=a[4]|0;a[1584+((i|15)<<2)>>2]=e;a[1584+((i|14)<<2)>>2]=e;a[1584+((i|13)<<2)>>2]=e;a[1584+((i|12)<<2)>>2]=e;return}else{p=+h[4];h[1584+((i|12)<<2)>>2]=+h[941]*p;h[1584+((i|13)<<2)>>2]=p*+h[942];h[1584+((i|14)<<2)>>2]=p*+h[943];h[1584+((i|15)<<2)>>2]=p;return}}function Yt(){return 1584}function Qt(t,e,i){t=+t;e=+e;i=i|0;if(!i){h[380]=t;h[381]=0.0;h[382]=0.0;h[383]=e;h[384]=0.0;h[385]=0.0;return}else{h[380]=+h[i>>2]*t;h[381]=+h[i+4>>2]*t;h[382]=+h[i+8>>2]*e;h[383]=+h[i+12>>2]*e;a[384]=a[i+16>>2];a[385]=a[i+20>>2];return}}function qt(t,e,i,r,n){t=+t;e=+e;i=+i;r=+r;n=n|0;var a=0.0,o=0,s=0,l=0;if(!n){h[380]=t;h[381]=0.0;h[382]=0.0;h[383]=e;h[384]=i;a=r;h[385]=a;return}else{h[380]=+h[n>>2]*t;o=n+4|0;h[381]=+h[o>>2]*t;s=n+8|0;h[382]=+h[s>>2]*e;l=n+12|0;h[383]=+h[l>>2]*e;h[384]=+h[n+16>>2]+(+h[n>>2]*i+ +h[s>>2]*r);a=+h[n+20>>2]+(+h[o>>2]*i+ +h[l>>2]*r);h[385]=a;return}}function Zt(t,e,i){t=+t;e=+e;i=+i;h[941]=t;h[942]=e;h[943]=i;return}function $t(t,e){t=+t;e=+e;h[937]=2.0/t;h[938]=-2.0/e;return}function te(t){t=t|0;var e=0,i=0.0,n=0.0,a=0.0,o=0.0,s=0.0,l=0.0,c=0.0;if(!t){e=0;r[3776]=e;return}i=+h[t>>2];n=+h[t+4>>2];a=+h[t+8>>2];o=+h[t+12>>2];s=1.0/(i*o-n*a);l=+h[t+16>>2];h[908]=o*s;h[912]=-(n*s);h[928]=-(a*s);h[916]=i*s;c=+h[t+20>>2];h[920]=s*(a*c-o*l);h[924]=s*(n*l-i*c);e=1;r[3776]=e;return}function ee(t){t=+t;h[4]=t;return}function ie(t,e,i,r){t=+t;e=+e;i=+i;r=+r;h[388]=i;h[391]=r;h[390]=0.0;h[389]=0.0;h[392]=t;h[393]=e;return}function re(t,e,i,r,n,a,o){t=+t;e=+e;i=+i;r=+r;n=+n;a=+a;o=+o;var s=0.0,l=0.0,c=0.0,u=0.0;s=i-t;i=r-e;r=1.0/+b(+(s*s+i*i));l=r*s;s=r*i;i=r;r=(0.0-t)*i*l;c=(0.0-e)*i*s;u=(r+c)*o;h[392]=u;h[388]=((n-t)*i*l+c)*o-u;c=(r+(a-e)*i*s)*o-u;h[391]=c;h[390]=c;h[389]=0.0;return}function ne(){h[388]=1.0;h[391]=1.0;h[390]=0.0;h[389]=0.0;h[392]=0.0;h[393]=0.0;return}function ae(t,e){t=t|0;e=e|0;var i=0.0,r=0,n=0.0,a=0,o=0.0,s=0,l=0.0,c=0,u=0.0,f=0,d=0,p=0;i=+h[t>>2];r=t+4|0;n=+h[r>>2];a=t+8|0;o=+h[a>>2];s=t+12|0;l=+h[s>>2];c=t+16|0;u=+h[c>>2];f=e+8|0;h[t>>2]=i*+h[e>>2]+n*+h[f>>2];d=e+4|0;p=e+12|0;h[r>>2]=i*+h[d>>2]+n*+h[p>>2];h[a>>2]=o*+h[e>>2]+l*+h[f>>2];h[s>>2]=o*+h[d>>2]+l*+h[p>>2];s=t+20|0;l=+h[s>>2];h[c>>2]=+h[e+16>>2]+(u*+h[e>>2]+l*+h[f>>2]);h[s>>2]=+h[e+20>>2]+(u*+h[d>>2]+l*+h[p>>2]);return}function oe(t,e,i,r,n,a){t=+t;e=+e;i=+i;r=+r;n=+n;a=+a;var o=0;o=ot(24)|0;h[o>>2]=t;h[o+4>>2]=e;h[o+8>>2]=i;h[o+12>>2]=r;h[o+16>>2]=n;h[o+20>>2]=a;return o|0}function se(t,e,i){t=t|0;e=e|0;i=i|0;var r=0,n=0,a=0,o=0,s=0;r=t+4|0;n=e+8|0;h[i>>2]=+h[t>>2]*+h[e>>2]+ +h[r>>2]*+h[n>>2];a=e+4|0;o=e+12|0;h[i+4>>2]=+h[t>>2]*+h[a>>2]+ +h[r>>2]*+h[o>>2];r=t+8|0;s=t+12|0;h[i+8>>2]=+h[r>>2]*+h[e>>2]+ +h[s>>2]*+h[n>>2];h[i+12>>2]=+h[r>>2]*+h[a>>2]+ +h[s>>2]*+h[o>>2];s=t+16|0;r=t+20|0;h[i+16>>2]=+h[e+16>>2]+(+h[s>>2]*+h[e>>2]+ +h[r>>2]*+h[n>>2]);h[i+20>>2]=+h[e+20>>2]+(+h[s>>2]*+h[a>>2]+ +h[r>>2]*+h[o>>2]);return}function he(t,e){t=t|0;e=e|0;var i=0.0,r=0,n=0.0,a=0.0;i=+h[t>>2];r=t+4|0;n=+h[r>>2];a=+h[e+16>>2]+(+h[e>>2]*i+ +h[e+8>>2]*n);h[r>>2]=+h[e+20>>2]+(i*+h[e+4>>2]+n*+h[e+12>>2]);h[t>>2]=a;return}function le(t){t=t|0;var e=0,i=0,r=0,n=0,o=0,s=0,h=0,l=0,c=0,u=0;if(!t){e=0;return e|0}i=t>>>0>8?t:8;r=31-(S(i|0)|0)|0;n=((i|0)==0?1:r)+((pe(t|0)|0)!=1&1)|0;t:do{if(n>>>0>3&1<<n>>>0>t>>>0?(r=a[3504+(n+-1<<2)>>2]|0,(r|0)!=0):0){i=0;o=r;while(1){if((((a[o+-8>>2]|0)>>>1)+-8|0)>>>0>=t>>>0)break;i=i+1|0;r=a[o+4>>2]|0;if(!(i>>>0<32&(r|0)!=0)){s=8;break t}else o=r}h=ce(o,t)|0}else s=8}while(0);t:do{if((s|0)==8){e:do{if(n>>>0<32){i=n;while(1){l=a[3504+(i<<2)>>2]|0;i=i+1|0;if(l|0)break;if(i>>>0>=32)break e}h=ce(l,t)|0;break t}}while(0);o=a[940]|0;if(o|0?(i=a[o>>2]|0,(i&1|0)==0):0){a[o>>2]=i|1;r=(i>>>1)+-8|0;i=r>>>0>8?r:8;r=31-(S(i|0)|0)|0;c=o+8|0;u=3504+(((i|0)==0?1:r)<<2)|0;r=o+12|0;if((a[u>>2]|0)==(c|0))a[u>>2]=a[r>>2];u=a[c>>2]|0;if(u|0)a[u+4>>2]=a[r>>2];u=a[r>>2]|0;if(u|0)a[u>>2]=a[c>>2];c=(ue(t)|0)==0;u=a[940]|0;if(c){a[u>>2]=a[u>>2]&-2;e=0;return e|0}else{if(!u)e=0;else{h=u;break}return e|0}}u=t+15&-8;c=_e(u|0)|0;if((c|0)==(-1|0)){e=0;return e|0}r=c;o=r+7&-8;i=o;if((c|0)!=(i|0)?(_e(o-r|0)|0)==(-1|0):0){e=0;return e|0}r=o;o=a[940]|0;if(!o)a[939]=i;else a[r+4>>2]=o;a[940]=i;a[r>>2]=u<<1|1;h=r}}while(0);e=h+8|0;return e|0}function ce(t,e){t=t|0;e=e|0;var i=0,r=0,n=0,o=0,s=0;i=t+-8|0;r=((a[i>>2]|0)>>>1)+-8|0;n=r>>>0>8?r:8;r=31-(S(n|0)|0)|0;o=3504+(((n|0)==0?1:r)<<2)|0;r=t+4|0;if((a[o>>2]|0)==(t|0))a[o>>2]=a[r>>2];o=a[t>>2]|0;if(o|0)a[o+4>>2]=a[r>>2];o=a[r>>2]|0;if(o|0)a[o>>2]=a[t>>2];o=a[i>>2]|0;a[i>>2]=o|1;r=o>>>1;o=r+(-8-e)|0;do{if((a[940]|0)==(i|0)&(o&-8|0)==8)if(!(ue(r)|0))return i|0;else{s=o+8|0;break}else s=o}while(0);if(s>>>0<=15)return i|0;s=a[i>>2]|0;o=t+e+7&-8;e=o;t=o;a[i>>2]=s&1|o-i<<1;r=i+(s>>>1)-o|0;a[t>>2]=r<<1|a[t>>2]&1;a[t+4>>2]=i;a[((a[940]|0)==(i|0)?3760:e+(r&2147483647)+4|0)>>2]=e;fe(t);return i|0}function ue(t){t=t|0;var e=0,i=0,r=0,n=0,o=0,s=0;e=(t+15&-8)-((a[a[940]>>2]|0)>>>1)|0;if((_e(e|0)|0)==(-1|0)){i=0;return i|0}t=a[940]|0;r=a[t>>2]|0;if(!(r&1)){n=(r>>>1)+-8|0;r=n>>>0>8?n:8;n=31-(S(r|0)|0)|0;o=t+8|0;s=3504+(((r|0)==0?1:n)<<2)|0;n=t+12|0;if((a[s>>2]|0)==(o|0))a[s>>2]=a[n>>2];s=a[o>>2]|0;if(s|0)a[s+4>>2]=a[n>>2];s=a[n>>2]|0;if(s|0)a[s>>2]=a[o>>2]}o=(a[t>>2]|0)+(e<<1)|0;a[t>>2]=o;if(o&1|0){i=1;return i|0}e=(o>>>1)+-8|0;o=e>>>0>8?e:8;e=31-(S(o|0)|0)|0;s=t+8|0;n=3504+(((o|0)==0?1:e)<<2)|0;e=a[n>>2]|0;a[n>>2]=s;a[s>>2]=0;a[t+12>>2]=e;if(!e){i=1;return i|0}a[e>>2]=s;i=1;return i|0}function fe(t){t=t|0;var e=0,i=0,r=0,n=0,o=0,s=0,h=0,l=0,c=0,u=0,f=0,d=0,p=0,g=0,m=0,_=0;e=a[t>>2]|0;a[t>>2]=e&-2;i=a[t+4>>2]|0;r=a[940]|0;n=(r|0)==(t|0);o=t+(e>>>1)|0;s=n?0:o;h=n?0:o;if(i|0?(o=a[i>>2]|0,(o&1|0)==0):0){n=(o>>>1)+-8|0;o=n>>>0>8?n:8;n=31-(S(o|0)|0)|0;l=i+8|0;c=3504+(((o|0)==0?1:n)<<2)|0;n=i+12|0;if((a[c>>2]|0)==(l|0))a[c>>2]=a[n>>2];c=a[l>>2]|0;if(c|0)a[c+4>>2]=a[n>>2];c=a[n>>2]|0;if(c|0)a[c>>2]=a[l>>2];a[i>>2]=(a[i>>2]|0)+(a[t>>2]&-2);if(h){a[h+4>>2]=i;c=a[h>>2]|0;if(!(c&1)){o=(c>>>1)+-8|0;c=o>>>0>8?o:8;o=31-(S(c|0)|0)|0;u=h+8|0;f=3504+(((c|0)==0?1:o)<<2)|0;o=h+12|0;if((a[f>>2]|0)==(u|0))a[f>>2]=a[o>>2];f=a[u>>2]|0;if(f|0)a[f+4>>2]=a[o>>2];f=a[o>>2]|0;if(!f)d=r;else{a[f>>2]=a[u>>2];d=a[940]|0}a[i>>2]=(a[i>>2]|0)+(a[h>>2]&-2);if((h|0)==(d|0)){p=3760;g=19}else{p=s+((a[h>>2]|0)>>>1)+4|0;g=19}}}else{p=3760;g=19}if((g|0)==19)a[p>>2]=i;p=((a[i>>2]|0)>>>1)+-8|0;i=p>>>0>8?p:8;p=31-(S(i|0)|0)|0;g=3504+(((i|0)==0?1:p)<<2)|0;p=a[g>>2]|0;a[g>>2]=l;a[l>>2]=0;a[n>>2]=p;if(!p)return;a[p>>2]=l;return}if(h|0?(l=a[h>>2]|0,(l&1|0)==0):0){p=(l>>>1)+-8|0;l=p>>>0>8?p:8;p=31-(S(l|0)|0)|0;n=h+8|0;g=3504+(((l|0)==0?1:p)<<2)|0;p=h+12|0;if((a[g>>2]|0)==(n|0))a[g>>2]=a[p>>2];g=a[n>>2]|0;if(g|0)a[g+4>>2]=a[p>>2];g=a[p>>2]|0;if(!g)m=r;else{a[g>>2]=a[n>>2];m=a[940]|0}n=(a[t>>2]|0)+(a[h>>2]&-2)|0;a[t>>2]=n;if((h|0)==(m|0)){a[940]=t;_=n}else{a[s+((a[h>>2]|0)>>>1)+4>>2]=t;_=a[t>>2]|0}h=(_>>>1)+-8|0;_=h>>>0>8?h:8;h=31-(S(_|0)|0)|0;s=t+8|0;n=3504+(((_|0)==0?1:h)<<2)|0;h=a[n>>2]|0;a[n>>2]=s;a[s>>2]=0;a[t+12>>2]=h;if(!h)return;a[h>>2]=s;return}s=(e>>>1)+-8|0;e=s>>>0>8?s:8;s=31-(S(e|0)|0)|0;h=t+8|0;n=3504+(((e|0)==0?1:s)<<2)|0;s=a[n>>2]|0;a[n>>2]=h;a[h>>2]=0;a[t+12>>2]=s;if(!s)return;a[s>>2]=h;return}function de(t){t=t|0;if(!t)return;fe(t+-8|0);return}function pe(t){t=t|0;t=t-(t>>>1&1431655765)|0;t=(t&858993459)+(t>>>2&858993459)|0;return C(t+(t>>>4)&252645135,16843009)>>>24|0}function ge(t,e,i){t=t|0;e=e|0;i=i|0;var n=0,o=0,s=0;if((i|0)>=8192){O(t|0,e|0,i|0)|0;return t|0}n=t|0;o=t+i|0;if((t&3)==(e&3)){while(t&3){if(!i)return n|0;r[t>>0]=r[e>>0]|0;t=t+1|0;e=e+1|0;i=i-1|0}s=o&-4|0;i=s-64|0;while((t|0)<=(i|0)){a[t>>2]=a[e>>2];a[t+4>>2]=a[e+4>>2];a[t+8>>2]=a[e+8>>2];a[t+12>>2]=a[e+12>>2];a[t+16>>2]=a[e+16>>2];a[t+20>>2]=a[e+20>>2];a[t+24>>2]=a[e+24>>2];a[t+28>>2]=a[e+28>>2];a[t+32>>2]=a[e+32>>2];a[t+36>>2]=a[e+36>>2];a[t+40>>2]=a[e+40>>2];a[t+44>>2]=a[e+44>>2];a[t+48>>2]=a[e+48>>2];a[t+52>>2]=a[e+52>>2];a[t+56>>2]=a[e+56>>2];a[t+60>>2]=a[e+60>>2];t=t+64|0;e=e+64|0}while((t|0)<(s|0)){a[t>>2]=a[e>>2];t=t+4|0;e=e+4|0}}else{s=o-4|0;while((t|0)<(s|0)){r[t>>0]=r[e>>0]|0;r[t+1>>0]=r[e+1>>0]|0;r[t+2>>0]=r[e+2>>0]|0;r[t+3>>0]=r[e+3>>0]|0;t=t+4|0;e=e+4|0}}while((t|0)<(o|0)){r[t>>0]=r[e>>0]|0;t=t+1|0;e=e+1|0}return n|0}function me(t,e,i){t=t|0;e=e|0;i=i|0;var n=0,o=0,s=0,h=0;n=t+i|0;e=e&255;if((i|0)>=67){while(t&3){r[t>>0]=e;t=t+1|0}o=n&-4|0;s=e|e<<8|e<<16|e<<24;h=o-64|0;while((t|0)<=(h|0)){a[t>>2]=s;a[t+4>>2]=s;a[t+8>>2]=s;a[t+12>>2]=s;a[t+16>>2]=s;a[t+20>>2]=s;a[t+24>>2]=s;a[t+28>>2]=s;a[t+32>>2]=s;a[t+36>>2]=s;a[t+40>>2]=s;a[t+44>>2]=s;a[t+48>>2]=s;a[t+52>>2]=s;a[t+56>>2]=s;a[t+60>>2]=s;t=t+64|0}while((t|0)<(o|0)){a[t>>2]=s;t=t+4|0}}while((t|0)<(n|0)){r[t>>0]=e;t=t+1|0}return n-i|0}function _e(t){t=t|0;var e=0,i=0,r=0;e=R()|0;i=a[c>>2]|0;r=i+t|0;if((t|0)>0&(r|0)<(i|0)|(r|0)<0){L(r|0)|0;I(12);return-1}if((r|0)>(e|0))if(!(D(r|0)|0)){I(12);return-1}a[c>>2]=r;return i|0}return{_addQuad:Kt,_buildGlobalTrans:st,_buildLocalTrans:ht,_calcBound:lt,_cullingTest:ct,_free:de,_getClip:ut,_getCulled:ft,_getMirrorH:dt,_getMirrorV:pt,_getOwnerBuffer:gt,_getQuadsBuffer:Yt,_getVisible:mt,_getanchorX:_t,_getanchorY:vt,_getangle:yt,_getglobalTrans:bt,_getheight:xt,_getlocalTrans:wt,_getscale:Tt,_getscaleX:Ct,_getscaleY:St,_getskew:At,_getwidth:Pt,_getx:kt,_gety:Mt,_initStaticMemoryPage:et,_initTempStackMemory:it,_llvm_ctpop_i32:pe,_malloc:le,_mat2x3Append:ae,_mat3x4AppendTranslate:Y,_mat3x4FromQuat:Q,_mat3x4Identity:q,_mat3x4Mul:Z,_mat3x4ScaleTranslate:$,_memcpy:ge,_memset:me,_newSpriteData:It,_poolAlloc:X,_poolAllocDebug:U,_poolFree:J,_printPoolInfo:K,_quatLerp:tt,_renderScaleTrans:Qt,_renderScaleTranslateTrans:qt,_restoreTempStack:rt,_saveTempStack:nt,_sbrk:_e,_setClip:Et,_setCulled:Bt,_setFillColor:Zt,_setFrameBufferSize:$t,_setGlobalTransform:te,_setMirrorH:Rt,_setMirrorV:Ot,_setOpacity:ee,_setOwnerBuffer:Dt,_setUV:ie,_setUVGrad:re,_setUVIdentity:ne,_setVisible:Lt,_setanchorX:zt,_setanchorY:Ft,_setangle:Ht,_setheight:Gt,_setscale:Wt,_setscaleX:jt,_setscaleY:Nt,_setskew:Vt,_setwidth:Ut,_setx:Xt,_sety:Jt,_staticAlloc:at,_tempAllocMat2x3:oe,_tempStackAlloc:ot,establishStackSpace:N,stackAlloc:G,stackRestore:j,stackSave:W}}({Math:Math,Int8Array:Int8Array,Int16Array:Int16Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Float32Array:Float32Array},{a:u,b:function(t){r=t},c:function(){return r},d:function(t,e,i,r){u("Assertion failed: "+c(t)+", at: "+[e?c(e):"unknown filename",i,r?c(r):"unknown function"])},e:function(t){return e.___errno_location&&(s[e.___errno_location()>>2]=t),t},f:function(t,e,i){return h[t](e,i)},g:function(t,e,i,r){return h[t](e,i,r)},h:function(){return a.length},i:function(t,e,i){o.set(o.subarray(e,e+i),t)},j:function(t){u("OOM")},k:function(t){u("OOM")},l:4e3,m:3984},n),d={buffer:n,setFloatArray:function(t,e){HEAPF32.set(e,t>>2)},handleToFloatArray:function(t,e){return new Float32Array(n,t,e)},handleToByteArray:function(t,e){return new Uint8Array(n,t,e)}};for(var p in f)"_"==p[0]&&(d[p.substring(1)]=f[p]);return d.initStaticMemoryPage(262144),d.initTempStackMemory(1048576),d}("undefined"==typeof EZASM_MEMORY_SIZE?16<<20:EZASM_MEMORY_SIZE),__extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))((function(n,a){function o(t){try{h(r.next(t))}catch(t){a(t)}}function s(t){try{h(r.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,s)}h((r=r.apply(t,e||[])).next())}))},__generator=this&&this.__generator||function(t,e){var i,r,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&a[0]?r.return:a[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,a[1])).done)return n;switch(r=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},PLATFORM,Log,DEBUG,PUBLISH,PROFILING,useWGL,ez,ez,ez,ez,ez,ez,ez,ez,ez,ez,ez,ez,ez,ez,ez,ez,ez,ez,ez,ez,ez,ez,ez,ez;!function(t){function e(){this._p&&(this.disposed=!0,this._p.remove(this),this._p=null)}var i=function(){function t(t){this._items=[],this.addItems(t)}return t.prototype.remove=function(t){if(this._observers!=t){if(Array.isArray(this._observers)){var e=this._observers.indexOf(t);-1!=e&&this._observers.splice(e,1)}}else this._observers=null},t.dataChangeNotify=function(t,e,i,r){if(t)if(Array.isArray(t))for(var n=0;n<t.length;n++){var a=t[n];a.func.call(a.ctx,e,i,r)}else t.func.call(t.ctx,e,i,r)},Object.defineProperty(t.prototype,"items",{get:function(){return this._items},enumerable:!0,configurable:!0}),t.prototype.getItem=function(t){return this._items[t]},t.prototype.insertItem=function(e,i){if(e<0||e>=this._items.length)throw new Error("out of range.");this._items.splice(e,0,i),t.dataChangeNotify(this._observers,0,e,i)},t.prototype.addItems=function(e){if(e)for(var i=0;i<e.length;i++){var r=this._items.push(e[i]);t.dataChangeNotify(this._observers,3,r-1,e[i])}},t.prototype.setItems=function(e){e||(e=[]),this._items=e,t.dataChangeNotify(this._observers,3,0,e)},t.prototype.addItem=function(e){var i=this._items.push(e);t.dataChangeNotify(this._observers,0,i-1,e)},t.prototype.removeIndex=function(e){if(e<0||e>=this.items.length)throw new RangeError;var i=this._items[e];this._items.splice(e,1),t.dataChangeNotify(this._observers,2,e,i)},t.prototype.removeItem=function(e){var i=this._items.indexOf(e);if(-1==i)throw new Error("item not exist!");this._items.splice(i,1),t.dataChangeNotify(this._observers,2,i,e)},t.prototype.updateItem=function(e,i){if(e<0||e>=this.items.length)throw new RangeError;this._items[e]=i,t.dataChangeNotify(this._observers,1,e,i)},t.prototype.clear=function(){this._items=[],t.dataChangeNotify(this._observers,4)},t.prototype.addObserver=function(t,i){var r={func:t,ctx:i,_p:this,disposed:!1,dispose:e};return this._observers?Array.isArray(this._observers)?this._observers.push(r):this._observers=[this._observers,r]:this._observers=r,r},t.prototype.clearObservers=function(){this._observers=null},t.prototype.dispose=function(){this._items=null,this._observers=null},Object.defineProperty(t.prototype,"disposed",{get:function(){return null==this._items},enumerable:!0,configurable:!0}),t}();t.DataCollection=i;var r=function(){function t(t){for(var e in this._props={},this._observers={},this._converters=null,this._defaults=null,this._settingProp="",t)this.setProp(e,t[e])}return t.prototype.remove=function(t){var e=t.name,i=this._observers[e];if(Array.isArray(i)){var r=i,n=r.indexOf(t);-1!=n&&r.splice(n,1)}else i==t&&delete this._observers[e]},t.prototype.setDefaults=function(t){this._defaults=t},t.prototype.setPropConverters=function(t){this._converters=t},t.prototype.getProp=function(t){var e=this._props[t];return void 0===e&&this._defaults?this._defaults[t]:e},t.prototype.hasProp=function(t){return this._props.hasOwnProperty(t)},t.prototype.setProp=function(t,e){var i,r=null===(i=this._converters)||void 0===i?void 0:i[t];r&&void 0!==e&&(e=r.call(this,e));var n=this._props[t];if(n!==e&&(this._props[t]=e,this._settingProp!==t)){void 0===e&&this._defaults&&(e=this._defaults[t]),this._settingProp=t;var a=this._observers[t];if(a)if(Array.isArray(a))for(var o=0;o<a.length;o++){var s=a[o];s(e,n),s!=a[o]&&o--}else a(e,n);this._settingProp=""}},t.prototype.setData=function(t){for(var e in this._props)void 0!==t[e]&&this.setProp(e,t[e])},t.prototype.removeProp=function(t){void 0!==this._props[t]&&(this.setProp(t,void 0),delete this._props[t])},t.prototype.addObserver=function(t,e,i){var r=e.bind(i),n=this;r.dispose=function(){if(n){var e=n._observers[t];if(Array.isArray(e)){var i=e.indexOf(this);-1!=i&&e.splice(i,1)}else e==this&&delete n._observers[t];n=void 0,this.onDispose&&this.onDispose()}},Object.defineProperty(r,"disposed",{get:function(){return!n},enumerable:!0,configurable:!1});var a=n._observers[t];return a?Array.isArray(a)?a.push(r):a=[a,r]:n._observers[t]=r,r},t.prototype.bind=function(t,e,i,r){var n;function a(t){if(e.disposed)return n.dispose(),void(n=void 0);r&&(t=r(t)),e.setProp?e.setProp(i,t):e[i]=t}return i=i||t,n=this.addObserver(t,a),this.hasProp(t)&&a(this.getProp(t)),n},t.prototype.bind2way=function(t,e,i){var r,n,a,o=this;function s(){r&&(r.dispose(),r=void 0),n&&(n.dispose(),n=void 0),o=void 0,e=void 0}function h(t){a||(e.disposed?s():(a=!0,e.setProp(i,t),a=!1))}r=o.addObserver(t,h),n=e.addObserver(i,(function(e){a||(o.disposed?s():(a=!0,o.setProp(t,e),a=!1))})),o.hasProp(t)&&h(o.getProp(t));var l={dispose:s};return Object.defineProperty(l,"disposed",{get:function(){return!r},enumerable:!0,configurable:!1}),l},t.prototype.clearObserver=function(t){delete this._observers[t]},Object.defineProperty(t.prototype,"disposed",{get:function(){return null==this._props},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._props=null,this._converters=null,this._observers=null,this.onDispose&&this.onDispose()},t}();t.DataModel=r}(ez||(ez={})),function(t){var e=[],i=[];!function(t){t.init=function(){for(var t=0;t<e.length;t++)e[t]();e=null},t.afterInit=function(){for(var t=0;t<i.length;t++)i[t]();i=null}}(t.internal||(t.internal={})),t.initCall=function(t,r){void 0===r&&(r=!1),r?i.push(t):e.push(t)}}(ez||(ez={})),function(t){var e=function(){function t(t){if("number"==typeof t)this.value=t,this.isPercent=!1;else if("string"==typeof t){var e=t;if(e=e.trim(),/^-?\d+\.?\d*%$/.test(e))this.value=.01*parseFloat(e.substring(0,e.length-1)),this.isPercent=!0;else{if(!/^(-?\d+)(\.\d+)?$/.test(e))throw new Error(t+" is not a number or percent.");this.value=parseFloat(e),this.isPercent=!1}}}return t.prototype.toString=function(){return this.isPercent?(100*this.value).toString()+"%":this.value.toString()},t.prototype.calcSize=function(t){return this.isPercent?this.value*t:this.value},t}();t.Dimension=e;var i=function(){function t(t,e){this.x=t||0,this.y=e||0}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.toString=function(){return this.x+","+this.y},t.prototype.equals=function(t){return this.x==t.x&&this.y==t.y},t.add=function(e,i){return new t(e.x+i.x,e.y+i.y)},t.sub=function(e,i){return new t(e.x-i.x,e.y-i.y)},t.mul=function(e,i){return new t(e.x*i,e.y*i)},t.parse=function(e){var i=e.split(",");return new t(parseFloat(i[0]),parseFloat(i[1]))},t.distance=function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},t}();t.Point=i;var r=function(){function t(t,e,i,r){this.left=t||0,this.top=e||0,this.width=i||0,this.height=r||0}return Object.defineProperty(t.prototype,"right",{get:function(){return this.left+this.width},set:function(t){this.width=t-this.left},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.top+this.height},set:function(t){this.height=t-this.top},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this.left,this.top,this.width,this.height)},t.prototype.toString=function(){return this.left+","+this.top+","+this.width+","+this.height},t.parse=function(e){var i=e.split(",");return new t(parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2]),parseFloat(i[3]))},t.prototype.contains=function(t,e){return this.left<=t&&this.left+this.width>=t&&this.top<=e&&this.top+this.height>=e},t.prototype.containsPt=function(t){return this.contains(t.x,t.y)},t.equal=function(t,e){return!(!t||!e)&&(t.top===e.top&&t.left===e.width&&t.left===e.width&&t.height===e.height)},t.intersect=function(e,i){var r=Math.max(e.left,i.left),n=Math.max(e.top,i.top);return new t(r,n,Math.max(0,Math.min(e.right,i.right)-r),Math.max(0,Math.min(e.bottom,i.bottom)-n))},t}();t.Rect=r;var n=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=255),this.r=t,this.g=e,this.b=i,this.a=r}return Object.defineProperty(t.prototype,"rgba",{get:function(){return this.a<<24|this.b<<16|this.g<<8|this.r},enumerable:!0,configurable:!0}),t.prototype.toVec3=function(){var t=1/255;return[this.r*t,this.g*t,this.b*t]},t.prototype.toVec4=function(){var t=1/255;return[this.r*t,this.g*t,this.b*t,this.a*t]},t}();t.Color=n;var a=function(){function t(t,e,i,r,n,a){this._11="number"==typeof t?t:1,this._12=e||0,this._21=i||0,this._22="number"==typeof r?r:1,this.tx=n||0,this.ty=a||0}return t.rotate=function(e){var i=t.Deg2Rad*e,r=Math.cos(i),n=Math.sin(i);return new t(r,n,-n,r,0,0)},t.scale=function(e,i){return new t(e,0,0,i,0,0)},t.translate=function(e,i){return new t(1,0,0,1,e,i)},t.prototype.clone=function(){return new t(this._11,this._12,this._21,this._22,this.tx,this.ty)},t.prototype.identity=function(){return this._11=1,this._12=0,this._21=0,this._22=1,this.tx=0,this.ty=0,this},t.prototype.rotate=function(e){e*=t.Deg2Rad;var i=Math.cos(e),r=Math.sin(e),n=this._11,a=this._21,o=this.tx;return this._11=n*i-this._12*r,this._12=n*r+this._12*i,this._21=a*i-this._22*r,this._22=a*r+this._22*i,this.tx=o*i-this.ty*r,this.ty=o*r+this.ty*i,this},t.prototype.scale=function(t,e){return this._11*=t,this._12*=t,this.tx*=t,this._21*=e,this._22*=e,this.ty*=e,this},t.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.prototype.append=function(t){var e=this._11,i=this._12,r=this._21,n=this._22,a=this.tx;return this._11=e*t._11+i*t._21,this._12=e*t._12+i*t._22,this._21=r*t._11+n*t._21,this._22=r*t._12+n*t._22,this.tx=a*t._11+this.ty*t._21+t.tx,this.ty=a*t._12+this.ty*t._22+t.ty,this},t.prototype.invert=function(){var t=this._11,e=this._12,i=this._21,r=this._22,n=1/(t*r-e*i),a=this.tx;return this._11=r*n,this._12=-e*n,this._21=-i*n,this._22=t*n,this.tx=(i*this.ty-r*a)*n,this.ty=(e*a-t*this.ty)*n,this},t.prototype.transformPt=function(t){var e=new i;return e.x=this._11*t.x+this._21*t.y+this.tx,e.y=this._12*t.x+this._22*t.y+this.ty,e},t.prototype.transform=function(t){var e=this._11*t[0]+this._21*t[1]+this.tx;t[1]=this._12*t[0]+this._22*t[1]+this.ty,t[0]=e},t.multiply=function(e,i){return new t(e._11*i._11+e._12*i._21,e._11*i._12+e._12*i._22,e._21*i._11+e._22*i._21,e._21*i._12+e._22*i._22,e.tx*i._11+e.ty*i._21+i.tx,e.tx*i._12+e.ty*i._22+i.ty)},t.Deg2Rad=Math.PI/180,t.Identity=new t,t}();t.Matrix=a,function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right",t[t.Top=0]="Top",t[t.VCenter=4]="VCenter",t[t.Bottom=8]="Bottom"}(t.AlignMode||(t.AlignMode={})),function(t){t[t.SingleLine=0]="SingleLine",t[t.WordBreak=1]="WordBreak",t[t.MultiLine=2]="MultiLine",t[t.Ellipse=4]="Ellipse",t[t.Shrink=8]="Shrink",t[t.RichText=16]="RichText"}(t.TextFormat||(t.TextFormat={})),function(t){t[t.Normal=0]="Normal",t[t.Add=1]="Add",t[t.Copy=2]="Copy",t[t.Subtract=3]="Subtract",t[t.Multiply=4]="Multiply",t[t.Screen=5]="Screen"}(t.BlendMode||(t.BlendMode={}))}(ez||(ez={})),function(t){t.WebAudio=null;var e,i,r,n,a=[],o=!1,s=1,h=1;function l(e,i){if(t.bgmEnable)if(n)n.stopMusic(e,i);else if(t.WebAudio){if(!a[e]||!a[e].node)return;var o=a[e];if(i){var s=o.node;o.gain.gain.linearRampToValueAtTime(0,t.WebAudio.currentTime+.001*i),t.setTimer(i+10,(function(){s.stop(0),s.disconnect()}))}else{try{o.node.stop(0),o.node.disconnect()}catch(t){Log.error("stop music error: %o",t)}o.node=null}}else{if(!r)return;if(i){var h=r;r=null,h.volume=.7,t.setTimer(.5*i,(function(){h.volume=.3,t.setTimer(.5*i,(function(){h.currentTime=1e4,h.volume=0,h.loop=!1,h.pause(),h.volume=0}))}))}else r.currentTime=1e4,r.volume=0,r.loop=!1,r.pause(),r=null}}function c(t){var e=t.substring(0,4);if("http"!=e&&"file"!=e){var i=window.location.href;t=i.substring(0,i.lastIndexOf("/")+1)+t}return t}t.bgmEnable=!0,t.sfxEnable=!0,"undefined"!=typeof NativeAudio&&(n=NativeAudio),n||t.initCall((function(){var r=window.AudioContext||window.webkitAudioContext;r&&(t.WebAudio=new r,(i=t.WebAudio.createGain()).gain.value=1,i.connect(t.WebAudio.destination),(e=t.WebAudio.createGain()).gain.value=1,e.connect(t.WebAudio.destination))})),function(e){e.startAudio=function(){if(!n&&!o&&t.WebAudio){o=!0;var e=t.WebAudio.createBuffer(1,4410,44100),r=t.WebAudio.createBufferSource();r.buffer=e,r.connect(i),r.start(0)}}}(t.internal||(t.internal={})),t.setBGMVolume=function(i){r&&(r.volume=i),h=i,n?n.setMusicVolume(0,i):t.WebAudio&&(e.gain.value=i)},t.setSFXVolume=function(e){s=e,n?n.setSFXVolume(e):t.WebAudio&&(i.gain.value=e)},t.playSFX=function(e){if(t.sfxEnable){var r=t.getRes(e);if(r)if(n)n.playSFX(c(r.url));else if(t.WebAudio){function a(e){var r=t.WebAudio.createBufferSource();r.buffer=e,r.connect(i),r.start(0)}3==r.state?a(r.getData()):4!=r.state&&r.load((function(t){t&&a(r.getData())}),null)}else{function o(t){t.currentTime=0,t.volume=s,t.play()}3==r.state?o(r.getData()):r.load((function(t){t&&o(r.getData())}),null)}}},t.stopMusic=l,t.playMusic=function(i,o,s,u,f){if(t.bgmEnable){u=u||1,s=!!s;var d=t.getRes(o);if(d)if(n)n.playMusic(i,c(d.url),u,s,f||0);else if(l(i),t.WebAudio){function p(r){l(i),a[i]||(a[i]={gain:t.WebAudio.createGain(),node:null},a[i].gain.connect(e));var n=a[i];if(n.node=t.WebAudio.createBufferSource(),n.node.buffer=r,s&&(n.node.loop=!0),f){var o=n.gain.gain;o.value=0,o.linearRampToValueAtTime(u,t.WebAudio.currentTime+.001*f)}else n.gain.gain.value=u;n.node.connect(n.gain),n.node.start(0)}3==d.state?p(d.getData()):4!=d.state&&d.load((function(t){t&&p(d.getData())}),null)}else{function g(t){r=t,t.currentTime=0,t.volume=h,t.loop=!!s,t.play()}3==d.state?g(d.getData()):d.load((function(t){t&&g(d.getData())}),null)}}}}(ez||(ez={})),function(t){var e=null;t.getGL=function(){return e},t.RenderContext={};var i=t.RenderContext;!function(r){r.createWGLRenderContext=function(r){t.Texture.init(r);var n,a,o,s,h,l,c,u,f,d,p,g,m,_=0,v=[],y=(e=r).getExtension("OES_vertex_array_object"),b=!1,x=0,w=0,T=new Uint8Array(64),C=ezasm.handleToFloatArray(ezasm.getQuadsBuffer(),480);function S(t){_>=30&&i.flush(),ezasm.addQuad(_,t),_++}function A(t,e){v[e]!=t.id&&(i.flush(),m&&m.push(function(t,e){return function(){t.bindTexture(e),v[e]=t.id}}(t,e)),t.bindTexture(e),v[e]=t.id)}function P(i){switch(i){case t.BlendMode.Normal:e.blendFunc(1,771),e.blendEquation(32774);break;case t.BlendMode.Add:e.blendFunc(1,1),e.blendEquation(32774);break;case t.BlendMode.Multiply:e.blendFunc(32968,0),e.blendEquation(32774);break;case t.BlendMode.Copy:e.blendFunc(1,0),e.blendEquation(32774);break;case t.BlendMode.Subtract:e.blendFunc(1,1),e.blendEquation(32778)}}function k(t){return function(){e.scissor(t.left*i.scale|0,(w-t.bottom)*i.scale|0,t.width*i.scale|0,t.height*i.scale|0)}}function M(e,r){var n=e.uniforms;for(var a in n){var s=r[a];if(void 0!==s)if(e.texUniforms&&e.texUniforms[a]){var h=e.texUniforms[a];e.bind(a,h),"string"==typeof s&&(s=t.getRes(s)),s.getData().ready?i.bindTexture(s.getData(),h):(s.load(),i.bindTexture(o,h))}else e.bind(a,r[a])}}!function(){for(var i=e.createBuffer(),r=e.createBuffer(),n=new Uint16Array(768),c=new Float32Array(1536),u=0;u<128;u++)c[12*u]=0,c[12*u+1]=0,c[12*u+2]=u,c[12*u+3]=1,c[12*u+4]=0,c[12*u+5]=u,c[12*u+6]=1,c[12*u+7]=1,c[12*u+8]=u,c[12*u+9]=0,c[12*u+10]=1,c[12*u+11]=u;for(var d=0,p=0;d<768;d+=6,p+=4)n[d+0]=p,n[d+1]=p+1,n[d+2]=p+2,n[d+3]=p,n[d+4]=p+2,n[d+5]=p+3;function g(){e.bindBuffer(34962,i),e.enableVertexAttribArray(0),e.enableVertexAttribArray(1),e.vertexAttribPointer(0,2,5126,!1,12,0),e.vertexAttribPointer(1,1,5126,!1,12,8),e.bindBuffer(34963,r)}if(e.bindBuffer(34962,i),e.bufferData(34962,c,35044),e.bindBuffer(34963,r),e.bufferData(34963,n,35044),y){var m=y.createVertexArrayOES();y.bindVertexArrayOES(m),g(),y.bindVertexArrayOES(null),a=y.bindVertexArrayOES.bind(y,m)}else a=g;for(o=t.RawTexture.create("_null",1,1,6408,33071,9728,new Uint8Array([255,255,255,255])),h=t.RawTexture.create("_empty",1,1,6408,33071,9728,new Uint8Array([0,0,0,0])),l=t.RawTexture.create("_font",t.FontCache.Width,t.FontCache.Height,6408,33071,9729,null),d=0;d<64;d++)T[d]=255;s=t.RawTexture.create("_gradient",16,1,6408,33071,9729,T),f=t.BlendMode.Normal,e.blendFunc(1,771),e.blendEquation(32774),e.cullFace(1029),e.frontFace(2305),e.disable(2884),e.disable(2929),e.enable(3042),e.enable(3089),e.blendFunc(1,771),e.blendEquation(32774),e.disable(2884)}(),i.createVAO=function(t){if(y){var i=y.createVertexArrayOES();return y.bindVertexArrayOES(i),t(e),y.bindVertexArrayOES(null),y.bindVertexArrayOES.bind(y,i)}return t.bind(null,e)},i.drawTriangles=function(t,r){i.flush(),b=!1,t(),e.drawElements(4,r,5123,0),m&&m.push(function(t,i){return function(){b=!1,t(),e.drawElements(4,i,5123,0)}}(t,r))},i.flush=function(){var t,i;_>0&&(u.bind("quads",C,!0),b||(a(),b=!0),e.drawElements(4,6*_,5123,0),m&&m.push((t=_,(i=new Float32Array(16*t)).set(C.slice(0,16*t)),function(){C.set(i),b||(a(),b=!0),u.bind("quads",C,!0),e.drawElements(4,6*t,5123,0),_=0})),_=0)},i.fillRect=function(t,e,i){ezasm.renderScaleTrans(t,e,i),v[0]==s.id?(ezasm.setUVGrad(n.x0,n.y0,n.x1,n.y1,t,e,n.colors.length/16),S(1)):(A(o,0),S(2))},i.drawImage=function(t,e,i,r,n){var a=t.margin;if(a){var o=i/t.width,s=r/t.height;i=(t.width-a[2]-a[0])*o,r=(t.height-a[3]-a[1])*s;var h=a[0]*o,l=a[1]*s;ezasm.renderScaleTranslateTrans(i,r,h,l,e)}else ezasm.renderScaleTrans(i,r,e);n?ezasm.setUV(n.left*t.invWidth,n.top*t.invHeight,n.width*t.invWidth,n.height*t.invHeight):ezasm.setUVIdentity(),A(t,0),S(3)},i.drawImageRepeat=function(e,r,n,a,o){var s=e.subRect,h=e.width,l=e.height;A(e,0);var c=1,u=1;"repeat"!==o&&"repeat-x"!==o||(c=n/h),"repeat"!==o&&"repeat-y"!==o||(u=a/l);var f=t.Effect.get("tiling");i.setShader(f);var d=e.invWidth,p=e.invHeight;s?f.bind("tiling",[s.left*d,s.top*p,(s.width-1)*d,(s.height-1)*p],!0):f.bind("tiling",[0,0,1-d,1-p],!0),ezasm.renderScaleTrans(n,a,r),ezasm.setUV(0,0,c,u),S(3)},i.drawImageS9=function(t,e,i,r,n,a){var o,s,h=t.margin,l=0,c=0,u=0,f=0;if(h&&(l=h[0],c=h[1],u=h[2],f=h[3]),n-=f,!((r-=u)<=l||n<=c)){A(t,0);var d=a?a.left:0,p=a?a.top:0,g=d+(a?a.width:t.width-l-u),m=p+(a?a.height:t.height-c-f),_=i[0]-l,v=i[1]-c,y=i[2]-u,b=i[3]-f,x=[l],w=[c],T=[d],C=[p];if(_>0){var P=Math.min(r,_);x.push(P),T.push(d+P)}if(v>0){var k=Math.min(n,v);w.push(k),C.push(p+k)}for(y>0&&r>_&&(x.push(r-y),T.push(g-y)),b>0&&n>v&&(w.push(n-b),C.push(m-b)),_+y<r&&(x.push(r),T.push(g)),v+b<n&&(w.push(n),C.push(m)),o=0;o<T.length;o++)T[o]*=t.invWidth;for(o=0;o<C.length;o++)C[o]*=t.invHeight;var M=x.length;for(o=0;o<w.length-1;o++)for(s=0;s<M-1;s++)ezasm.renderScaleTranslateTrans(x[s+1]-x[s],w[o+1]-w[o],x[s],w[o],e),ezasm.setUV(T[s],C[o],T[s+1]-T[s],C[o+1]-C[o]),S(3)}},i.setAlphaBlend=function(t,e){ezasm.setOpacity(t),f!=e&&(i.flush(),f=e,P(e),m&&m.push(function(t){return function(){f=t,P(t)}}(e)))},i.setFillColor=function(t){if(d!=t){var e;if(d=t,"#"==t[0]){var i=t.substring(1);3==i.length&&(i=i[0]+"0"+i[1]+"0"+i[2]+"0"),e=parseInt(i,16)}else e=parseInt(d);var r=.00392156862745*(255&e),n=15259021e-12*(65280&e),a=5.960555428e-8*(16711680&e);ezasm.setFillColor(a,n,r)}},i.setFillGradient=function(t){i.flush(),n=t;for(var r=T,a=t.colors,o=0;o<a.length;o++){var h=a[o].substring(1);3==h.length&&(h=h[0]+"0"+h[1]+"0"+h[2]+"0");var l=parseInt(h,16);r[4*o]=(16711680&l)>>16,r[4*o+1]=(65280&l)>>8,r[4*o+2]=255&l,r[4*o+3]=h.length>6?l>>24&255:255}for(o=a.length;o<16;o++){var c=4*o;r[c]=r[c-4],r[c+1]=r[c-3],r[c+2]=r[c-2],r[c+3]=r[c-1]}A(s,0),e.texSubImage2D(3553,0,0,0,16,1,6408,5121,r),m&&m.push(function(t){var i=new Uint8Array(64);return i.set(t),function(){A(s,0),e.texSubImage2D(3553,0,0,0,16,1,6408,5121,i)}}(r))},i.pushClipRect=function(t){i.flush();var r=t.clone();return p=g[g.length-1],r.left=Math.max(r.left,p.left),r.top=Math.max(r.top,p.top),r.width=Math.max(0,Math.min(r.right,p.right)-r.left),r.height=Math.max(0,Math.min(r.bottom,p.bottom)-r.top),m&&m.push(k(r)),g.push(r),e.scissor(r.left*i.scale|0,(w-r.bottom)*i.scale|0,r.width*i.scale|0,r.height*i.scale|0),r.width>0&&r.height>0},i.popClipRect=function(){i.flush(),g.pop(),p=g[g.length-1],m&&m.push(k(p)),e.scissor(p.left*i.scale|0,(w-p.bottom)*i.scale|0,p.width*i.scale|0,p.height*i.scale|0)},i.setShader=function(r,n){r||(r=t.Effect.default),r!==u&&(i.flush(),e.useProgram(r.proc),u=r,m&&m.push(function(t){return function(){e.useProgram(t.proc),u=t}}(r))),n&&(i.flush(),m&&m.push(function(t,e){return function(){M(t,e)}}(r,n)),M(r,n))},i.bindTexture=function(t,e){A(t,e)},i.drawTextCache=function(t,e,i,r){var n=i.region;A(l,0),ezasm.renderScaleTranslateTrans(i.w,i.h,t,e,r),ezasm.setUV(n[0],n[1],n[2],n[3]),S(1)},i.begin3DRender=function(t){return i.flush(),e.disable(3042),e.enable(2884),e.enable(2929),t&&e.viewport(t.left*i.scale|0,(w-t.bottom)*i.scale|0,t.width*i.scale|0,t.height*i.scale|0),y&&y.bindVertexArrayOES(null),m&&(m=null),{width:x,height:w,gl:e,profiler:c,shader:null,setShader:function(t){this.shader!=t&&(t.clearCache(),e.useProgram(t.proc),this.shader=t)},defTexture:h,bindTexture:function(t,e){!function(t,e){(t=t||h).empty&&(t=h),v[e]!=t.id&&(t.bindTexture(e),v[e]=t.id)}(t,e)},bindCubeTexture:function(t,i){v[i]="_cube",e.activeTexture(33984+i),e.bindTexture(34067,t.glTex)},lastPrimitive:0,end:function(){e.enable(3042),e.disable(2884),e.disable(32926),e.disable(2929),P(f),u=null,b=!1,t&&e.viewport(0,0,x*i.scale|0,w*i.scale|0)}}},i.beginRender=function(r,n){t.FontCache.updateFontTexture(e,l,n),i.profile=n,i.width=x=r.width,i.height=w=r.height,i.invWidth=2/x,i.invHeight=-2/w,i.scale=r.scale,ezasm.setFrameBufferSize(r.width,r.height),c=n,e.bindFramebuffer(36160,r.framebuffer),e.clear(16384),e.viewport(0,0,x*i.scale|0,w*i.scale|0),e.scissor(0,0,x*i.scale|0,w*i.scale|0),u=null,p=new t.Rect(0,0,x,w),v=[],_=0,g=[p],b=!1},i.endRender=function(){i.flush(),y&&y.bindVertexArrayOES(null),c=null,m&&(Log.error("missing end recorder."),m=null),t.Texture.addTextureAge()},i.beginRecorder=function(){return i.flush(),!m&&(m=[],v=[],!0)},i.endRecorder=function(){i.flush();var e=m;return e&&(e.fontRev=t.FontCache.rev),m=null,e},i.replay=function(t){i.flush();var e=t;m&&(m=m.concat(e));for(var r=0;r<e.length;r++)e[r]()}}}(t.internal||(t.internal={}))}(ez||(ez={})),function(t){var e=function(){this.flush=0,this.setClip=0,this.setTexture=0,this.setShader=0,this.drawQuad=0,this.drawcall=0,this.triangle=0,this.blendChange=0,this.fontCache=0,this.fontCacheSize=[]};t.WGLPerFrameProfiler=e;var i=function(){this.fillRect=0,this.drawImage=0,this.drawText=0,this.transfromChange=0};t.CanvasPerFrameProfiler=i,function(t){function s(){return l.now()}var h;t.beginFrameProfiling=function(t,e){throw new Error("no profiling")},t.endFrameProfiling=function(){},t.beginEventProfiling=function(){h=[]},t.endEventProfiling=function(){if(!h)throw new Error("no profiling");var t=h;return h=null,t},t.now=s,t.newFrame=function(){return a?(r=useWGL?new e:new i,n&&(r.commands=[]),r.frame=o++,r.updateTime=r.startTime=t.now(),r):null},t.endFrame=function(){a&&(r.renderTime=t.now()-r.renderTime,r.endTime=t.now(),a(r),r=null)},t.addCommand=function(t){if(r&&r.commands){var e=s()-r.updateTime;r.commands.push([e,t])}},t.newEvent=function(t,e){if(!h)return null;var i=new c(t,e);return h.push(i),i};var l=Date;"undefined"!=typeof performance&&(l=performance);var c=function(){function t(t,e){this.type=t,this.args=e,this.start=s()}return t.prototype.addStep=function(t){this.steps||(this.steps=[]),this.steps.push({name:t,time:s()-this.start})},t.prototype.end=function(){this.time=s()-this.start},t}()}(t.Profile||(t.Profile={}));var r,n,a,o=0}(ez||(ez={})),function(t){var e;!function(t){t.createCanvas=function(){return document.createElement("canvas")}}(e=t.internal||(t.internal={}));var i=function(){function t(t,e,i,r,n){this.bubble=!0,this.id=t,this.type=e,this.screenX=i,this.screenY=r,this.rawEvent=n,this.time=Date.now()}return t.prototype.capture=function(){a.capture(this.id,this.target)},t.prototype.excludeCapture=function(){a.cancelTouch(this.id,this.target)},t}(),r=null;function n(t,e,i){var r,n,a=document.documentElement,o=document.body,s=0,h=0;if(e.getBoundingClientRect){var l=e.getBoundingClientRect();s=l.left,h=l.top}s+=window.pageXOffset-a.clientLeft,h+=window.pageYOffset-a.clientTop,null!=t.pageX?(r=t.pageX,n=t.pageY):(s-=o.scrollLeft,h-=o.scrollTop,r=t.clientX,n=t.clientY);var c=-1;return"number"==typeof t.identifier?c=t.identifier:"number"==typeof t.pointerId&&(c=t.pointerId),{id:c,x:(r-s)*i,y:(n-h)*i}}var a,o,s,h=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.touchEvents=[],t._sizeDirty=!1,t._childs=[],t._sizeChanged=!1,t.touchCaptures={},t._namedChilds={},t}return __extends(i,e),i.prototype.isCaptured=function(t){return!!this.touchCaptures[t]},i.prototype.capture=function(t,e){this.touchCaptures[t]?-1==this.touchCaptures[t].indexOf(e)&&this.touchCaptures[t].push(e):this.touchCaptures[t]=[e]},i.prototype.cancelTouch=function(t,e){if(this.touchCaptures[t]){var i=this.touchCaptures[t];this.touchCaptures[t]=[e];for(var r=0;r<i.length;r++)i[r]!=e&&i[r].onTouchCancel&&i[r].onTouchCancel(t)}},i.prototype.screenToClient=function(e,i){return new t.Point(e,i)},i.prototype.clientToScreen=function(e,i){return new t.Point(e,i)},Object.defineProperty(i.prototype,"_displayStage",{get:function(){return this._stage},enumerable:!0,configurable:!0}),i.prototype.createChild=function(e,i){var r=t.ui.getGuiClass(e.ClassName);if(!r)throw new Error(e.ClassName+" is not registered.");var n=new r(this);if(this._childs.push(n),this.childSizeChanged(),i&&(n._setProps(i),i.id)){var a=this._namedChilds,o=i.id;a[o]&&Log.warn("control id conflict.",o),a[o]=n,n._id=o}return n},i.prototype.clear=function(){for(var t=this._childs.concat(),e=0;e<t.length;e++)t[e].dispose()},i.prototype.renderImpl=function(t){this._stage.render(this._screenBuffer,t)},i.prototype.find=function(t,e){for(var i=0;i<this._childs.length;i++){var r=this._childs[i];if(r.id==t)return r;if("function"==typeof r.find){var n=r.find(t,e);if(n)return n}}return null},i.prototype._fireEvent=function(){},i.prototype._removeChild=function(t){var e=this._childs.indexOf(t);if(-1==e)throw new Error("child not exist!");this._childs.splice(e,1)},i.prototype.childSizeChanged=function(){this._sizeDirty=!0},Object.defineProperty(i.prototype,"width",{get:function(){return this.getProp("width")},set:function(t){this.setProp("width",t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.getProp("height")},set:function(t){this.setProp("height",t)},enumerable:!0,configurable:!0}),i.prototype.addScreenResizeListener=function(t,e){t=e?t.bind(e):t,this._onScreenResize||(this._onScreenResize=[]),this._onScreenResize.push(t)},i.prototype.render=function(t){this._stage.dirty&&this.renderImpl(t)},i.prototype.checkSizeMeasure=function(){if(this._sizeDirty||this._sizeChanged){for(var t=this.width,e=this.height,i=0;i<this._childs.length;i++){this._childs[i].measureBound(t,e,this._sizeChanged)}this._sizeChanged=!1,this._sizeDirty=!1}},i.prototype.findControls=function(t,e){if(t<0||t>=this.width||e<0||e>=this.height)return null;for(var i=this._childs.length-1;i>=0;i--){var r=this._childs[i].findControls(t,e);if(null!=r)return r}return[]},i.prototype.findElements=function(t,e){for(var i=[],r=this._childs.length-1;r>=0;r--)this._childs[r].findElements(t,e,i);return i},i.prototype.resize=function(t,e){this.width=t,this.height=e,useWGL&&(this._canvas.width=t,this._canvas.height=e),this.onResize()},i.prototype.dispatchTouchEvents=function(){var t,e,i=this.touchEvents;this.touchEvents=[];for(var r=0;r<i.length;r++){var n=i[r];switch(n.type){case 1:if(!(t=this.findControls(n.screenX,n.screenY)))break;for(e=0;e<t.length&&(n.target=t[e],t[e].onTouchBegin&&t[e].onTouchBegin.call(n.target,n),n.bubble);e++);break;case 2:if(a=this.touchCaptures[n.id]){for(e=0;e<a.length;e++)n.target=a[e],!a[e].disposed&&a[e].onTouchMove&&a[e].onTouchMove.call(n.target,n);break}if(!(t=this.findControls(n.screenX,n.screenY)))break;for(e=0;e<t.length&&(n.target=t[e],t[e].onTouchMove&&t[e].onTouchMove.call(n.target,n),n.bubble);e++);break;case 3:var a;if(a=this.touchCaptures[n.id]){for(delete this.touchCaptures[n.id],e=0;e<a.length;e++)n.target=a[e],!a[e].disposed&&a[e].onTouchEnd&&a[e].onTouchEnd.call(n.target,n);break}if(!(t=this.findControls(n.screenX,n.screenY)))break;for(e=0;e<t.length&&(n.target=t[e],t[e].onTouchEnd&&t[e].onTouchEnd.call(n.target,n),n.bubble);e++);}}},i}(t.DataModel),l=function(a){function o(i){var n=a.call(this)||this;n._inputting=!1,n.isIOS=!1;var o=navigator.userAgent.toLowerCase();n.isIOS=o.indexOf("iphone")>=0||o.indexOf("ipad")>=0||o.indexOf("ipod")>=0,n._launchData=i;var s=n.div=i.div;n._stage=t.createStage();var h=n;if(useWGL=2==i.canvasMode?0:1){(u=e.createCanvas()).style.left="0px",u.style.top="0px";var l={alpha:!1,preserveDrawingBuffer:!1,depth:!!i.render3D,stencil:!!i.render3D,antialias:!0};if(i.wglOptions)for(var c in i.wglOptions)l[c]=i.wglOptions[c];if(r=u.getContext("experimental-webgl",l)){n._canvas=u,s.appendChild(u),e.createWGLRenderContext(r);n._screenBuffer=new t.RenderTexture({width:0,height:0,memSize:0,fb:null},0,0)}else{if(1!=i.canvasMode)throw new Error("your browser doesn't support WebGL!");useWGL=0}}if(!useWGL){t.createCanvasRenderContext();var u=document.createElement("canvas");s.appendChild(u),n._canvas=u}n.onResize();var f=!1;function d(t){t.stopPropagation(),t.preventDefault()}s.oncontextmenu=function(){return!1};var p=!1;return s.onpointerdown=function(t){h._inputting||(d(t),p=!0,s.setPointerCapture(t.pointerId),h.onTouchBegin(t))},s.onpointermove=function(t){h._inputting||(d(t),h.onTouchMove(t),p||h.mouseMove(t))},s.onpointerup=function(t){h._inputting||(d(t),p=!1,s.releasePointerCapture(t.pointerId),h.onTouchEnd(t))},s.addEventListener("touchstart",(function(t){if(f||(s.onpointerdown=null,s.onpointermove=null,s.onpointerup=null,f=!0),!h._inputting){t.stopPropagation(),t.preventDefault();for(var e=t.changedTouches.length,i=0;i<e;i++)h.onTouchBegin(t.changedTouches[i])}}),{passive:!1}),s.addEventListener("touchmove",(function(t){if(!h._inputting){t.stopPropagation(),t.preventDefault();for(var e=t.changedTouches.length,i=0;i<e;i++)h.onTouchMove(t.changedTouches[i])}}),{passive:!1}),s.addEventListener("touchend",(function(t){if(!h._inputting){t.stopPropagation(),t.preventDefault();for(var e=t.changedTouches.length,i=0;i<e;i++)h.onTouchEnd(t.changedTouches[i])}}),{passive:!1}),s.addEventListener("touchcancel",(function(t){if(!h._inputting){t.stopPropagation(),t.preventDefault();for(var e=t.changedTouches.length,i=0;i<e;i++)h.onTouchEnd(t.changedTouches[i])}}),{passive:!1}),n}return __extends(o,a),o.prototype.cancelInput=function(){this._inputCtrl=null,this._inputting=!1,window.scrollTo(0,0),this._input&&(this.div.removeChild(this._input),this._input=null)},o.prototype.startInput=function(e){if(this._inputting)Log.error("the last inputting is not end.");else{var i=e.getBound(),r=e.clientToScreen(0,0);(i=new t.Rect(r.x,r.y,i.width,i.height)).left*=this.scale,i.top*=this.scale,this._input&&(this.div.removeChild(this._input),this._input=null),e.multiLine?this._input=document.createElement("textarea"):(this._input=document.createElement("input"),this._input.type=e.type||"text");var n=this._input;this.div.appendChild(this._input),n.scrolltoView&&setTimeout((function(){n.scrolltoView({block:"start"})}),100),this._inputting=!0,this._inputCtrl=e;var a=n.style;n.value=e.text,e.visible=!1;var o=e._label.font;a.font=o,a.transform="scale("+this.scale+")",a.color=e._label.color,e.maxLength&&(n.maxLength=e.maxLength),a.left=i.left+"px",a.top=i.top+"px",a.overflow="hidden",a.width=(0|i.width).toString()+"px",a.height=(0|i.height).toString()+"px",a.visibility="visible",n.focus();var s=this;n.onblur=function(t){s.endInputHandler(!1)},e.multiLine&&!e.submitOnReturn||(this.isIOS?n.oninput=function(t){var e=n.value;e.indexOf("\n")>=0&&(n.value=e.replace("\n",""),s.endInputHandler(!0))}:n.onkeydown=function(t){"Enter"==t.key&&s.endInputHandler(!0)})}},o.prototype.endInputHandler=function(t){var e;if(this._inputCtrl){var i=this._inputCtrl;e=this._input.value,this._input&&(this.div.removeChild(this._input),this._input=null),i.visible=!0,i.state="normal",i.text=e,i.fireEvent("input",t),this._inputting=!1,window.scrollTo(0,0)}},o.prototype.setHighDPI=function(t){this._launchData.highDPI!=t&&(this._launchData.highDPI=t,this.onResize(!0))},o.prototype.onResize=function(e){if(!this._inputting){var i=this._launchData,r=this.div,n=this._canvas,a=r.parentElement;a==document.body&&(a=document.documentElement);var o=a.clientWidth,s=a.clientHeight;if(e||!this._lastSize||this._lastSize[0]!=o||this._lastSize[1]!=s){var h,l;this._lastSize=[o,s];var u=1;if(4==i.scaleMode)h=(u=(l=i.height)/s)*o,i.maxWidth&&(h=Math.min(h,i.maxWidth)),i.minWidth&&h<i.minWidth&&(u=i.minWidth/o,h=i.minWidth);else if(3==i.scaleMode)l=(u=(h=i.width)/o)*s,i.maxHeight&&(l=Math.min(l,i.maxHeight)),i.minHeight&&l<i.minHeight&&(u=i.minHeight/s,l=i.minHeight);else if(5==i.scaleMode)h=o*(u=window.devicePixelRatio),l=s*u;else if(2==i.scaleMode)h=i.width,l=i.height,u=1;else if(1==i.scaleMode)h=i.width,l=i.height,u=Math.max(h/o,l/s);else if(0==i.scaleMode){var f=(h=o)/(l=s);i.minRatio&&f<i.minRatio&&(l=h/i.minRatio),i.maxRatio&&f>i.maxRatio&&(h=l*i.maxRatio),(i.minWidth&&h<i.minWidth||i.minHeight&&l<i.minHeight)&&(u=Math.max(i.minWidth?i.minWidth/h:1,i.minHeight?i.minHeight/l:1)),(i.maxWidth&&h>i.maxWidth||i.maxHeight&&l>i.maxHeight)&&(u=Math.min(i.maxWidth?i.maxWidth/h:1,i.maxHeight?i.maxHeight/l:1)),h*=u,l*=u}else if(6==i.scaleMode){var d=i.onScreenAdapt(o,s);h=d.width,l=d.height,u=d.scale}this.invScale=u;var p=c(h*(u=1/u)),g=c(l*u);if(e||this.width!=h||this.height!=l||this.scale!=u){if(this.scale=u,this.width=h,this.height=l,this._sizeChanged=!0,this._stage.makeDirty(!1),this._onScreenResize)for(var m=0,_=this._onScreenResize;m<_.length;m++){(0,_[m])(h,l)}if(useWGL){if(n.style.width=p+"px",n.style.height=g+"px",i.highDPI){var v=u*window.devicePixelRatio;n.width=h*v|0,n.height=l*v|0,this._screenBuffer.scale=v}else n.width=0|h,n.height=0|l,this._screenBuffer.scale=1;this._screenBuffer.resize(h,l)}else n.width=h,n.height=l,this._screenBuffer=t.RenderTexture.createFromCanvas(n),n.style.width=p+"px",n.style.height=g+"px"}var y=0,b=0,x=3&i.alignMode,w=i.alignMode>>2;1==w?y=c(.5*(o-p)):2==w&&(y=o-p),1==x?b=c(.5*(s-g)):2==x&&(b=s-g),r.style.left=Math.max(0,y)+"px",r.style.top=Math.max(0,b)+"px",r.style.width=Math.min(o,p)+"px",r.style.height=Math.min(s,g)+"px"}}},o.prototype.onTouchBegin=function(t){e.startAudio();var r=n(t,this.div,this.invScale);this.touchEvents.push(new i(r.id,1,r.x,r.y,t))},o.prototype.onTouchMove=function(t){var e=n(t,this.div,this.invScale);this.touchEvents.push(new i(e.id,2,e.x,e.y,t))},o.prototype.onTouchEnd=function(t){var e=n(t,this.div,this.invScale);this.touchEvents.push(new i(e.id,3,e.x,e.y,t))},o.prototype.mouseMove=function(t){},o.prototype.dispatchTouchEvents=function(){this._inputting||a.prototype.dispatchTouchEvents.call(this)},o}(h);!function(n){function a(i){var a=n.call(this)||this;a._launchData=i,a._canvas=i.canvas,a._stage=t.createStage();var o=a;e.createWGLRenderContext(r),a._screenBuffer=new t.RenderTexture({width:0,height:0,memSize:0,fb:null}),a.onResize();o=a;function s(t){return{id:t.identifier,x:t.clientX*o.invScale,y:t.clientY*o.invScale}}return wx.onTouchStart((function(t){var e=t.changedTouches.length;Log.info("touch start ",t.changedTouches[0]);for(var i=0;i<e;i++)o.onTouchBegin(s(t.changedTouches[i]))})),wx.onTouchMove((function(t){for(var e=t.changedTouches.length,i=0;i<e;i++)o.onTouchMove(s(t.changedTouches[i]))})),wx.onTouchEnd((function(t){for(var e=t.changedTouches.length,i=0;i<e;i++)o.onTouchEnd(s(t.changedTouches[i]))})),wx.onTouchCancel((function(t){for(var e=t.changedTouches.length,i=0;i<e;i++)o.onTouchEnd(s(t.changedTouches[i]))})),wx.onKeyboardConfirm((function(t){Log.info("input:",t);var e=o._inputCtrl;e&&(e.state="normal",e.text=t.value,e.fireEvent("input",!0),o._inputCtrl=null)})),a}__extends(a,n),a.prototype.setHighDPI=function(t){this._launchData.highDPI!=t&&(this._launchData.highDPI=t,this.onResize(!0))},a.prototype.startInput=function(t){wx.showKeyboard({defaultValue:t.text,maxLength:t.maxLength,multiple:t.multiLine,confirmHold:!1,confirmType:"done"}),this._inputCtrl=t},a.prototype.cancelInput=function(){this._inputCtrl=null,wx.hideKeyboard({})},a.prototype.render=function(t){this._stage.dirty&&this.renderImpl(t)},a.prototype.onResize=function(t){var e=this._launchData,i=wx.getSystemInfoSync(),r=i.windowWidth,n=i.windowHeight;if(Log.info("onresize:"+r+" "+n),t||!this._lastSize||this._lastSize[0]!=r||this._lastSize[1]!=n){var a,o;this._lastSize=[r,n];var s=1;if(4==e.scaleMode)a=(s=(o=e.height)/n)*r;else if(3==e.scaleMode)o=(s=(a=e.width)/r)*n;else if(5==e.scaleMode)s=1,a=r,o=n;else if(6==e.scaleMode){var h=e.onScreenAdapt(r,n);a=h.width,o=h.height,s=h.scale}else s=1,a=r,o=n,Log.error("not support in wx");if(t||this.width!=a||this.height!=o||this.invScale!=s){if(this.invScale=s,this.scale=1/s,this.width=a,this.height=o,this._sizeChanged=!0,this._stage.makeDirty(!1),this._onScreenResize)for(var l=0,c=this._onScreenResize;l<c.length;l++){(0,c[l])(a,o)}e.highDPI?(r=Math.min(2048,i.windowWidth*i.pixelRatio),n=Math.min(2048,i.windowHeight*i.pixelRatio),s=Math.min(r/a,n/o),this._canvas.width=a*s|0,this._canvas.height=o*s|0,this._screenBuffer.scale=s):(this._canvas.width=0|a,this._canvas.height=0|o),this._screenBuffer.resize(a,o)}}},a.prototype.onTouchBegin=function(t){this.touchEvents.push(new i(t.id||-1,1,t.x,t.y,t))},a.prototype.onTouchMove=function(t){this.touchEvents.push(new i(t.id||-1,2,t.x,t.y,t))},a.prototype.onTouchEnd=function(t){this.touchEvents.push(new i(t.id||-1,3,t.x,t.y,t))}}(h);function c(t){return t+.5|0}var u=[],f=[],d={},p=0,g=1;t.callNextFrame=function(t,e){f.push({func:t,ctx:e})},t.setTimer=function(t,e,i){var r={func:e,ctx:i,delay:t};return d[++p]=r,p},t.removeTimer=function(t){delete d[t]},t.addTicker=function(t,e){var i={func:t,ctx:e};return u.push(i),i},t.getTick=function(){return Date.now()*g},t.removeTicker=function(t){var e=u.indexOf(t);-1!=e&&u.splice(e,1)},t.fps=0,t.timeShift=function(t){g=t},t.getRoot=function(){return a};var m=!1;t.pause=function(){m=!0},t.resume=function(){m=!1},t.delay=function(e){return new Promise((function(i){return t.setTimer(e,i)}))},t.nextFrame=function(){return new Promise((function(e){t.callNextFrame(e)}))},t.initialize=function(i){void 0===Log&&(Log=console),t.ui.registerTextStyle({id:"default",font:t.TextMetric.DefaultFont,color:"#ffffff"}),e.init();var r,n=document.createElement("style");document.body.appendChild(n),n.appendChild(document.createTextNode("\n.ezgame div{display:block;margin:0 auto;padding:0;border:0;position:absulute;}\n.ezgame canvas{display:block;position:absulute;}\n.ezgame input, textarea{background: none;padding: 0px;outline: thin;border:0 none;padding: 0;position:absolute;z-index: 1000;display: block;font-size-adjust: none;transform-origin:0 0;}\n.ezgame textarea{word-break: break-all;}")),"number"!=typeof i.alignMode&&(i.alignMode=5),"number"!=typeof i.scaleMode&&(i.scaleMode=0),i.div||(i.div=document.getElementById("game")),i.div.setAttribute("class","ezgame"),a=new l(i),"function"==typeof requestAnimationFrame?r=requestAnimationFrame:(r=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame)||(r=function(t){return window.setTimeout(t,o)}),o=i.fps?1e3/i.fps:0,s=Date.now();var h=0,c=Date.now(),p=!1;function _(e){if(e&&r(_),!((n=Date.now()-s)<o||m)){var i,n;if(n>1e3&&(n=1e3),s=Date.now(),a.onResize(),f.length>0)for(var l=f.splice(0,f.length),p=0;p<l.length;p++)try{l[p].func.call(l[p].ctx)}catch(t){Log.error("nextFrame caller exception: "+t.message+"\ncall tack: "+t.stack)}for(p=0;p<u.length;p++){var v=u[p];try{v.func.call(v.ctx,n*g)}catch(t){Log.error("ticker exception: "+t.message+"\ncall stack: "+t.stack),u.splice(p,1)}}for(var y in d){var b=d[y];if(b.delay-=n*g,b.delay<=0){delete d[y];try{b.func.apply(b.ctx)}catch(t){Log.error("timer exception: "+t.message+"\ncall stack: "+t.stack)}}}if(a.dispatchTouchEvents(),a.checkSizeMeasure(),e)try{a.render(i)}catch(t){Log.error("render exception: "+t.message+"\ncall stack: "+t.stack)}0,h++,(n=Date.now()-c)>1e3&&(c=Date.now(),t.fps=1e3*h/n,h=0)}}setInterval((function(){var t=Date.now()-s;t>200&&!p&&!m&&(p=!0,Log.debug("%d: more than %d ms no update. force to update",s,t),_(!1),s=Date.now(),p=!1)}),1e3),r(_),c=Date.now(),e.afterInit()}}(ez||(ez={})),function(t){var e=null;function i(t){for(var e=305419896,i=1985229328,r=0;r<t.length;r++){var n=0|t.charCodeAt(r);e=1033*(e+n)&4294967295,i=65789*(i+n)&4294967295}return e.toString(16)+i.toString(16)}var r={},n={},a=function(){function a(a,o,s,h,l){var c,u;e||(e=t.getGL());var f=i(a),d=i(o);if(r[f])c=r[f];else{if(c=e.createShader(35633),e.shaderSource(c,a),e.compileShader(c),!e.getShaderParameter(c,35713))throw Log.error("compile vertex shader failed:"+e.getShaderInfoLog(c),a),new Error("compile vertex shader failed");r[f]=c}if(n[d])u=n[d];else{if(u=e.createShader(35632),e.shaderSource(u,o),e.compileShader(u),!e.getShaderParameter(u,35713))throw Log.error("compile fragment shader failed:"+e.getShaderInfoLog(u),o),new Error("compile fragment shader failed");n[d]=u}this.vs=c,this.fs=u,this.proc=e.createProgram(),e.attachShader(this.proc,c),e.attachShader(this.proc,u);for(var p=0;p<s.length;p++)s[p]&&e.bindAttribLocation(this.proc,p,s[p]);for(var g in e.linkProgram(this.proc),this.uniforms={},this._cache={},h){(_=e.getUniformLocation(this.proc,g))?this.uniforms[g]={location:_,bind:h[g],matrix:h[g]===e.uniformMatrix2fv||h[g]===e.uniformMatrix3fv||h[g]===e.uniformMatrix4fv}:Log.warn("not found uniform "+g)}if(l){this.texUniforms={};for(var m=0;m<l.length;m++){var _;(_=e.getUniformLocation(this.proc,l[m]))?(this.uniforms[l[m]]={location:_,bind:e.uniform1i,matrix:!1},this.texUniforms[l[m]]=m+1):Log.warn("not found texture uniform "+l[m])}}if(!e.getProgramParameter(this.proc,35714))throw Log.error("link program failed:"+e.getProgramInfoLog(this.proc)),new Error("compile fragment shader failed")}return a.prototype.clearCache=function(){this._cache={}},a.prototype.hasUniform=function(t){return!!this.uniforms[t]},a.prototype.bind=function(t,i,r){var n=this.uniforms[t];if(n){if(!r){var a=this._cache;if(a[t]===i)return;if(Array.isArray(i)){var o=!0,s=a[t];if(s){for(var h=0;h<i.length;h++)if(i[h]!==s[h]){o=!1;break}}else o=!1;if(o)return}a[t]=i}n.matrix?n.bind.call(e,n.location,!1,i):n.bind.call(e,n.location,i)}},a}();t.Shader=a}(ez||(ez={})),function(t){var e,i=null;var r=function(t){function i(r,n,a){return t.call(this,i.DefVS2D,r,["pos","quad"],function(t){return t?t.quads=e.quads:t=e,t}(n),a)||this}return __extends(i,t),i.register=function(t,e){e.name=t,i.lib[t]=e},i.has=function(t){return!t||!!i.lib[t]},i.get=function(t){return t?i.lib[t]?i.lib[t]:(Log.error("effect "+t+" is not exist!"),i.default):i.default},i.lib={},i}(t.Shader);t.Effect=r,r.DefVS2D="\n#define MAX_QUAD 30\nattribute vec2 pos;\nattribute float quad;\nuniform vec4 quads[MAX_QUAD * 4];\nvarying vec2 v_tc;\nvarying vec2 v_pos;\nvarying vec4 v_color;\n\nvoid main(){\n\tint idx = int(quad) * 4;\n\tvec4 p0 = quads[idx];\n\tvec4 p1 = quads[idx + 1];\n\tvec4 p2 = quads[idx + 2];\n\tvec4 p3 = quads[idx + 3];\n\tgl_Position = vec4(pos.x * p0.x + pos.y * p0.z + p1.x - 1.0, pos.x * p0.y + pos.y * p0.w + p1.y + 1.0, 0.0, 1.0);\n\tv_tc = vec2(pos.x * p2.x + pos.y * p2.z + p1.z, pos.x * p2.y + pos.y * p2.w + p1.w);\n\tv_pos = pos;\n\tv_color = p3;\n}",r.DefFS2D="\nprecision mediump float;\nuniform sampler2D texture0;\nvarying vec2 v_tc;\nvarying vec4 v_color;\nvoid main(void){\n\tvec4 col = texture2D(texture0, v_tc);\n\tgl_FragColor = col * v_color;\n}",t.initCall((function(){if(useWGL){i=t.getGL(),e={quads:i.uniform4fv},r.default=new r(r.DefFS2D),r.register("default",r.default),r.register("tiling",new r("\nprecision mediump float;\nuniform sampler2D texture0;\nuniform vec4 tiling;\nvarying vec2 v_tc;\nvarying vec4 v_color;\nvoid main(void){\n\tvec4 col = texture2D(texture0, fract(v_tc) * tiling.zw + tiling.xy);\n\tgl_FragColor = col * v_color;\n}")),r.register("mono",new r("\nprecision mediump float;\nuniform sampler2D texture0;\nvarying vec2 v_tc;\nvarying vec4 v_color;\nvoid main(void){\n\tvec4 col = texture2D(texture0, v_tc);\n\tfloat l = col.r * 0.3 + col.g * 0.6 + col.b * 0.1;\n\tgl_FragColor = vec4(l,l,l,col.a) * v_color;\n}")),r.register("mask",new r("\nprecision mediump float;\nuniform sampler2D texture0;\nuniform sampler2D mask;\nvarying vec2 v_tc;\nvarying vec2 v_pos;\nvarying vec4 v_color;\nvoid main(void){\n\tvec4 col = texture2D(texture0, v_tc) * texture2D(mask, v_pos);\n\tgl_FragColor = col * v_color;\n}",null,["mask"]))}}),!0)}(ez||(ez={})),function(t){!function(t){t.Width=1024,t.Height=1024,t.rev=1;var e,i=[],r=[],n=!1,a={};function o(t,e){var i=305419896,r=124076833;if(t){var n=t.split(".");i=parseInt(n[0],16),r=parseInt(n[0],16)}for(var a=0;a<e.length;a++){var o=e.charCodeAt(a);i=1033*(i+o)&2147483647,r=65789*(r+o)&2147483647}return i.toString(16)+"."+r.toString(16)}function s(e,r){if(0==i.length)return i.push({x:e,y:0,h:r}),[0,0];for(var n=-1,a=t.Height,o=0;o<i.length;o++){var s=i[o];if(s.x+e<=t.Width){if(s.h==r)return s.x+=e,[s.x-e,s.y];r<s.h&&s.h<a&&(n=o,a=s.h)}}return(s=i[i.length-1]).y+s.h+r<t.Height?(i.push({x:e,y:s.y+s.h,h:r}),[0,s.y+s.h]):n>=0?((s=i[n]).x+=e,[s.x-e,s.y]):void 0}t.getTextCacheOrKey=function(t,e,i,r,n){var s=o("",t);return s=o(s,e),i&&(s=o(s,i)),s=o(s,r),s=o(s,n),a[s]?a[s]:s},t.setTextCache=function(t,e){a[t]=e},t.log=function(){console.log(a)},t.addTextCache=function(t){t.use=0,r.push(t)},t.updateFontTexture=function(o,h,l){var c=1/t.Width,u=1/t.Height,f=!1;if(n){for(var d=0,p=0;p<r.length;p++){d+=(_=r[p].img).width*_.height}Log.info("font objects, area: "+d,r),n=!1}for(p=0;p<r.length;p++){if(!(b=r[p]).region||b.rev!=t.rev){if(!(v=s((_=b.img).width,_.height))){f=!0;break}b.rev=t.rev,b.r=v;var g=v[0],m=v[1];b.region=[g*c,m*u,_.width*c,_.height*u]}}if(f){t.rev++,i=[];for(p=0;p<r.length;p++){var _,v=s((_=(b=r[p]).img).width,_.height);if(b.rev=t.rev,b.r=v,v){g=v[0],m=v[1];b.region=[g*c,m*u,_.width*c,_.height*u]}else b.region=[0,0,0,0],Log.error("not enough space for text allocator. width:"+_.width+" height:"+_.height+". please set the bigger FontCacheWidth and FontCacheHeight"),Log.info(r)}}if(o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,h.glTex),f){var y=t.Height/8;e||(e=new Uint8Array(t.Width*y*4));for(p=0;p<8;p++)o.texSubImage2D(o.TEXTURE_2D,0,0,p*y,t.Width,y,o.RGBA,o.UNSIGNED_BYTE,e)}for(o.pixelStorei(37441,1),p=0;p<r.length;p++){var b;if((b=r[p]).r)o.texSubImage2D(o.TEXTURE_2D,0,b.r[0],b.r[1],o.RGBA,o.UNSIGNED_BYTE,b.img);b.r=null}for(var x in r=[],a){a[x].use--<-1e3&&delete a[x]}}}(t.FontCache||(t.FontCache={}))}(ez||(ez={})),function(t){function e(e){var i=ezasm.handleToFloatArray(e,6);return new t.Matrix(i[0],i[1],i[2],i[3],i[4],i[5])}var i=function(){function i(t,e){if(!t)throw new Error("the stage can't be null");this._handle=ezasm.newSpriteData(),this._rev=-1,this._parent=t,this._color="#ffffff",e&&(this._id=e),this._parent.addChild(this,e)}return i.create=function(t,e,r){if(!i.types[t])throw new Error(t+"Sprite is not exist!");return i.types[t](e,r)},i.register=function(t,e){i.types[t]=e},i.prototype._dispose=function(){ezasm.poolFree(this._handle),this._parent=void 0,this._handle=0,t.Tween.stopTweens(this),this.onDispose&&this.onDispose()},Object.defineProperty(i.prototype,"culled",{get:function(){return ezasm.getCulled(this._handle)},set:function(t){ezasm.setCulled(this._handle,t)},enumerable:!0,configurable:!0}),i.prototype.applyEffect=function(e){useWGL&&e.setShader(t.Effect.get(this._effect),this._effectParams)},i.prototype._buildTransform=function(){this._target&&this._target.disposed&&(this._target=null);var t=0,e=!1;this._target&&(this._target._buildTransform(),t=ezasm.getlocalTrans(this._target._handle),e=this._targetRev!=this._target._rev,this._targetRev=this._target._rev);var i=this._handle;if(!ezasm.getlocalTrans(i)||e){var r=ezasm.buildLocalTrans(i,t);this._rev!=r&&(this._transform=null,this._rev=r)}},i.prototype._prepare=function(t,e,i){var r=this._handle;this._buildTransform(),!i&&ezasm.getglobalTrans(r)||ezasm.buildGlobalTrans(r,e),this.culled=this._parent.culling&&ezasm.cullingTest(r,t.left,t.top,t.right,t.bottom)},Object.defineProperty(i.prototype,"disposed",{get:function(){return 0===this._handle},enumerable:!0,configurable:!0}),i.prototype.dispose=function(){this._parent?this._parent.remove(this):Log.warn("the sprite has been disposed")},i.prototype.setDirty=function(t){void 0===t&&(t=!1),this._parent&&this.visible&&this._parent.makeDirty(t)},Object.defineProperty(i.prototype,"localTransform",{get:function(){return this._buildTransform(),this._transform||(this._transform=e(ezasm.getlocalTrans(this._handle))),this._transform},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalTransform",{get:function(){var t=ezasm.getglobalTrans(this._handle);if(t)return e(t);var i=this.localTransform.clone(),r=this._parent.globalTransform;return r&&i.append(r),i},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return ezasm.getVisible(this._handle)},set:function(t){this._parent&&this._parent.makeDirty(!1),ezasm.setVisible(this._handle,t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"effect",{get:function(){return this._effect},set:function(e){t.Effect.has(e)?this._effect!=e&&(this.setDirty(),this._effect=e):Log.error("effect "+name+" is not exist!")},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"effectParams",{set:function(t){this._effectParams=t,this.setDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"color",{get:function(){return this._color},set:function(t){t||(t="#ffffff"),t!=this._color&&(this.setDirty(),this._color=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"zIndex",{get:function(){return void 0===this._zIndex?0:this._zIndex},set:function(t){t!==this._zIndex&&(this._zIndex=t,this.setDirty(!0))},enumerable:!0,configurable:!0}),i.prototype.hitTest=function(t,e){return t>=0&&e>=0&&t<this.width&&e<this.height},i.prototype.setParent=function(t){if(this.disposed)throw new Error("the sprite has been disposed");t.addChild(this,this.id),this._parent._remove(this),this._parent=t},Object.defineProperty(i.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),i.prototype.link=function(t){this._target=t,this._targetRev=-1},i.prototype.unlink=function(){this._target=void 0},Object.defineProperty(i.prototype,"opacity",{get:function(){return void 0===this._opacity?1:this._opacity},set:function(t){this._opacity!==t&&(this._opacity=t,this.setDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"blendMode",{get:function(){return void 0===this._blendMode?t.BlendMode.Normal:this._blendMode},set:function(t){this._blendMode!==t&&(this._blendMode=t,this.setDirty())},enumerable:!0,configurable:!0}),i.types={},i}();t.Sprite=i,t.initCall((function(){function t(t,e,r){Object.defineProperty(i.prototype,t,{get:function(){var t=this._handle;if(t)return e(t)},set:function(t){var e=this._handle;e&&r(e,t)&&this.setDirty()},enumerable:!0,configurable:!0})}for(var e=["x","y","scaleX","scaleY","scale","width","height","anchorX","anchorY","angle","skew"],r=0;r<e.length;r++){var n=e[r];t(n,ezasm["get"+n],ezasm["set"+n])}t("mirrorH",ezasm.getMirrorH,ezasm.setMirrorH),t("mirrorV",ezasm.getMirrorV,ezasm.setMirrorV)}))}(ez||(ez={})),function(ez){var parse;!function(parse){var defGradientFill={x0:0,y0:0,x1:0,y1:0,colors:["#000000","#ffffff"]},defSeqFrame={prefix:"",frames:"",from:0,count:0,fps:30,loop:!1},JsObject=function(){function t(){}return t.prototype.isJSON=function(){return!0},t.prototype.toString=function(){var t="{ ",e=!0;for(var i in this)e||(t+=" ,"),t+=i+":"+("string"==typeof this[i]?"'"+this[i]+"'":this[i]),e=!1;return t+=" }"},t}();function parseObject(val,def){if("string"==typeof val&&(val=eval("("+val+")")),!val)return null;var obj=new JsObject;if(def){for(var k in def)void 0===val[k]?Object.defineProperty(obj,k,{value:def[k],writable:!0,enumerable:!1,configurable:!0}):obj[k]=val[k];return obj}for(var k in val)obj[k]=val[k];return obj}function GradientFill(t){if(t)return parseObject(t,defGradientFill)}function Dimension(t){var e=typeof t;return"number"===e?new ez.Dimension(t):"string"===e?""===t?void 0:new ez.Dimension(t):"object"===e?t:void 0}function Boolean(t){if("string"==typeof t){var e=t;return"true"==e.toLowerCase()||1==e}return!!t}function Float(t){if("string"==typeof t){if(""==t)return;return parseFloat(t)}return t}function Int(t){if("string"==typeof t){if(""==t)return;return parseInt(t)}return t}function SeqFrameDesc(t){if(t)return parseObject(t,defSeqFrame)}function ImageSrc(t){if("string"==typeof t){if(/^http:\/\/.+/.test(t))return ez.getExternalRes(t,4);if(""==t)return;return ez.getRes(t)}return t}function CSV(t){"\n"!=(t=t.replace(new RegExp("\r\n","gm"),"\n"))[t.length-1]&&(t+="\n");for(var e=[],i=[],r=!1,n="",a=0;a<t.length;++a){var o=t[a];r?'"'==o?(a<t.length-1&&'"'==t[a+1]&&(n+=o),r=!1):n+=o:","==o?(i.push(n),n=""):"\r"==o?("\n"==t[a+1]&&a++,i.push(n),n="",e.push(i),i=[]):"\n"==o?(i.push(n),n="",e.push(i),i=[]):'"'==o?r=!0:n+=o}return e}function Numbers(t){return Array.isArray(t)?t:t.split(",").map((function(t){return parseFloat(t)}))}function Number4(t){if(Array.isArray(t))return t;var e=t.split(",");return[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])]}function JSObj(val){return"string"==typeof val?eval("("+val+")"):val}function Enums(t,e){for(var i=t.split("|"),r=0,n=0;n<i.length;n++)e[i[n]]&&(r|=e[i[n]]);return r}function getEnumParser(t){return function(e){return"string"==typeof e?Enums(e,t):e}}parse.GradientFill=GradientFill,parse.Dimension=Dimension,parse.Boolean=Boolean,parse.Float=Float,parse.Int=Int,parse.SeqFrameDesc=SeqFrameDesc,parse.ImageSrc=ImageSrc,parse.CSV=CSV,parse.Numbers=Numbers,parse.Number4=Number4,parse.JSObj=JSObj,parse.Enums=Enums,parse.getEnumParser=getEnumParser}(parse=ez.parse||(ez.parse={}))}(ez||(ez={})),function(t){!function(e){var i=t.parse,r={},n={};function a(t){return r[t]}e.registerTemplates=function(t){for(var e in t)n[t[e].name]=t[e]},e.getTemplate=function(t){var e=n[t];return e||Log.warn("not find template "+t),e},e.registerTextStyle=function t(e){if(Array.isArray(e))for(var i=0;i<e.length;i++)t(e[i]);else r[e.id]=e,e.toString=function(){return this.id}},e.getTextStyle=a,e.getTextStyleNames=function(){return Object.getOwnPropertyNames(r)};var o,s={};function h(t,e){Object.defineProperty(t,e,{get:function(){return this.getProp(e)},set:function(t){this.setProp(e,t)},enumerable:!0,configurable:!0})}function l(t,e,i){var r=t;function n(t,e){for(var i in e)t[i]=e[i]}if(r.baseclass=e,r._properties={},r._propDefaults={},r._propConverters={},e){var a=e;n(r._properties,a._properties),n(r._propDefaults,a._propDefaults),n(r._propConverters,a._propConverters)}if(r.Properties)for(var o=r.Properties,l=0;l<o.length;l++){var c=o[l];c.customProperty||h(r.prototype,c.name),r._properties[o[l].name]="",void 0!==c.default&&(r._propDefaults[c.name]=c.default),c.converter&&(r._propConverters[c.name]=c.converter)}if(!i){var u=r.ClassName;if(s.hasOwnProperty(u))throw new Error("the gui class name conflict! name="+u);s[u]=r}}function c(t,e){return t?t.calcSize(e):void 0}function u(t){return"number"==typeof t}function f(t,e){var i={};return i.left=c(this.left,t),i.right=c(this.right,t),i.top=c(this.top,e),i.bottom=c(this.bottom,e),i.x=c(this.x,t),i.y=c(this.y,e),u(i.left)&&u(i.right)?i.width=Math.max(0,t-i.right-i.left):i.width=c(this.width,t),u(i.top)&&u(i.bottom)?i.height=Math.max(0,e-i.bottom-i.top):i.height=c(this.height,e),i}function d(e,i,r){return u(r.left)||(u(r.right)?r.left=e-r.right-r.width:u(r.x)?r.left=r.x-this.anchorX*r.width:r.left=0),u(r.top)||(u(r.bottom)?r.top=i-r.bottom-r.height:u(r.y)?r.top=r.y-this.anchorY*r.height:r.top=0),new t.Rect(r.left,r.top,r.width,r.height)}function p(){if(this._p){this.disposed=!0;var t=this._p._events;this._p=null;var e=this.name,i=t[e];if(Array.isArray(i)){var r=i.indexOf(this);-1!=r&&i.splice(r,1)}else i==this&&delete t[e]}}function g(){this.childSizeChanged?this.childSizeChanged():(this._sizeDirty||g.call(this._parent),this._sizeDirty=!0)}function m(t,e,i,r,n,a,o,s,h,l,c,u,f,d,p,g,m,_,v,y,b,x){var w={};if(w.class=t,void 0!==l&&(w.x=l),void 0!==c&&(w.y=c),void 0!==r&&(w.left=r),void 0!==n&&(w.top=n),void 0!==a&&(w.right=a),void 0!==o&&(w.bottom=o),void 0!==s&&(w.width=s),void 0!==h&&(w.height=h),void 0!==u&&(w.opacity=u),void 0!==f&&(w.visible=f),void 0!==d&&(w.scale=d),void 0!==p&&(w.angle=p),void 0!==g&&(w.anchorX=g),void 0!==m&&(w.anchorY=m),void 0!==_&&(w.zIndex=_),void 0!==v&&(w.touchable=v),void 0!==i&&(w.id=i),e)for(var T in e)w[T]=e[T];return b&&(w._array=b),y&&(w.childsProperty=y),x&&(w._childs=x),w}e.getAllGuiClassNames=function(){return Object.getOwnPropertyNames(s)},e.getGuiClass=function(t){return s[t]},e.createUIElement=function(t,e){var i=s[t];if(!i)throw new Error("the ui class:'"+t+"' is not exist!");return new i(e)},e.initUIClass=l;var _=function(e){function r(i){var n=e.call(this)||this;n._bound=null,n._events={},n._init(r);var a=["left","top","right","bottom","width","height","x","y","anchorX","anchorY"];function o(){this._bound=null,g.call(this._parent)}for(var s in a)n.addObserver(a[s],o,n);return n._parent=i,n.onCreate&&t.callNextFrame((function(){this.disposed||this.onCreate()}),n),n}return __extends(r,e),r.hasProperty=function(t){return this._properties.hasOwnProperty(t)},r.prototype._setProps=function(t){for(var e in t)"class"!==e&&"id"!==e&&"_array"!==e&&("childsProperty"===e||"_childs"===e?Log.error(this.class.ClassName+" can't have childs"):this[e]=t[e])},r.prototype._init=function(t){this.setDefaults(t._propDefaults),this.setPropConverters(t._propConverters)},r.prototype._fireEvent=function(t){if(!this.disposed){var e=this._events[t.name],i=this.parent;if(e){if(Array.isArray(e))for(var r=0;r<e.length;r++)e[r].func.call(e[r].ctx,t);else e.func.call(e.ctx,t);t.bubble&&i._fireEvent(t)}else i._fireEvent(t)}},r.prototype.fireEvent=function(t,e,i){void 0===i&&(i=!1),this._fireEvent({name:t,arg:e,bubble:i,sender:this})},r.prototype.addEventHandler=function(t,e,i){var r={name:t,func:e,ctx:i,_p:this,disposed:!1,dispose:p};if(this._events[t]){var n=this._events[t];Array.isArray(n)?n.push(r):this._events[t]=[n,r]}else this._events[t]=r;return r},r.prototype.dispose=function(){this.disposed?Log.error("the element has been disposed."):(this._parent._removeChild(this),this._parent=null,this._bound=null,t.Tween.stopTweens(this),e.prototype.dispose.call(this))},Object.defineProperty(r.prototype,"class",{get:function(){return this.constructor},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),r.prototype.textStyleChanged=function(){},Object.defineProperty(r.prototype,"parentStage",{get:function(){return this._parent._displayStage},enumerable:!0,configurable:!0}),r.prototype.getBound=function(){return this._bound},r.prototype.screenToClient=function(t,e){return this._bound&&(t-=this._bound.left,e-=this._bound.top),this.parent.screenToClient(t,e)},r.prototype.clientToScreen=function(t,e){return this._bound&&(t+=this._bound.left,e+=this._bound.top),this.parent.clientToScreen(t,e)},r.prototype.setBound=function(t){this._bound=t,this.fireEvent("boundChange",t,!1)},r.prototype.measureBound=function(t,e,i){if(void 0===i&&(i=!1),i||!this._bound){var r=f.call(this,t,e);r.width=r.width||0,r.height=r.height||0,this._bound=d.call(this,t,e,r),this.fireEvent("boundChange",this._bound,!1)}},r.prototype.ptInBound=function(t,e){return this._bound&&this.touchable&&this.visible&&this._bound.contains(t,e)},r.prototype.hitTest=function(t,e){return!1},r.prototype.findControls=function(t,e){return this.ptInBound(t,e)?(t-=this._bound.left,e-=this._bound.top,this.hitTest(t,e)?[]:null):null},r.prototype.findElements=function(t,e,i){this.ptInBound(t,e)&&(t-=this._bound.left,e-=this._bound.top,this.hitTest(t,e)&&i.push(this))},r.ClassName="Element",r.Properties=[{name:"x",type:"number|string|Dimension",converter:i.Dimension,validate:"dimension"},{name:"y",type:"number|string|Dimension",converter:i.Dimension,validate:"dimension"},{name:"left",type:"number|string|Dimension",converter:i.Dimension,validate:"dimension"},{name:"top",type:"number|string|Dimension",converter:i.Dimension,validate:"dimension"},{name:"right",type:"number|string|Dimension",converter:i.Dimension,validate:"dimension"},{name:"bottom",type:"number|string|Dimension",converter:i.Dimension,validate:"dimension"},{name:"width",type:"number|string|Dimension",converter:i.Dimension,validate:"dimension"},{name:"height",type:"number|string|Dimension",converter:i.Dimension,validate:"dimension"},{name:"opacity",default:1,type:"number",converter:i.Float,validate:"opacity"},{name:"visible",default:!0,type:"boolean",converter:i.Boolean},{name:"scaleX",default:1,type:"number",converter:i.Float,validate:"scale"},{name:"scaleY",default:1,type:"number",converter:i.Float,validate:"scale"},{name:"scale",default:1,type:"number",converter:i.Float,validate:"scale"},{name:"angle",default:0,type:"number",converter:i.Float,validate:"angle"},{name:"anchorX",default:.5,type:"number",converter:i.Float,validate:"float"},{name:"anchorY",default:.5,type:"number",converter:i.Float,validate:"float"},{name:"zIndex",default:0,type:"number",converter:i.Int,validate:"int"},{name:"touchable",default:!0,type:"boolean",converter:i.Boolean}],r}(t.DataModel);e.Element=_,l(_,null,!0);var v=function(e){function r(i,n){var a=e.call(this,i)||this;return a._childs=[],a._sizeDirty=!1,a._namedChilds={},a.setDefaults(r._propDefaults),a.setPropConverters(r._propConverters),n=n||new t.SubStageSprite(a.parentStage),a._stage=n,a.bind("culling",n),a.bind("opacity",n),a.bind("visible",n),a.bind("scaleX",n),a.bind("scaleY",n),a.bind("scale",n),a.bind("angle",n),a.bind("clip",n),a.bind("zIndex",n),a.bind("ownerBuffer",n),a.bind("drawCache",n),a.bind("batchMode",n),a.addObserver("textStyle",a.textStyleChanged,a),a.addEventHandler("boundChange",(function(t){var e=this._bound;e&&(n.width=e.width,n.height=e.height,n.anchorX=this.anchorX,n.anchorY=this.anchorY,n.x=e.left+n.anchorX*e.width,n.y=e.top+n.anchorY*e.height)}),a),a}return __extends(r,e),r.prototype._removeChild=function(t){var e=this._childs.indexOf(t);if(-1==e)throw new Error("child not exist!");this._childs.splice(e,1)},r.prototype._setChilds=function(t){for(var e=0;e<t.length;e++){var i=t[e];Array.isArray(i)&&(i=m.apply(null,i));var r=s[i.class];if(!r)throw new Error(i.class+" is not exist!");if(i._array){var n=[];o&&i.id&&(o[i.id]=n);var a={};for(var h in i)"_array"!==h&&(a[h]=i[h]);for(var l=0;l<i._array.length;l++){i.id&&(a.id=i.id+l);var c=this.createChild(r,a);c._setProps(i._array[l]),n.push(c)}}else this.createChild(r,i)}},r.prototype._setProps=function(t){for(var e in t)"class"!==e&&"id"!==e&&"_array"!==e&&("_childs"===e?this.class.HasChildElements?this.setChilds(t[e]):Log.error("The "+this.class.ClassName+" can't has childs!"):this[e]=t[e])},r.prototype._createChilds=function(t){var e=o;o=this._namedChilds,this._setChilds(t),o=e},r.prototype.find=function(t,e){if(this._namedChilds[t])return this._namedChilds[t];if(!e)return null;for(var i=0;i<this._childs.length;i++){var r=this._childs[i];if("function"==typeof r.find){var n=r.find(t,e);if(n)return n}}return null},r.prototype.clearChilds=function(){for(var t=this._childs.concat(),e=0;e<t.length;e++)t[e].dispose()},r.prototype.dispose=function(){this.disposed?Log.error("the control has been disposed!"):(this.clearChilds(),this._childs=null,this._stage.dispose(),this._stage=null,e.prototype.dispose.call(this))},Object.defineProperty(r.prototype,"childCount",{get:function(){return this._childs.length},enumerable:!0,configurable:!0}),r.prototype.getChild=function(t){if(t<0||t>=this._childs.length)throw new RangeError;return this._childs[t]},Object.defineProperty(r.prototype,"_displayStage",{get:function(){return this._stage},enumerable:!0,configurable:!0}),r.prototype.textStyleChanged=function(){for(var t in this._childs){this._childs[t].textStyleChanged()}},r.prototype.createChild=function(t,e){var i=s[t.ClassName];if(!i)throw new Error(t.ClassName+" is not registered.");var r,a=null==e?void 0:e.template;a&&((r=n[a])||Log.error("template '"+a+"' is not exist!"));var h=new i(this,r);return this._childs.push(h),g.call(this),e&&(h._setProps(e),e.id&&(this._namedChilds[e.id]&&Log.warn("child id conflict.",this._namedChilds,e.id),this._namedChilds[e.id]=h,o&&o!=this._namedChilds&&(o[e.id]&&Log.warn("child id conflict.",o,e.id),o[e.id]=h),h._id=e.id)),h},r.prototype.measureBound=function(t,e,i){if(void 0===i&&(i=!1),i||!this._bound){var r=f.call(this,t,e);if(void 0===r.width||void 0===r.height){for(var n=r.width||0,a=(r.height,0),o=0,s=0;s<this._childs.length;s++){var h=this._childs[s];h.measureBound(n,a,!1);var l=h.getBound();a=Math.max(a,l.right),o=Math.max(o,l.bottom)}r.width=r.width||a,r.height=r.height||o}this._bound=d.call(this,t,e,r),this.fireEvent("boundChange",this._bound,!1)}if(this._lastBound&&this._lastBound.width==this._bound.width&&this._lastBound.height==this._bound.height){if(this._sizeDirty)for(s=0;s<this._childs.length;s++){this._childs[s].measureBound(this._bound.width,this._bound.height,!1)}}else{this._lastBound;this._lastBound=this._bound;for(var s=0;s<this._childs.length;s++){this._childs[s].measureBound(this._bound.width,this._bound.height,!0)}}this._sizeDirty=!1},r.prototype.findControls=function(t,e){if(!this.ptInBound(t,e))return null;t-=this._bound.left,e-=this._bound.top;for(var i=this._childs.length-1;i>=0;i--){var r=this._childs[i].findControls(t,e);if(r)return r}return this.hitTest(t,e)?[]:null},r.prototype.findElements=function(t,e,i){if(this.ptInBound(t,e)){t-=this._bound.left,e-=this._bound.top;for(var r=this._childs.length-1;r>=0;r--)this._childs[r].findElements(t,e,i);this.hitTest(t,e)&&i.push(this)}},r.prototype._setStyle=function(t){for(var e in t)"childsProperty"==e?this.childsProperty=t[e]:this[e]=t[e]},Object.defineProperty(r.prototype,"style",{get:function(){return this._style},set:function(t){if(t){if(!this.class.Styles||!this.class.Styles[t])throw new Error("style "+t+" is not exist in "+this.class.ClassName+".");this._setStyle(this.class.Styles[t]),this._style=t}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"childsProperty",{set:function(t){for(var e in t){var i=this._namedChilds[e];if(i){var r=t[e];for(var n in r)"style"===n||i.class.hasProperty(n)?i[n]=r[n]:Log.warn("The UI["+i.class.ClassName+"] has no '"+n+"' property!")}else Log.warn("namedChild '"+e+"' is not exist.")}},enumerable:!0,configurable:!0}),r.ClassName="Container",r.Properties=[{name:"culling",default:!1,type:"boolean",converter:i.Boolean},{name:"clip",default:!1,type:"boolean",converter:i.Boolean},{name:"drawCache",default:!1,type:"boolean",converter:i.Boolean},{name:"batchMode",default:!1,type:"boolean",converter:i.Boolean},{name:"ownerBuffer",default:!1,type:"boolean",converter:i.Boolean},{name:"textStyle",type:"string",validate:"textStyle"}],r}(_);e.Container=v,l(v,_,!0);var y=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.setChilds=function(t){this.clearChilds(),this._setChilds(t)},e.ClassName="Group",e.Properties=[],e.HasChildElements=!0,e}(v);e.Group=y,l(y,v);var b,x=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.mixins=function(t){for(var e=t.prototype,i=this.prototype,r=0,n=Object.getOwnPropertyNames(e);r<n.length;r++){var a=n[r];"constructor"!=a&&(i[a]=e[a])}},e.checkStates=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!this.States)throw new Error("the control has no states table.");for(var i=0;i<t.length;i++){var r=t[i];if(!this.States[r])throw new Error("states["+r+"] is missing!")}},e.prototype.hitTest=function(e,i){return!!this.hittable||t.prototype.hitTest.call(this,e,i)},e.prototype._setStyle=function(t){for(var e in t)"childsProperty"===e?this.childsProperty=t[e]:"States"===e?(this._states=t.States,this._stateChange(this.state,this.state)):this[e]=t[e]},e.prototype.findControls=function(t,e){if(!this.ptInBound(t,e))return null;t-=this._bound.left,e-=this._bound.top;for(var i=this._childs,r=i.length-1;r>=0;r--){var n=i[r].findControls(t,e);if(n)return n.push(this),n}return this.hitTest(t,e)?[this]:null},e.prototype._stateChange=function(t,e){var i=this._states[e],r=this._states[t];if(!i||!r)throw new Error("unknown state.");var n=r.props;if(i.onLeave&&i.onLeave(this,t),n)for(var a in n)if("childsProperty"===a){var o=n[a];for(var s in o){var h=this._namedChilds[s];if(h){var l=o[s];for(var c in l)if("style"===c||h.class.hasProperty(c)){var u=l[c];h[c]="function"==typeof u?u.call(this):u}else Log.warn("The UI["+h.class.ClassName+"] has no '"+s+"' property!")}else Log.warn("namedChild '"+a+"' is not exist.")}}else{u=n[a];this[a]="function"==typeof u?u.call(this):u}r.onEnter&&r.onEnter(this,e)},e.prototype._initStates=function(t,e){this._states=e,this.state=t,this.addObserver("state",this._stateChange,this),this._stateChange(t,t)},e.ClassName="Control",e.Properties=[{name:"state",default:null,type:"string"},{name:"hittable",type:"boolean"}],e}(v);e.Control=x,l(x,v),function(t){t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical",t[t.All=3]="All"}(b=e.ScrollMode||(e.ScrollMode={}));var w,T=function(e){function r(i){var n=e.call(this,i)||this;return n._init(r),n._scrollStage=new t.SubStageSprite(n._stage),n.bind("xScroll",n._scrollStage,"x",r.convScroll),n.bind("yScroll",n._scrollStage,"y",r.convScroll),n.clip=!0,n}return __extends(r,e),r.convScroll=function(t){return-t},r.prototype.dispose=function(){e.prototype.dispose.call(this),this._ticker&&(t.removeTicker(this._ticker),this._ticker=null)},r.prototype.getScrollRange=function(){var e=this.getBound()||new t.Rect(0,0,1,1),i=e,r=[this.scrollWidth,this.scrollHeight];if(!r[0]||!r[1]){r[0]=r[0]||e.width,r[1]=r[1]||e.height;for(var n=0;n<this._childs.length;n++){var a=this._childs[n];(e=a.getBound())||(a.measureBound(i.width,i.height),e=a.getBound()),r[0]=Math.max(r[0],e.right),r[1]=Math.max(r[1],e.bottom)}r[0]=this.scrollWidth||r[0],r[1]=this.scrollHeight||r[1]}return r},r.prototype.screenToClient=function(t,e){var i=this._bound;return i&&(t-=i.left-this.xScroll,e-=i.top-this.yScroll),this.parent.screenToClient(t,e)},r.prototype.clientToScreen=function(t,e){var i=this._bound;return i&&(t+=i.left-this.xScroll,e+=i.top-this.yScroll),this.parent.clientToScreen(t,e)},r.prototype.findControls=function(t,e){if(!this.ptInBound(t,e))return null;t-=this._bound.left-this.xScroll,e-=this._bound.top-this.yScroll;for(var i=this._childs.length-1;i>=0;i--){var r=this._childs[i].findControls(t,e);if(null!=r)return r.push(this),r}return[this]},Object.defineProperty(r.prototype,"_displayStage",{get:function(){return this._scrollStage},enumerable:!0,configurable:!0}),r.prototype.setChilds=function(t){this.clearChilds(),this._setChilds(t)},r.ClassName="ScrollView",r.HasChildElements=!0,r.Properties=[{name:"xScroll",default:0,type:"number",converter:i.Float,validate:"float"},{name:"yScroll",default:0,type:"number",converter:i.Float,validate:"float"},{name:"scrollWidth",default:0,type:"number",converter:i.Float,validate:"float"},{name:"scrollHeight",default:0,type:"number",converter:i.Float,validate:"float"},{name:"scrollMode",default:b.All,type:"ScrollMode",converter:i.getEnumParser(b)}],r}(x);e.ScrollView=T,l(T,x),(w=T).prototype.onTouchBegin=function(e){this._startPos||(this._ticker&&(t.removeTicker(this._ticker),this._ticker=null),this._touchId=e.id,this._lastPos=new t.Point(e.screenX,e.screenY),this._startPos=new t.Point(e.screenX,e.screenY),this._lastVol=new t.Point(0,0),this._startScrollPos=new t.Point(this.xScroll,this.yScroll),t.Tween.stopTweens(this),e.capture(),e.bubble=!1)},w.prototype.onTouchMove=function(t){if(this._startPos&&this._touchId==t.id){var e=t.screenX-this._startPos.x,i=t.screenY-this._startPos.y,r=this._startScrollPos.x-e,n=this._startScrollPos.y-i,a=this.scrollMode;(Math.abs(e)>5||Math.abs(i)>5)&&t.excludeCapture();var o=1/(t.time-this._lastMoveTime+1),s=(t.screenX-this._lastPos.x)*o,h=(t.screenY-this._lastPos.y)*o;Math.abs(s)>Math.abs(this._lastVol.x)?this._lastVol.x=.5*s+.5*this._lastVol.x:this._lastVol.x=s,Math.abs(h)>Math.abs(this._lastVol.y)?this._lastVol.y=.5*h+.5*this._lastVol.y:this._lastVol.y=h,this._lastMoveTime=t.time,this._lastPos.x=t.screenX,this._lastPos.y=t.screenY,r<0&&(r*=.4),n<0&&(n*=.4);var l=this.getScrollRange(),c=l[0]-this._bound.width,u=l[1]-this._bound.height;r>c&&(r=c+.4*(r-c)),n>u&&(n=u+.4*(n-u)),a&b.Horizontal&&(this.xScroll=r),a&b.Vertical&&(this.yScroll=n)}},w.prototype.onTouchEnd=function(e){var i=this;if(this._startPos&&this._touchId==e.id){this._startPos=void 0,this._startScrollPos=void 0;var r=this.xScroll,n=this.yScroll,a={},o=this.scrollMode,s=this.getScrollRange(),h=s[0]-this._bound.width,l=s[1]-this._bound.height,c=o&b.Horizontal,u=o&b.Vertical,f=t.Tween.add(this);if(r<0&&c&&(a.xScroll=[r,0]),n<0&&u&&(a.yScroll=[n,0]),r>h&&c&&(a.xScroll=[r,h]),n>l&&u&&(a.yScroll=[n,l]),void 0!==a.yScroll||void 0!==a.xScroll)f.move(a,100),f.play();else{var d=this._lastVol.x,p=this._lastVol.y;c||(d=0),u||(p=0);var g=d<0?-1:1,m=p<0?-1:1;function _(){var t=this.yScroll,e=this.xScroll;if(d>0&&(d=(e-=16*d*g)<0||e>h?Math.max(0,d-.5):Math.max(0,d-.02),this.xScroll-=16*d*g,e=this.xScroll),p>0&&(p=(t-=16*p*m)<0||t>l?Math.max(0,p-.5):Math.max(0,p-.02),this.yScroll-=16*p*m,t=this.yScroll),0==d&&0==p){var i={};return e<0&&c&&(i.xScroll=[e,0]),t<0&&u&&(i.yScroll=[t,0]),e>h&&c&&(i.xScroll=[e,h]),t>l&&u&&(i.yScroll=[t,l]),void 0===i.yScroll&&void 0===i.xScroll||(f.move(i,100),f.play()),!1}return!0}d=Math.min(5,Math.abs(d)),p=Math.min(5,Math.abs(p)),this._ticker=t.addTicker((function(e){for(var r=0;r<e;r+=16)if(!_.call(i)){t.removeTicker(i._ticker);break}}),this)}}};var C,S=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.getScrollRange=function(){return[this.scrollWidth*this.scale,this.scrollHeight*this.scale]},e.prototype.screenToClient=function(t,e){var i=this._bound;i&&(t-=i.left-this.xScroll,e-=i.top-this.yScroll);var r=this.scale;return t*=r,e*=r,this.parent.screenToClient(t,e)},e.prototype.clientToScreen=function(t,e){var i=this._bound;i&&(t+=i.left-this.xScroll,e+=i.top-this.yScroll);var r=1/this.scale;return t*=r,e*=r,this.parent.clientToScreen(t,e)},e.prototype.findControls=function(t,e){if(!this.ptInBound(t,e))return null;t-=this._bound.left-this.xScroll,e-=this._bound.top-this.yScroll;var i=this.scale;t*=i,e*=i;for(var r=this._childs.length-1;r>=0;r--){var n=this._childs[r].findControls(t,e);if(null!=n)return n.push(this),n}return[this]},e.ClassName="ScaleScrollView",e.HasChildElements=!0,e.Properties=[{name:"scaleRange",default:[1,2],type:"Number2",converter:i.Numbers,validate:"int2"},{name:"scaleRamp",default:.1,type:"number",converter:i.Float,validate:"float"}],e}(T);e.ScaleScrollView=S,l(S,T),function(e){e.prototype.onTouchBegin=function(e){if(!this._pt2){if(!this._pt1&&this._ticker&&(t.removeTicker(this._ticker),this._ticker=null),this._pt1){e.excludeCapture(),this._pt2={id:e.id,x:e.screenX,y:e.screenY};var i=this._pt1.x-this._pt2.x,r=this._pt1.y-this._pt2.y;this._startScale=this.scale/Math.sqrt(i*i+r*r)}else this._pt1={id:e.id,x:e.screenX,y:e.screenY},this._startScrollPos=new t.Point(this.xScroll,this.yScroll);t.Tween.stopTweens(this),e.capture(),e.bubble=!1}},e.prototype.onTouchMove=function(t){var e,i,r=(e=this,i=t.id,e._pt1&&e._pt1.id==i?e._pt1:e._pt2&&e._pt2.id==i?e._pt2:null);if(r)if(this._pt2){r.x=t.screenX,r.y=t.screenY;var n=this._pt1.x-this._pt2.x,a=this._pt1.y-this._pt2.y,o=Math.sqrt(n*n+a*a),s=this._startScale*o;s<(d=this.scaleRange)[0]?s=d[0]+(s-d[0])*this.scaleRamp:s>d[1]&&(s=d[1]+(s-d[1])*this.scaleRamp),this.scale=s}else{n=t.screenX-this._pt1.x,a=t.screenY-this._pt1.y;var h=this._startScrollPos.x-n,l=this._startScrollPos.y-a;(Math.abs(n)>5||Math.abs(a)>5)&&t.excludeCapture();var c=1/(t.time-this._lastMoveTime+1),u=(t.screenX-this._lastPos.x)*c,f=(t.screenY-this._lastPos.y)*c;Math.abs(u)>Math.abs(this._lastVol.x)?this._lastVol.x=.5*u+.5*this._lastVol.x:this._lastVol.x=u,Math.abs(f)>Math.abs(this._lastVol.y)?this._lastVol.y=.5*f+.5*this._lastVol.y:this._lastVol.y=f,this._lastMoveTime=t.time,this._lastPos.x=t.screenX,this._lastPos.y=t.screenY,h<0&&(h*=.4),l<0&&(l*=.4);var d,p=(d=this.getScrollRange())[0]-this._bound.width,g=d[1]-this._bound.height;h>p&&(h=p+.4*(h-p)),l>g&&(l=g+.4*(l-g)),this.xScroll=h,this.yScroll=l}},e.prototype.onTouchEnd=function(e){var i=this;if(this._pt1)if(this._pt2)this._pt2=null;else{this._startPos=void 0,this._startScrollPos=void 0;var r=this.xScroll,n=this.yScroll,a={},o=this.getScrollRange(),s=o[0]-this._bound.width,h=o[1]-this._bound.height,l=t.Tween.add(this);if(r<0&&(a.xScroll=[r,0]),n<0&&(a.yScroll=[n,0]),r>s&&(a.xScroll=[r,s]),n>h&&(a.yScroll=[n,h]),void 0!==a.yScroll||void 0!==a.xScroll)l.move(a,100),l.play();else{var c=this._lastVol.x,u=this._lastVol.y,f=c<0?-1:1,d=u<0?-1:1;function p(){var t=this.yScroll,e=this.xScroll;if(c>0&&(c=(e-=16*c*f)<0||e>s?Math.max(0,c-.5):Math.max(0,c-.02),this.xScroll-=16*c*f,e=this.yScroll),u>0&&(u=(t-=16*u*d)<0||t>h?Math.max(0,u-.5):Math.max(0,u-.02),this.yScroll-=16*u*d,t=this.yScroll),0==c&&0==u){var i={};return e<0&&(i.xScroll=[e,0]),t<0&&(i.yScroll=[t,0]),e>s&&(i.xScroll=[e,s]),t>h&&(i.yScroll=[t,h]),void 0===i.yScroll&&void 0===i.xScroll||(l.move(i,100),l.play()),!1}return!0}c=Math.min(5,Math.abs(c)),u=Math.min(5,Math.abs(u)),this._ticker=t.addTicker((function(e){for(var r=0;r<e;r+=16)if(!p.call(i)){t.removeTicker(i._ticker);break}}),this)}}}}(S),function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Wrap=2]="Wrap"}(C=e.LayoutMode||(e.LayoutMode={}));var A=function(e){function r(t){var i=e.call(this,t)||this;return i._childChange=!1,i._init(r),i.addEventHandler("boundChange",(function(t){this.calcLayout()}),i),i}return __extends(r,e),r.prototype.HornLayout=function(){for(var t=this.itemPadding,e=t?t[0]:0,i=t?t[1]:0,r=t?t[2]:0,n=0;n<this._childs.length;n++){var a=this._childs[n];if(a.visible){var o=a.getBound();o.left=e,o.top=i,e+=o.width+r,a.setBound(o)}}},r.prototype.VertLayout=function(){for(var t=this.itemPadding,e=t?t[0]:0,i=t?t[1]:0,r=t?t[3]:0,n=0;n<this._childs.length;n++){var a=this._childs[n];if(a.visible){var o=a.getBound();o.left=e,o.top=i,i+=o.height+r,a.setBound(o)}}},r.prototype.WrapLayout=function(){for(var t=this._bound.width,e=this.itemPadding,i=e?e[0]:0,r=e?e[1]:0,n=e?e[2]:0,a=e?e[3]:0,o=i,s=0;s<this._childs.length;s++){var h=this._childs[s];if(h.visible){var l=h.getBound();o>i&&o+l.width>t&&(o=i,r+=l.height+a),l.left=o,l.top=r,o+=l.width+n,h.setBound(l)}}},r.prototype.calcLayout=function(){if(this._bound)switch(this.layoutMode){case C.Vertical:this.VertLayout();break;case C.Horizontal:this.HornLayout();break;case C.Wrap:this.WrapLayout()}},r.prototype.childSizeChanged=function(){this._sizeDirty=!0,this._childChange=!0,g.call(this.parent)},r.prototype._createChild=function(){var t=this,i=e.prototype.createChild.call(this,s[this.itemClass]);return i.addObserver("visible",(function(){t._childChange=!0,g.call(t._parent)}),this),i},r.prototype.measureBound=function(e,i,r){var n;void 0===r&&(r=!1);var a=f.call(this,e,i);if(this._sizeDirty)for(n=0;n<this._childs.length;n++){this._childs[n].measureBound(a.width||e,a.height||i,r)}if(r||!this._bound||this._childChange){var o=this._bound;if(!a.width||!a.height)for(this._bound=new t.Rect(0,0,a.width||e,a.height||i),this.calcLayout(),a.width=a.width||0,a.height=a.height||0,n=0;n<this._childs.length;n++){var s=this._childs[n];if(s.visible){var h=s.getBound();a.width=Math.max(a.width,h.right+(this.itemPadding?this.itemPadding[2]:0)),a.height=Math.max(a.height,h.bottom+(this.itemPadding?this.itemPadding[3]:0))}}this._bound=d.call(this,e,i,a),t.Rect.equal(o,this._bound)||this.fireEvent("boundChange",this._bound,!1)}this._sizeDirty=!1},r.prototype.dispose=function(){e.prototype.dispose.call(this),this._source=null},r.prototype.createChild=function(t,e){throw new Error("List view can't create child element.")},r.prototype._createItem=function(t){var e=this._createChild();if(e.dataSource=t,this.item)for(var i in this.item)"style"===i?e.style=this.item[i]:e[i]=this.item[i];return e},r.prototype._onSrcChange=function(t,e,i){var r;switch(t){case 4:this.clearChilds();break;case 0:r=this._createItem(i),this._childs.pop(),this._childs.splice(e,0,r);break;case 2:(r=this._childs[e]).dispose();break;case 1:this._childs[e].dataSource=i}this._bound=null,g.call(this._parent)},Object.defineProperty(r.prototype,"childsProperty",{set:function(t){t.item?this.item=t.item:Log.warn("not find item properties.")},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"items",{get:function(){return this._source||(this.items=new t.DataCollection),this._source},set:function(e){if(!this.itemClass)throw new Error("itemClass is missing");Array.isArray(e)?(this._source||(this._source=new t.DataCollection),this._source.clear(),this._source.addItems(e)):this._source=e,this._srcOb&&this._srcOb.dispose(),this.clearChilds();for(var i=this._source.items,r=0;r<i.length;r++)this._createItem(i[r]);this._srcOb=this._source.addObserver(this._onSrcChange,this),this._bound=null,g.call(this._parent)},enumerable:!0,configurable:!0}),r.ClassName="ListView",r.Properties=[{name:"itemClass",default:"",type:"string"},{name:"layoutMode",default:C.Vertical,type:"LayoutMode",converter:i.getEnumParser(C)},{name:"itemPadding",type:"Number4",converter:i.Number4,validate:"int4"},{name:"item",type:"Object",converter:i.JSObj}],r}(v);e.ListView=A,l(A,v);var P=function(t){function e(i){var r=t.call(this,i)||this;return r._init(e),r.addObserver("activePage",r.indexChanged,r),r}return __extends(e,t),e.prototype.indexChanged=function(t,e){if(this._slideTween){var i=this._childs[t];i.left=0,i.top=0,this._slideTween.stop()}for(var r=0;r<this._childs.length;r++)this._childs[r].visible=t==r},e.prototype.touchBegin=function(t){},e.prototype.touchMove=function(t){},e.prototype.touchEnd=function(t){},e.prototype.addPage=function(t,e){var i=this._childs.length,r=this.createChild(t,e);return r.visible=i==this.activePage,r},e.prototype.getPage=function(t){return this._childs[t]},e.prototype.setChilds=function(t){this.clearChilds(),this._setChilds(t);for(var e=0;e<this._childs.length;e++)this._childs[e].visible=this.activePage==e},e.prototype.touchSlide=function(t){this.onTouchBegin=this.touchBegin,this.onTouchEnd=this.touchEnd,this.onTouchMove=this.touchMove},e.prototype.slide=function(t,e){if(t<0||t>=this._childs.length)throw new Error("page index out of range.");var i=this._childs[this.activePage];this.activePage=t;var r=this._childs[t];i.visible=!0,this._slideTween=e(i,r).target(i).set({visible:!1}).play()},e.ClassName="StackView",e.HasChildElements=!0,e.Properties=[{name:"activePage",default:0,type:"number",converter:i.Int,validate:"int"}],e}(x);e.StackView=P,l(P,v);var k=function(e){function r(t,i){var n=e.call(this,t)||this;return n._sprite=i,n._init(r),n.bind("opacity",n._sprite),n.bind("visible",n._sprite),n.bind("angle",n._sprite),n.bind("blendMode",n._sprite),n.bind("scaleX",n._sprite),n.bind("scaleY",n._sprite),n.bind("scale",n._sprite),n.bind("zIndex",n._sprite),n.bind("mirrorH",n._sprite),n.bind("mirrorV",n._sprite),n.bind("effect",n._sprite),n.addEventHandler("boundChange",(function(t){var e=this._bound;if(e){var i=this._sprite;i.width=e.width,i.height=e.height,i.anchorX=this.anchorX,i.anchorY=this.anchorY,i.x=e.left+i.anchorX*e.width,i.y=e.top+i.anchorY*e.height}}),n),n}return __extends(r,e),Object.defineProperty(r.prototype,"sprite",{get:function(){return this._sprite},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"effectParams",{get:function(){return this._sprite.effectParams},set:function(t){this._sprite.effectParams=t},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){this._sprite.dispose(),this._sprite=null,e.prototype.dispose.call(this)},r.prototype.hitTest=function(t,e){return!0},r.ClassName="Visual",r.Properties=[{name:"effect",default:null,type:"string"},{name:"effectParams",default:null,type:"Object",converter:i.JSObj,customProperty:!0},{name:"blendMode",default:t.BlendMode.Normal,type:"BlendMode",converter:i.getEnumParser(t.BlendMode)},{name:"mirrorH",default:!1,type:"boolean",converter:i.Boolean},{name:"mirrorV",default:!1,type:"boolean",converter:i.Boolean}],r}(_);e.Visual=k,l(k,_,!0);var M=function(e){function r(i){var n=e.call(this,i,new t.RectFillSprite(i._displayStage))||this;return n._init(r),n.bind("color",n._sprite),n.bind("gradient",n._sprite),n}return __extends(r,e),r.ClassName="RectFill",r.Properties=[{name:"color",default:"#000000",type:"string",validate:"color"},{name:"gradient",default:null,type:"GradientFill",converter:i.GradientFill,validate:"GradientFill"}],r}(k);e.RectFill=M,l(M,k);var I=function(e){function r(i){var n=e.call(this,i,new t.ImageSprite(i._displayStage))||this;return n._init(r),n.bind("color",n._sprite),n.bind("src",n._sprite),n.bind("pattern",n._sprite),n.addObserver("src",(function(){this._bound=null,g.call(this._parent)}),n),n}return __extends(r,e),Object.defineProperty(r.prototype,"image",{set:function(t){this._sprite.src=t},enumerable:!0,configurable:!0}),r.prototype.hitTest=function(t,e){return this._sprite.hitTest(t,e)},r.prototype.measureBound=function(t,e,i){if(i||!this._bound){var r=f.call(this,t,e),n=this.src;void 0===r.width&&(r.width=n?n.getData().width:0),void 0===r.height&&(r.height=n?n.getData().height:0),this._bound=d.call(this,t,e,r),this.fireEvent("boundChange",this._bound,!1)}},r.ClassName="Image",r.Properties=[{name:"src",default:null,type:"string|ImageRes",converter:i.ImageSrc,validate:"resource"},{name:"color",default:"#ffffff",type:"string",validate:"color"},{name:"pattern",default:null,type:"string",validate:"pattern"}],r}(k);e.Image=I,l(I,k);var E=function(e){function r(i){var n=e.call(this,i,new t.SeqFrameSprite(i._displayStage))||this;return n._init(r),n.bind("color",n._sprite),n.bind("frames",n._sprite),n.bind("fps",n._sprite),n.bind("autoPlay",n._sprite),n.addObserver("frames",(function(t){this._bound=null,g.call(this._parent)}),n),n}return __extends(r,e),r.prototype.play=function(){this.sprite.play()},r.prototype.stop=function(){this.sprite.stop()},r.prototype.pause=function(){this.sprite.pause()},Object.defineProperty(r.prototype,"state",{get:function(){return this.sprite.state},enumerable:!0,configurable:!0}),r.prototype.hitTest=function(t,e){return this._sprite.hitTest(t,e)},r.prototype.measureBound=function(e,i,r){if(r||!this._bound){var n=f.call(this,e,i);if(this.frames){var a=t.getRes(this.frames.prefix+this.frames.from);void 0===n.width&&(n.width=a?a.getData().width:0),void 0===n.height&&(n.height=a?a.getData().height:0)}this._bound=d.call(this,e,i,n),this.fireEvent("boundChange",this._bound,!1)}},r.ClassName="SeqFrame",r.Properties=[{name:"frames",default:null,type:"SeqFrameDesc",converter:i.SeqFrameDesc,validate:"SeqFrameDesc"},{name:"color",default:"#ffffff",type:"string",validate:"color"},{name:"loop",default:!1,type:"boolean"},{name:"autoPlay",default:!1,type:"boolean"},{name:"fps",default:30,type:"number",validate:"float"}],r}(k);e.SeqFrame=E,l(E,k);var B=function(e){function r(i){var r=e.call(this,i,new t.SubStageSprite(i._displayStage))||this;return r.setProp("childs",null),r.bind("clip",r._sprite),r}return __extends(r,e),r.prototype._setProps=function(t){for(var e in t)"class"!==e&&"id"!==e&&"_array"!==e&&("childsProperty"===e?Log.error(this.class.ClassName+" can't have childs"):"_childs"===e?this.setChilds(t[e]):this[e]=t[e])},r.prototype.find=function(t){return this.sprite.find(t)},Object.defineProperty(r.prototype,"stage",{get:function(){return this._sprite},enumerable:!0,configurable:!0}),r.prototype.setChilds=function(t){this.stage.clear(),this.stage.load(t)},r.ClassName="UIStage",r.HasChildElements=!0,r.Properties=[{name:"clip",default:!1,type:"boolean",converter:i.Boolean}],r}(k);e.UIStage=B,l(B,k);var R=function(e){function r(i){var n=e.call(this,i,new t.LabelSprite(i._displayStage))||this;return n._init(r),n.addObserver("textStyle",n.textStyleChanged,n),n.bind("text",n._sprite),n.bind("font",n._sprite),n.bind("format",n._sprite),n.bind("strokeColor",n._sprite),n.bind("strokeWidth",n._sprite),n.bind("color",n._sprite),n.bind("bkColor",n._sprite),n.bind("lineHeight",n._sprite),n.bind("align",n._sprite),n.bind("margin",n._sprite),n.bind("gradient",n._sprite),n.textStyleChanged(),n}return __extends(r,e),r.prototype.textStyleChanged=function(){this._textStyleCache={id:""};var t=this;do{var e=t.textStyle;if(e){var i=a(e);if(i)for(var r in i)this._textStyleCache.hasOwnProperty(r)||(this._textStyleCache[r]=i[r])}t=t.parent}while(t);var n=["font","strokeColor","format","strokeWidth","color","bkColor","lineHeight","align","margin"],o=this._sprite;for(var s in n){var h=n[s];o[h]=this.getProp(h)||this._textStyleCache[h]}},Object.defineProperty(r.prototype,"textMetric",{get:function(){return this._sprite.textMetric},enumerable:!0,configurable:!0}),r.prototype.measureBound=function(t,e,i){if(i||!this._bound){var r=this._sprite,n=f.call(this,t,e);n.width&&n.height||(r.width=n.width||1024,r.height=n.height||1024,n.width||(n.width=r.textMetric.maxWidth+(this.hasProp("margin")?this.margin[0]+this.margin[2]:0)),n.height||(n.height=r.textMetric.lineHeight*Math.max(1,r.textMetric.lines.length)+(this.hasProp("margin")?this.margin[1]+this.margin[3]:0))),this._bound=d.call(this,t,e,n),this.fireEvent("boundChange",this._bound,!1)}},Object.defineProperty(r.prototype,"font",{get:function(){return this.getProp("font")||this._textStyleCache.font},set:function(t){this.setProp("font",t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"format",{get:function(){return this.getProp("format")||this._textStyleCache.format},set:function(t){this.setProp("format",t)},enumerable:!0,configurable:!0}),r.ClassName="Label",r.Properties=[{name:"text",default:"",type:"string"},{name:"font",type:"string",customProperty:!0,validate:"font"},{name:"format",type:"TextFormat",converter:i.getEnumParser(t.TextFormat),customProperty:!0},{name:"strokeColor",type:"string",validate:"color"},{name:"strokeWidth",type:"number",converter:i.Int,validate:"int"},{name:"color",type:"string",validate:"color"},{name:"bkColor",type:"string",validate:"color"},{name:"lineHeight",type:"number",converter:i.Int,validate:"int"},{name:"align",type:"AlignMode",converter:i.getEnumParser(t.AlignMode)},{name:"margin",type:"Number4",converter:i.Number4,validate:"int4"},{name:"textStyle",type:"string"},{name:"gradient",default:null,type:"GradientFill",converter:i.GradientFill,validate:"GradientFill"}],r}(k);e.Label=R,l(R,k);var O=function(e){function r(i){var n=e.call(this,i)||this;return n.onTouchBegin=function(t){var e=this.screenToClient(t.screenX,t.screenY),i=this.findHyperlink(e);i&&(this._href=i,t.capture(),this.state="down")},n.onTouchCancel=function(t){"down"==this.state&&(this.state="normal")},n.onTouchEnd=function(t){if("down"==this.state){this.state="normal";var e=this.screenToClient(t.screenX,t.screenY),i=this.findHyperlink(e);this._href==i&&this.fireEvent("click",i.href),this._href=null}},n._init(r),n._createChilds([{class:"Label",id:"label",width:"100%",height:"100%"}]),n._initStates("normal",{normal:{},down:{}}),n._label=n._namedChilds.label,n._label.format=t.TextFormat.MultiLine|t.TextFormat.WordBreak|t.TextFormat.RichText,n._label.align=t.AlignMode.Left|t.AlignMode.Top,n.bind("text",n._label),n.bind("font",n._label),n.bind("color",n._label),n.bind("lineHeight",n._label),n}return __extends(r,e),Object.defineProperty(r.prototype,"namedChilds",{get:function(){return this._namedChilds},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textMetric",{get:function(){return this._label.textMetric},enumerable:!0,configurable:!0}),r.prototype.findHyperlink=function(t){var e=this._label.textMetric,i=t.y/e.lineHeight|0;if(i>=e.richLines.length)return null;for(var r=e.richLines[i],n=0;n<r.length;n++){var a=r[n];if(a.href&&t.x>=a.x&&t.x<a.x+a.width)return a}return null},Object.defineProperty(r.prototype,"font",{get:function(){return this.hasProp("font")?this.getProp("font"):this._label.font},set:function(t){this.setProp("font",t)},enumerable:!0,configurable:!0}),r.ClassName="RichTextWithHyperlink",r.Properties=[{name:"text",default:"",type:"string"},{name:"font",type:"string",customProperty:!0},{name:"color",type:"string"},{name:"lineHeight",type:"number",converter:i.Int}],r}(x);e.RichTextWithHyperlink=O,l(O,x);var D=function(e){function r(i){var n=e.call(this,i)||this,a=n;n._label=new t.LabelSprite(n.parentStage);var o=n._label;return o.format=t.TextFormat.Ellipse,n._init(r),n.bind("text",o,"text",(function(t){return"password"===a.type&&(t=t.replace(/./g,"")),t})),n.bind("font",o),n.bind("color",o),n.bind("bkColor",o),n.bind("lineHeight",o),n.bind("opacity",o),n.bind("visible",o),n.bind("angle",o),n.bind("scaleX",o),n.bind("scaleY",o),n.bind("scale",o),n.bind("zIndex",o),n._label.align=t.AlignMode.Left|t.AlignMode.VCenter,n.addObserver("multiLine",(function(e){o.format=e?t.TextFormat.WordBreak|t.TextFormat.MultiLine:t.TextFormat.Ellipse,o.align=e?t.AlignMode.Left|t.AlignMode.Top:t.AlignMode.Left|t.AlignMode.VCenter}),n),n.bind("margin",o),n._initStates("normal",r.States),n.addEventHandler("boundChange",(function(t){var e=this._bound;if(e){var i=this._label;i.width=e.width,i.height=e.height,i.anchorX=this.anchorX,i.anchorY=this.anchorY,i.x=e.left+i.anchorX*e.width,i.y=e.top+i.anchorY*e.height}}),n),n.addObserver("textStyle",n.textStyleChanged,n),n}return __extends(r,e),r.prototype.dispose=function(){"inputing"==this.state&&t.getRoot().cancelInput(),this._label.dispose(),this._label=null,e.prototype.dispose.call(this)},r.prototype.textStyleChanged=function(){for(var t=this.textStyle,e=this.parent;!t&&e;)t=e.textStyle,e=e.parent;if(t){var i=["font","color","bkColor","lineHeight","margin"],r=this._label;for(var n in i){var a=i[n];void 0===t[a]||this.hasProp(a)||(r[a]=t[a])}}},r.prototype.beginInput=function(){this.state="inputing",t.getRoot().startInput(this)},r.prototype.createChild=function(t,e){throw new Error("TextInput can't create child element.")},r.prototype.findControls=function(t,e){return this.ptInBound(t,e)&&this.touchable?[this]:null},r.ClassName="TextInput",r.Properties=[{name:"text",default:"",type:"string"},{name:"font",type:"string",validate:"font"},{name:"color",type:"string",validate:"color"},{name:"bkColor",type:"string",validate:"color"},{name:"lineHeight",type:"number",converter:i.Int,validate:"int"},{name:"multiLine",type:"boolean",converter:i.Boolean},{name:"submitOnReturn",type:"boolean",converter:i.Boolean},{name:"margin",type:"Number4",converter:i.Number4,validate:"int4"},{name:"maxLength",type:"number",converter:i.Int,validate:"int"},{name:"type",default:"text",type:"string"}],r.States={normal:{},inputing:{},disable:{}},r}(x);e.TextInput=D,l(D,x),D.prototype.onTouchBegin=function(t){"normal"==this.state&&(t.bubble=!1,this.beginInput())};var L=function(t){function e(i){var r=t.call(this,i)||this;return r._tabs=[],r._init(e),r.addObserver("activeIndex",r._selectChange,r),r}return __extends(e,t),e.prototype._selectChange=function(t,e){e>=0&&e<this._tabs.length&&(this._tabs[e].state="unselect"),t>=0&&t<this._tabs.length?this._tabs[t].state="select":Log.warn("tab index out of range.")},e.prototype.select=function(t){var e=this._tabs.indexOf(t);if(-1==e)throw new Error("tab is not exist!");this.activeIndex=e},e.prototype.addTabBtn=function(t,e){var i,r=this._childs.length;if("string"==typeof t){var n=s[t];if(!n)throw new Error(t+" is not exist!");i=this.createChild(n,e)}else i=t;return i.group=this,i.state=r==this.activeIndex?"select":"unselect",this._tabs.push(i),i},e.prototype.setChilds=function(t){this.clearChilds(),this._setChilds(t);for(var e=0;e<this._childs.length;e++)this.addTabBtn(this._childs[e]);var i=this.activeIndex;i>=0&&i<this._tabs.length&&(this._tabs[i].state="select")},e.ClassName="TabGroup",e.HasChildElements=!0,e.Properties=[{name:"activeIndex",default:-1,type:"number",converter:i.Int,validate:"int"}],e}(v);e.TabGroup=L,l(L,v)}(t.ui||(t.ui={}))}(ez||(ez={})),function(t){!function(e){var i=function(){};e.EventHandlerBase=i;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onTouchBegin=function(t){"unselect"==this.state?(this.state="down",t.capture()):"select"==this.state&&(this.state="selectDown",t.capture())},e.prototype.onTouchMove=function(t){},e.prototype.onTouchCancel=function(t){"down"==this.state?this.state="unselect":"selectDown"==this.state&&(this.state="select")},e.prototype.onTouchEnd=function(t){if("down"==this.state){var e=this.parent.screenToClient(t.screenX,t.screenY);this.group&&this._bound&&this._bound.containsPt(e)?(this.state="select",this.group.select(this)):this.state="unselect"}else"selectDown"==this.state&&(this.state="select")},e}(i);e.addTabBtnEventHandler=function(t){t.checkStates("unselect","down","select","selectDown"),t.mixins(r)};var n=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.onCreate=function(){this._initScale=this.scale||1},i.prototype.stopAni=function(){this._ani&&(this._ani.stop(),this._ani=void 0)},i.prototype.onTouchBegin=function(e){"normal"==this.state&&(this.state="down",this.stopAni(),this._ani=t.Tween.add(this).move({scale:[this._initScale,this._initScale*this.btnScale]},100).play(),e.capture())},i.prototype.onTouchMove=function(e){if("down"==this.state){var i=this.parent.screenToClient(e.screenX,e.screenY);this._bound&&!this._bound.containsPt(i)?(this.stopAni(),this.scale&&(this._ani=t.Tween.add(this).move({scale:[this.scale,this._initScale]},100,t.Ease.sineOut).play())):this._ani&&0!=this._ani.state||(this._ani=void 0,this.scale=this._initScale*this.btnScale)}},i.prototype.onTouchEnd=function(e){if("down"==this.state){this.state="normal",this.stopAni(),this._ani=t.Tween.add(this).move({scale:[this.scale,this._initScale]},100,t.Ease.sineOut),this._ani.play();var i=this.parent.screenToClient(e.screenX,e.screenY);this._bound&&this._bound.containsPt(i)&&(this.sfx&&t.playSFX(this.sfx),this.fireEvent("click"))}},i.prototype.onTouchCancel=function(t){"down"==this.state&&(this.stopAni(),this.scale=void 0,this.state="normal")},i}(i);e.addButtonEventHandler=function(t,e,i){t.prototype.hasOwnProperty("btnScale")||(t.prototype.btnScale=e||.85),i&&(t.prototype.sfx=i),t.checkStates("normal","down"),t.mixins(n)};var a=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._push=!1,t}return __extends(i,e),i.prototype.onCreate=function(){this._initScale=this.scale||1},i.prototype.stopAni=function(){this._ani&&(this._ani.stop(),this._ani=void 0)},i.prototype.onTouchBegin=function(e){this._push||(this._push=!0,this.stopAni(),this._ani=t.Tween.add(this).move({scale:[this._initScale,this._initScale*this.btnScale]},100).play(),e.capture())},i.prototype.onTouchCancel=function(t){this._push&&(this.stopAni(),this.scale=void 0),this._push=!1},i.prototype.onTouchMove=function(e){if(this._push){var i=this.parent.screenToClient(e.screenX,e.screenY);this._bound&&!this._bound.containsPt(i)?(this.stopAni(),this.scale&&(this._ani=t.Tween.add(this).move({scale:[this.scale,this._initScale]},100,t.Ease.sineOut).play())):this._ani&&0!=this._ani.state||(this._ani=void 0,this.scale=this._initScale*this.btnScale)}},i.prototype.onTouchEnd=function(e){if(this._push){this.stopAni(),this._ani=t.Tween.add(this).move({scale:[this.scale,this._initScale]},100,t.Ease.sineOut),this._ani.play();var i=this.parent.screenToClient(e.screenX,e.screenY);this._bound&&this._bound.containsPt(i)&&("check"==this.state?this.state="uncheck":this.state="check",this.sfx&&t.playSFX(this.sfx),this.fireEvent("click"))}this._push=!1},i}(i);e.addCheckboxEventHandler=function(t,e,i){t.prototype.hasOwnProperty("btnScale")||(t.prototype.btnScale=e||.85),i&&(t.prototype.sfx=i),t.checkStates("uncheck","check"),t.mixins(a)}}(t.ui||(t.ui={}))}(ez||(ez={})),function(t){var e=function(e){function i(t,i){var r=e.call(this,t,i)||this;return r._data=null,r._color="#ffffff",r}return __extends(i,e),i.prototype._dispose=function(){this._texture=null,this._data=null,this._parent=null,e.prototype._dispose.call(this)},i.prototype.getType=function(){return i.Type},i.prototype._draw=function(t,e){var i=this._texture;if(i&&!i.empty)if(i.ready){if(t.setFillColor(this.color),!((e*=this.opacity)<.01)){useWGL&&this.applyEffect(t),t.setAlphaBlend(e,this.blendMode),t.setZ&&t.setZ(this.zIndex);var r=ezasm.getglobalTrans(this._handle);r||Log.error("global transfrom is null",i.name),this._pattern?t.drawImageRepeat(i,r,this.width,this.height,this._pattern):i.s9?t.drawImageS9(i,r,i.s9,this.width,this.height,i.subRect):t.drawImage(i,r,this.width,this.height,i.subRect)}}else i.load(this.setDirty.bind(this))},i.prototype._setWidth=function(t){var e=this._handle;e&&ezasm.setwidth(e,t)&&this.setDirty()},i.prototype._setHeight=function(t){var e=this._handle;e&&ezasm.setheight(e,t)&&this.setDirty()},Object.defineProperty(i.prototype,"width",{get:function(){return ezasm.getwidth(this._handle)},set:function(t){this._setWidth(t),this._width=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return ezasm.getheight(this._handle)},set:function(t){this._setHeight(t),this._height=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"src",{get:function(){return this._data},set:function(e){var i=this;if("string"==typeof e&&(e=t.parse.ImageSrc(e)),this._data!=e)if(this.setDirty(),this._data=e,this._hitMask=null,e){var r=e;if(r.getData)if(this._texture=r.getData(),r.hitMask)this._hitMask=r.hitMask;else if(r.args.hitMask){var n=t.getRes(r.args.hitMask);n.load((function(t){t&&(i._hitMask=r.hitMask=function(t){var e=new Int8Array(t,10),i=new Int16Array(t,0,5),r=i[0]+(i[1]<<16);if(1263747405!=r)return Log.error("mask file error."),null;for(var n=i[2],a=i[3],o=i[4],s=[],h=[],l=0,c=0;c<t.byteLength-10;c++){var u=e[c];if(-128!=u)0==u?(l&&h.push(l),s.push(h.length>0?h:null),h=[],l=0):l*u<0?(h.push(l),l=u):l+=u;else{h.length>0&&Log.error("mask data error");var f=e[++c],d=s[s.length-f-1];s.push(d)}}return s.length!=a&&Log.error("mask data error"),Log.debug("load mask sig="+r+" width="+n+" height="+n+" level="+o+" lines="+s.length),{level:o,data:s}}(n.getData()))}),this)}else this._hitMask=null;else this._texture=e;void 0===this._width&&this._setWidth(this._texture.width),void 0===this._height&&this._setHeight(this._texture.height)}else this._texture=null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pattern",{get:function(){return this._pattern},set:function(t){this._pattern!=t&&(this._pattern=t,this.setDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clipRect",{get:function(){return this._clipRect},set:function(t){this._clipRect=t,this.setDirty()},enumerable:!0,configurable:!0}),i.prototype.hitTest=function(t,e){if(!this._texture)return!1;if(t<0||e<0||t>=this.width||e>=this.height)return!1;if(!this._hitMask)return!0;var i=this._texture;t=t*i.width/this.width>>this._hitMask.level,e=e*i.height/this.height>>this._hitMask.level;var r=this._hitMask.data[e];if(!r)return!1;for(var n=0;n<r.length;){var a=Math.abs(r[n]);if(t<a)return r[n]>0;t-=a,n++}return!1},i.Type="Image",i}(t.Sprite);t.ImageSprite=e,t.Sprite.register(e.Type,(function(t,i){return new e(t,i)}))}(ez||(ez={})),function(t){t.loadFont=function(t,i,r,n){void 0===r&&(r="normal"),void 0===n&&(n="normal");var a=document.createElement("style");a.appendChild(document.createTextNode("@font-face {\n\tfont-family: '"+t+"';\n\tsrc: url('"+i+".eot');\n\tsrc: url('"+i+".woff') format('woff'), url('"+i+".ttf') format('truetype');\n\tfont-weight: "+r+";\n    font-style: "+n+";\n}")),document.head.appendChild(a);var o=e._ctx;o.font="10px "+t,o.fillText("a1",0,0,10)};var e=function(){function e(t){t||(t="16px");var i=(t=t.trim()).indexOf("px");if(-1!=i){if(i>=t.length-3){var r=e.DefaultFont;t+=r.substring(r.indexOf("px")+2)}this._font=t,this.lineHeight=e.getFontHeight(this._font)}else Log.warn("the font size is missing: "+t)}return e.isFullWidth=function(t){return!(t<128)&&(t>=19968&&t<=40959||t>=12352&&t<=12447||t>=12448&&t<=12543||t>=44032&&t<=55203)},e.GetNextWordBreak=function(t,i){for(var r=i,n=!0;r<t.length;){var a=t.charCodeAt(r);if(9==a||32==a)return r+(n?1:0);if(e.isFullWidth(a))return n?r<t.length-1&&e.EndBreak[t.charAt(r+1)]?r+2:r+1:r;r++,n=!1}return r},e.textWidthLowerBound=function(t,e,i){for(var r=0,n=e.length,a=n+r+1>>1;;){var o=t.measureText(e.substring(0,a)).width;if(o==i)return a;if(o<i?r=a:n=a,n-r<=1)return r;a=n+r+1>>1}},e.measureLine=function(t,i,r,n,a,o){if(0==i.length)return[];var s=[];if(a)for(var h,l=0,c=0;;){if(0==l){var u=t.measureText(i).width;if(u<=n-r)return s.push({text:i,width:u}),s}var f=e.GetNextWordBreak(i,l),d=i.substring(0,f),p=t.measureText(d).width;if(c>0&&p>=n-r)s.push({text:h,width:c}),i=i.substring(l),r=0,l=0,c=0;else if(0==c&&p>=n-r){var g=e.textWidthLowerBound(t,d,n-r);0==r&&0==g&&(g=1),g>0?(d=d.substring(0,g),s.push({text:d,width:t.measureText(d).width}),i=i.substring(g),r=0,l=0,c=0):(s.push({text:"",width:0}),l=0,r=0)}else l=f,c=p,h=d;if(o&&s.length>0)return s}else for(;;){if((p=t.measureText(i).width)<n-r)return s.push({text:i,width:p,newline:!0}),s;d=i;p>2*(n-r)&&(d=i.substring(0,i.length*(n-r)*2/p|0||1));l=e.textWidthLowerBound(t,d,n-r);if(0==r&&0==l&&(l=1),l>0?(d=d.substring(0,l),s.push({text:d,width:t.measureText(d).width}),r=0):(s.push({text:"",width:0}),r=0),o&&s.length>0)return s;i=i.substring(l)}},e.prototype.measureRichText=function(i,r,n,a,o){if(null==i&&(i=""),"string"!=typeof i&&(i=i.toString()),""===i)return this.maxWidth=0,void(this.richLines=[]);var s=Math.max(1,n/this.lineHeight|0);i=i.replace("\r\n","\n").replace("\n","");var h=this._font;var l=function(t){var e=0,i=[],r=[o],n=[h],a=[],s=!1,l=!1,c=null;function u(t){var e={color:r[r.length-1],font:n[n.length-1],stroke:d,text:t};return s&&(e.underline=!0),l&&(e.strike=!0),c&&(e.href=c),e}for(;;){var f=t.indexOf("<",e),d=a[a.length-1];if(f<0){e<t.length&&i.push(u(t.substring(e)));break}var p=t.indexOf(">",f+1);if(p<0){e<t.length&&i.push(u(t.substring(e)));break}f>e&&i.push(u(t.substring(e,f))),e=p+1;var g=t.substring(f+1,p);if("/color"===g&&r.length>1)r.pop();else if("/font"===g&&n.length>1)n.pop();else if("/stroke"===g)a.pop();else if("/a"===g)c=null;else if("/u"===g)s=!1;else if("/s"===g)l=!1;else if("br"===g)i.push(0);else if("u"===g)s=!0;else if("s"===g)l=!0;else if("a "==g.substr(0,2)){(m=g.indexOf("="))>0&&(c=g.substr(m+1).trim())}else{var m;if((m=g.indexOf("="))>0)switch(g.substr(0,m)){case"color":r.push(g.substr(m+1).trim());break;case"font":n.push(g.substr(m+1));break;case"stroke":var _=g.substring(m+1).trim().split(" ");a.push({width:parseInt(_[0]),color:_[1]})}}}return i}(i),c=0!=(a&t.TextFormat.WordBreak),u=!!(a&t.TextFormat.Ellipse);if(a&t.TextFormat.MultiLine){this.richLines=[[]];var f=0,d=this.richLines[0];this.maxWidth=0;for(var p=0;p<l.length;p++){if(0===(x=l[p]))f=0,d=[],this.richLines.push(d);else{e._ctx.font=x.font;var g=e.measureLine(e._ctx,x.text,f,r,c,!1),m=!1;if(this.richLines.length+g.length-1>s){if(g=g.splice(s-this.richLines.length,g.length-s+this.richLines.length),u)(w=g[g.length-1]).text.length>1&&(w.text=w.text.substring(0,w.text.length-1)),w.text+="...",w.width=e._ctx.measureText(w.text).width;m=!0}for(var _=0;_<g.length;_++){_>0&&(d=[],this.richLines.push(d),f=0);var v=g[_];this.maxWidth=Math.max(this.maxWidth,v.width+f);var y={width:v.width,text:"",x:f,color:o,font:this._font};for(var b in x)y[b]=x[b];y.text=v.text,d.push(y),f+=v.width}if(m)break}}}else{f=0;this.richLines=[[]];for(p=0;p<l.length;p++){var x;if(0===(x=l[p]))break;e._ctx.font=x.font;m=!1;(v=e.measureLine(e._ctx,x.text,f,r,!1,!0)[0]).text.length<x.text.length&&u&&(v.text.length>1&&(v.text=v.text.substring(0,v.text.length-1)),v.text+="...",v.width=e._ctx.measureText(v.text).width,m=!0);y={width:v.width,text:"",x:f,color:o,font:this._font};for(var b in x)y[b]=x[b];if(y.text=v.text,this.richLines[0].push(y),f+=v.width,m)break}var w=this.richLines[0][this.richLines[0].length-1];this.maxWidth=w.x+w.width}},e.prototype.measureText=function(i,r,n,a){if(null==i&&(i=""),"string"!=typeof i&&(i=i.toString()),""==i)return this.maxWidth=0,void(this.lines=[]);this.lines=[],this.maxWidth=r,e._ctx.font=this._font;var o=(i=i.replace("\r\n","\n")).split("\n"),s=0!=(a&t.TextFormat.WordBreak),h=!!(a&t.TextFormat.Ellipse),l=!!(a&t.TextFormat.Shrink),c=Math.max(1,n/this.lineHeight|0);if(a&t.TextFormat.MultiLine){for(var u=0;u<o.length;u++){var f=e.measureLine(e._ctx,o[u],0,r,s,!1);if(this.lines.length+f.length>c){if(this.lines=this.lines.concat(f.slice(0,c-this.lines.length)),h){var d=this.lines[this.lines.length-1];d.text.length>1&&(d.text=d.text.substring(0,d.text.length-1)),d.text+="...",d.width=e._ctx.measureText(d.text).width}break}this.lines=this.lines.concat(f)}this.maxWidth=this.lines.reduce((function(t,e){return Math.max(t,e.width)}),0)}else{var p=e.measureLine(e._ctx,o[0],0,l?1e4:r,!1,!0)[0];p.text.length<o[0].length&&h&&(p.text.length>1&&(p.text=p.text.substring(0,p.text.length-1)),p.text+="...",p.width=e._ctx.measureText(p.text).width),this.lines.push(p),this.maxWidth=p.width}},e.getFontHeight=function(t){var e=/\d+px/.exec(t);return e&&e.length>0?parseInt(e[0].substring(0,e[0].indexOf("px"))):16},Object.defineProperty(e.prototype,"font",{get:function(){return this._font},enumerable:!0,configurable:!0}),e.EndBreak={},e.DefaultFont="24px Arial, Helvetica, sans-serif",e}();t.TextMetric=e;t.initCall((function(){for(var i=[711,713,8758,9588,33,37,41,44,46,58,59,62,63,93,125,168,176,183,12289,12290,12291,12293,12297,12299,12301,12303,12305,12309,12311,12318,65072,65073,65075,65076,65078,65080,65082,65084,65086,65088,65090,65092,65103,65104,65105,65106,65108,65109,65110,65111,65114,65116,65118,65281,65282,65285,65287,65289,65292,65293,65294,65306,65307,65310,65311,65341,65372,65373,65374,65377,65379,65380,65438,65439],r=0;r<i.length;r++)e.EndBreak[String.fromCharCode(i[r])]=!0;var n=t.internal.createCanvas();n.width=10,n.height=10,e._ctx=n.getContext("2d")}))}(ez||(ez={})),function(t){var e,i;function r(t){return t?t.color+t.width:null}t.scanFontText=function(){e={}},t.outputFontText=function(){for(var t in e)console.log(t+": "+e[t])},t.initCall((function(){(i=t.internal.createCanvas()).width=240,i.height=80;var e=i.getContext("2d");e.textAlign="left",e.textBaseline="middle",e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high"}));var n=function(e){function n(i,r){var n=e.call(this,i,r)||this;return n._format=t.TextFormat.Ellipse,n._text="",n._strokeColor="#000000",n._strokeWidth=0,n._lineHeight=0,n._margin=null,n._align=t.AlignMode.Left|t.AlignMode.Top,n._color="#ffffff",n}return __extends(n,e),n.prototype.getType=function(){return n.Type},n.prototype._prepare=function(n,a,o){if(e.prototype._prepare.call(this,n,a,o),useWGL&&""!=this.text){var s,h=Math.max(1,64*t.RenderContext.scale|0);64!=h&&(s=64/h),this._lastTextScale!=h&&(this._lastTextScale=h,this._caches=null);var l=this._lastTextScale.toString();h=this._lastTextScale/64;var c=this.textMetric,u=t.TextMetric.getFontHeight(c.font),f=0|this._strokeWidth;if(this._caches)for(D=0;D<this._caches.length;D++)this._caches[D]&&t.FontCache.addTextCache(this._caches[D]);else{if(!c.maxWidth)return;this._caches=[],f>0&&(f+=1);var d=Math.min(t.FontCache.Width,c.maxWidth+2*f+2),p=Math.min(t.FontCache.Height,2+(u+2*f)|0),g=d*h+.5|0,m=p*h+.5|0;i.width<g&&(i.width=g),i.height<m&&(i.height=m);var _=i.getContext("2d");if(_.textAlign="left",_.textBaseline="middle",_.setTransform(1,0,0,1,0,0),1!=h&&_.scale(h,h),this.format&t.TextFormat.RichText)for(var v=0;v<c.richLines.length;v++)for(var y=c.richLines[v],b=0;b<y.length;b++){var x=y[b];if(x.width<=0)x.cache=null;else{if("string"==typeof(z=t.FontCache.getTextCacheOrKey(x.font,x.color,r(x.stroke),l,x.text))){var w=0,T=.5*(u+1)|0,C=x.width+2*f+1,S=p;if(_.font=x.font,_.fillStyle=x.color,x.stroke&&(w=x.stroke.width,T+=x.stroke.width,C+=2*x.stroke.width+1,S+=2*x.stroke.width+1,_.strokeStyle=x.stroke.color,_.lineWidth=x.stroke.width),_.clearRect(0,0,C+1,S),x.stroke&&_.strokeText(x.text,w,T+1,x.width+2*w+2),_.fillText(x.text,w,T+1,x.width+2*w+2),1!=h)var A=C*h+.5|0,P=S*h+.5|0,k={img:_.getImageData(0,0,A,P),w:A*s,h:P*s,region:null,text:x.text};else k={img:_.getImageData(0,0,C,S),w:C,h:S,region:null,text:x.text};t.FontCache.setTextCache(z,k),z=k}x.cache=z,this._caches.push(z),t.FontCache.addTextCache(z)}}else{var M=this._gradient?function(t){return""+(t.x0||"0")+(t.y0||"0")+(t.x1||"0")+(t.y1||"0")+t.colors.join()}(this._gradient):this._color,I=this._strokeWidth>0?this._strokeColor+this._strokeWidth:"";if(this._gradient){for(var E=this._gradient,B=_.createLinearGradient(E.x0||0,E.y0||0,E.x1||0,E.y1||0),R=0;R<E.colors.length;R++)B.addColorStop(R/(E.colors.length-1),E.colors[R]);_.fillStyle=B}else _.fillStyle=this._color;_.font=c.font,this._strokeWidth>0&&(_.strokeStyle=this._strokeColor,_.lineWidth=this._strokeWidth);for(var O=(.5*(u+1)|0)+f+1,D=0;D<c.lines.length;D++){var L=c.lines[D];if(L.width<=0)this._caches.push(null);else{var z;if("string"==typeof(z=t.FontCache.getTextCacheOrKey(c.font,M,I,l,L.text))){_.clearRect(0,0,d+1,p),f>0&&_.strokeText(L.text,f,O,d+2*f+2),_.fillText(L.text,f,O,d+2*f+2);var F=L.width+2*f+2;if(1!=h){var H=F*h+.5|0,G=p*h+.5|0;k={img:_.getImageData(0,0,H,G),w:H*s,h:G*s,region:null,text:L.text}}else k={img:_.getImageData(0,0,F,p),w:F,h:p,region:null,text:L.text};t.FontCache.setTextCache(z,k),z=k}this._caches.push(z),t.FontCache.addTextCache(z)}}}_=null}}},n.prototype.clearCache=function(){this.setDirty(),this._caches&&(this._caches=null)},n.prototype.clear=function(){this._textMetric=null,this.setDirty(),this._caches&&(this._caches=null)},n.prototype.dispose=function(){e.prototype.dispose.call(this),this.clear()},Object.defineProperty(n.prototype,"textMetric",{get:function(){if(!this._textMetric){var e=this.width||1024,i=this.height||t.TextMetric.getFontHeight(this.font);this._margin&&(e-=this._margin[0]+this._margin[2],i-=this._margin[1]+this._margin[3]),this._textMetric=new t.TextMetric(this.font),this._format&t.TextFormat.RichText?this._textMetric.measureRichText(this._text,e,i,this._format,this.color):this._textMetric.measureText(this._text,e,i,this._format),this._lineHeight&&(this._textMetric.lineHeight=this._lineHeight)}return this._textMetric},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return ezasm.getwidth(this._handle)},set:function(t){ezasm.setwidth(this._handle,t),this.clear()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return ezasm.getheight(this._handle)},set:function(t){ezasm.setheight(this._handle,t),this.clear()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"gradient",{get:function(){return this._gradient},set:function(t){this._gradient=t,this.clear()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"font",{get:function(){return this._font||t.TextMetric.DefaultFont},set:function(t){t!=this._font&&(this._font=t,this.clear())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"format",{get:function(){return this._format},set:function(t){t!=this._format&&(this._format=t,this.clear())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"text",{get:function(){return this._text},set:function(t){(t=null==t?"":t.toString())!=this._text&&(this._text=t,this.clear())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"strokeColor",{get:function(){return this._strokeColor},set:function(t){t!=this._strokeColor&&(this._strokeColor=t,this.clearCache())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"strokeWidth",{get:function(){return this._strokeWidth},set:function(t){(t=t||0)!=this._strokeWidth&&(this._strokeWidth=t,this.clearCache())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"color",{get:function(){return this._color},set:function(t){t||(t="#ffffff"),t!=this._color&&(this.setDirty(),this._color=t,this.clearCache())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(e){e!=this._lineHeight&&(this._lineHeight=e,this._textMetric&&(this._textMetric.lineHeight=e&&e>0?e:t.TextMetric.getFontHeight(this.font),this.setDirty()))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"align",{get:function(){return this._align},set:function(t){t!=this._align&&(this._align=t,this.setDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"margin",{get:function(){return this._margin},set:function(t){this._margin=t,this.clear()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bkColor",{get:function(){return this._bkColor},set:function(t){t!=this._bkColor&&(this._bkColor=t,this.setDirty())},enumerable:!0,configurable:!0}),n.prototype._draw=function(e,i){if(!((i*=this.opacity)<.01)){useWGL&&this.applyEffect(e),e.setAlphaBlend(i,this.blendMode);var r=ezasm.getglobalTrans(this._handle);if(this._bkColor&&(e.setFillColor(this._bkColor),e.fillRect(this.width,this.height,r)),""!=this.text&&this._caches){var n=0|this._strokeWidth,a=this.textMetric,o=1;e.setZ&&e.setZ(this.zIndex),ezasm.saveTempStack();var s=this.width||a.maxWidth;if(this._format&t.TextFormat.Shrink&&a.maxWidth>s){o=s/a.maxWidth,s=a.maxWidth;var h=ezasm.tempAllocMat2x3(o,0,0,o,0,0);ezasm.mat2x3Append(h,r),r=h}var l=a.lineHeight*o,c=this.height||l*a.lines.length,u=this._margin?this._margin[0]:0,f=this._margin?this._margin[1]:0;if(this._margin&&(s-=this._margin[0]+this._margin[2],c-=this._margin[1]+this._margin[3]),useWGL){var d=this._align;if(u-=n,f-=n,e.setFillColor("#ffffff"),this.format&t.TextFormat.RichText){(d&t.AlignMode.VCenter)==t.AlignMode.VCenter?f+=.5*(c-(a.richLines.length+.4)*l):(d&t.AlignMode.Bottom)==t.AlignMode.Bottom&&(f+=c-(a.richLines.length+.4)*l);for(var p=0;p<a.richLines.length;p++){var g=a.richLines[p],m=u;if(0!=g.length){var _=g[g.length-1];(d&t.AlignMode.Center)==t.AlignMode.Center?m+=.5*(s-_.x-_.width):(d&t.AlignMode.Right)==t.AlignMode.Right&&(m+=s-_.width-_.x);for(var v=0;v<g.length;v++){var y=g[v],b=y.cache;if(b){if(y.underline){h=ezasm.tempAllocMat2x3(1,0,0,1,m+y.x,a.lineHeight+f);ezasm.mat2x3Append(h,r),e.setFillColor(y.color),e.fillRect(y.width,.0625*l,h)}if(y.strike){h=ezasm.tempAllocMat2x3(1,0,0,1,m+y.x,.5*a.lineHeight+f);e.setFillColor(y.color),ezasm.mat2x3Append(h,r),e.fillRect(y.width,.0625*l,h)}var x=y.stroke?y.stroke.width:0;e.drawTextCache(m+y.x,f-x,b,r)}}f+=l}else f+=l}}else{(d&t.AlignMode.VCenter)==t.AlignMode.VCenter?f+=.5*(c-a.lines.length*l):(d&t.AlignMode.Bottom)==t.AlignMode.Bottom&&(f+=c-a.lines.length*l);for(var w=0;w<this._caches.length;w++){var T=this._caches[w];if(T){m=u;(d&t.AlignMode.Center)==t.AlignMode.Center?m+=.5*(s-a.lines[w].width):(d&t.AlignMode.Right)==t.AlignMode.Right&&(m+=s-a.lines[w].width),e.drawTextCache(m,f/o,T,r)}f+=l}}}else{var C;this._strokeWidth>0&&this._strokeColor&&(C={width:this._strokeWidth,color:this._strokeColor}),this._gradient?e.setFillGradient(this._gradient):e.setFillColor(this._color),e.drawText(this._textMetric,r,u,f,s,c,this.align,C)}ezasm.restoreTempStack()}}},n.Type="Label",n}(t.Sprite);t.LabelSprite=n,t.Sprite.register(n.Type,(function(t,e){return new n(t,e)}))}(ez||(ez={})),function(t){var e=function(e){function i(t,i){return e.call(this,t,i)||this}return __extends(i,e),i.prototype._draw=function(t,e){(e*=this.opacity)<.01||(useWGL&&this.applyEffect(t),t.setAlphaBlend(e,this.blendMode),t.setZ&&t.setZ(this.zIndex),this._gradient?t.setFillGradient(this._gradient):t.setFillColor(this._color),t.fillRect(this.width,this.height,ezasm.getglobalTrans(this._handle)))},i.prototype.getType=function(){return i.Type},Object.defineProperty(i.prototype,"gradient",{get:function(){return this._gradient},set:function(e){if(this.setDirty(),e){var i=e;"string"==typeof e&&(i=t.parse.GradientFill(e)),i.x0=i.x0||0,i.y0=i.y0||0,i.y1=i.y1||0,i.x1=i.x1||0,this._gradient=i}else this._gradient=null},enumerable:!0,configurable:!0}),i.Type="RectFill",i}(t.Sprite);t.RectFillSprite=e,t.Sprite.register(e.Type,(function(t,i){return new e(t,i)}))}(ez||(ez={})),function(t){var e;!function(t){t[t.text=1]="text",t[t.json=2]="json",t[t.csv=3]="csv",t[t.image=4]="image",t[t.subimage=5]="subimage",t[t.binary=6]="binary",t[t.sound=7]="sound",t[t.gltf=8]="gltf",t[t.model=9]="model",t[t.empty=10]="empty",t[t.texture=11]="texture",t[t.spine=12]="spine",t[t.ezm=13]="ezm"}(e||(e={}));var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWX",r={},n={};function a(t){t=t.toLowerCase();for(var e=305419896,r=124076833,n=0;n<t.length;n++){var a=t.charCodeAt(n);e=1033*(e+a)&2147483647,r=65789*(r+a)&2147483647}var o="";for(n=0;n<6;n++)o+=i.charAt(31&e)+i.charAt(31&r),e>>=5,r>>=5;return o}var o,s,h=".0",l={};!function(t){t.setImageExt=function(t){h=t}}(s=t.internal||(t.internal={})),t.detectImageExt=function(){return new Promise((function(t){var e=new Image;e.onload=e.onerror=function(){if(2==e.height)Log.info("webp found"),h=".1",t();else{var i=new Image;i.onload=i.onerror=function(){if(2==i.height)Log.info("jp2 found"),h=".2",t();else{var e=new Image;e.onload=e.onerror=function(){2==e.height?(Log.info("jxr found"),h=".3"):(Log.info("png found"),h=".0"),t()},e.src="data:image/vnd.ms-photo;base64,SUm8AQgAAAAFAAG8AQAQAAAASgAAAIC8BAABAAAAAQAAAIG8BAABAAAAAgAAAMC8BAABAAAAWgAAAMG8BAABAAAARgAAAAAAAAAkw91vA07+S7GFPXd2jckQV01QSE9UTwAZAMFxAAAAATAAoAAKAACgAAAQgCAIAAAEb/8AAQAAAQDCPwCAAAAAAAAAAAAAAAAAjkI/AIAAAAAAAAABIAA="}},i.src="data:image/jp2;base64,/0//UQAyAAAAAAABAAAAAgAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAEBwEBBwEBBwEBBwEB/1IADAAAAAEAAAQEAAH/XAAEQED/ZAAlAAFDcmVhdGVkIGJ5IE9wZW5KUEVHIHZlcnNpb24gMi4wLjD/kAAKAAAAAABYAAH/UwAJAQAABAQAAf9dAAUBQED/UwAJAgAABAQAAf9dAAUCQED/UwAJAwAABAQAAf9dAAUDQED/k8+kEAGvz6QQAa/PpBABr994EAk//9k="}},e.src="data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoCAAIAAsBMJaQAA3AA/veMAAA="}))};var c=function(){function e(){}return e.nextTask=function(){e.runningTasks<e.maxLoadingTask&&e.pedingTasks.length>0&&(e.runningTasks++,e.pedingTasks.pop().do())},e.taskFinish=function(){e.runningTasks--,e.nextTask()},e.getData=function(t,i,r,n){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState){0,e.taskFinish();var o=0==i?a.responseText:a.response;a.status>=400||!o?(Log.error("download "+t+" failed. errCode: "+a.status+" errMsg: "+a.statusText),r.call(n,!1)):r.call(n,!0,o)}},a.open("GET",t,!0),1==i&&(a.responseType="arraybuffer"),a.send()},e.getSound=function(i,r,n){function a(){s(),r.call(n,!0,l)}function o(){Log.error("load sound "+i+" failed."),s(),r.call(n,!1)}function s(){l.removeEventListener("canplaythrough",a),l.removeEventListener("error",o),clearTimeout(u),e.taskFinish()}if(t.WebAudio){var h=new XMLHttpRequest;h.open("GET",i),h.responseType="arraybuffer",h.onload=function(a){if(h.response){var o=Date.now();t.WebAudio.decodeAudioData(h.response,(function(t){Log.debug("end decode "+i+" cost: + "+(Date.now()-o)+"ms"),r.call(n,!0,t)}),(function(){Log.error("decode sound failed."),r.call(n,!1)}))}else Log.error("download "+i+" failed. errCode: "+h.status+" errMsg: "+h.statusText),r.call(n,!1);e.taskFinish()},h.send()}else{var l=document.createElement("audio");if(l.canPlayType("audio/mpeg")){l.addEventListener("canplaythrough",a),l.addEventListener("error",o);var c=document.createElement("source");c.src=i,c.type="audio/mpeg",l.appendChild(c);var u=setTimeout(o,1e4);l.load()}}},e.getImage=function(i,r,n,a){var o=new Image;o.onerror=function(t){e.taskFinish(),o.onerror=null,o.onload=null,Log.error("load image "+i+" failed."),n.call(a,!1)},o.onload=function(){e.taskFinish(),o.onerror=null,o.onload=null,n.call(a,!0,o)},useWGL&&(o.crossOrigin="anonymous"),o.onerror=function(t){e.taskFinish(),o.onerror=null,o.onload=null,Log.error("load image "+i+" failed."),n.call(a,!1)},o.onload=function(){e.taskFinish(),o.onerror=null,o.onload=null,n.call(a,!0,o)},useWGL&&r&&t.getProxyUrl?o.src=t.getProxyUrl(i):o.src=i},e.downloadAsync=function(t,i,r,n){return new Promise((function(a,o){e.download(t,i,r,n,(function(t,e){t?a(e):o()}),null)}))},e.download=function(t,i,r,n,a,o){var s;0==i||1==i?s={priority:n,do:function(){e.getData(t,i,a,o)}}:3==i?s={priority:n,do:function(){e.getSound(t,a,o)}}:2==i&&(s={priority:n,do:function(){e.getImage(t,r,a,o)}});for(var h=0;;){if(h>=e.pedingTasks.length||n>e.pedingTasks[h].priority){e.pedingTasks.splice(h,0,s);break}h++}e.nextTask()},e.maxLoadingTask=4,e.pedingTasks=[],e.runningTasks=0,e}();t.HTTP=c;var u=function(){function e(e){if(this.id=e.id,this.name=e.args.name||e.url,this.width=e.args.width,this.height=e.args.height,this.url=e.url,e.cors&&(this.cors=!0),e.args.cubemap&&(this.isCube=!0,this.cubemap=e.args.cubemap),this.maxAge=e.age||0,this.format=e.args.format||0,this.memSize=0,this.res=e,4==e.type)this.type=0;else if(13==e.type)this.type=4;else if(11==e.type){var i=e.args.types||[],r=function(t){switch(t){case 2:case 0:case 3:case 4:case 1:return 4;case 5:return 5;case 8:return 8;case 7:return 7;case 6:return 6;default:return 4}}(t.Texture.compressFormat);i.indexOf(r)<0?i.indexOf(4)<0?(this.type=0,this.format=0):(this.format=1,this.type=4):(this.format=t.Texture.compressFormat,this.type=r),0!=this.type&&(this.url=this.url+"."+this.type)}else Log.error("not texture resource.")}return e.prototype.setError=function(){this.id=t.Texture.errorFallback.id,this.tex=t.Texture.errorFallback.tex,this.width=t.Texture.errorFallback.width,this.height=t.Texture.errorFallback.height,this.invWidth=t.Texture.errorFallback.invWidth,this.invHeight=t.Texture.errorFallback.invHeight,this.res.state=4},e.prototype.load=function(e){var i;if(1==this.res.state)if(this.res.state=2,0==this.type){if(this.cubemap)return void function(){return __awaiter(this,void 0,void 0,(function(){var i,r,n,a,o;return __generator(this,(function(s){switch(s.label){case 0:0,i=[],r=0,s.label=1;case 1:return r<this.cubemap.length?(n=v(this.cubemap[r]),a=i,o=r,[4,c.downloadAsync(n.url,2,!1,1)]):[3,4];case 2:a[o]=s.sent(),s.label=3;case 3:return r++,[3,1];case 4:return this.tex=t.Texture.createCubeTextureFromImage(i),this.invWidth=1/this.width,this.invHeight=1/this.height,this.memSize=this.width*this.height*4*6,e(),[2]}}))}))}.call(this);0,c.download(this.url,2,this.cors,1,(function(i,r){i?(this.res.state=3,useWGL?(11==this.res.type?this.tex=t.Texture.createGLTextureFromImage(r,10497,!0):this.tex=t.Texture.createGLTextureFromImage(r,33071,!1),this.invWidth=1/r.width,this.invHeight=1/r.height):this.img=r,this.width=r.width,this.height=r.height,this.memSize=r.width*r.height*4,e()):(Log.error("download "+this.url+" failed."),this.setError())}),this)}else 4==this.type?s.ezmDecoder.load(this.url,this.format,this.width*this.height,i,function(i){if(i.status)Log.error(i.error),this.setError(),e();else{this.res.state=3;var r=i.data||null;!r||1!=this.format&&2!=this.format||(r=new Uint16Array(i.data.buffer,i.data.byteOffset,i.data.byteLength>>1)),this.tex=t.Texture.createGLTexture(i.width,i.height,this.format,11==this.res.type?10497:33071,9729,!1,11==this.res.type&&!!r,r),this.width=i.width,this.height=i.height,this.invWidth=1/i.width,this.invHeight=1/i.height,this.memSize=i.width*i.height*function(t){switch(t){case 0:return 4;case 1:case 2:return 2;case 3:return 1;case 4:return 2;case 5:case 8:return.5;case 7:return.45;case 6:return.5;default:return 1}}(this.format);var n=t.getGL();if(i.subsets)for(var a=0;a<i.subsets.length;a++){var o=i.subsets[a];0==this.format?n.texSubImage2D(3553,0,0,o.top,i.width,o.height,6408,5121,o.data):1==this.format?n.texSubImage2D(3553,0,0,o.top,i.width,o.height,6407,33635,new Uint16Array(o.data.buffer,o.data.byteOffset,o.data.byteLength>>1)):2==this.format?n.texSubImage2D(3553,0,0,o.top,i.width,o.height,6408,32819,new Uint16Array(o.data.buffer,o.data.byteOffset,o.data.byteLength>>1)):3==this.format?n.texSubImage2D(3553,0,0,o.top,i.width,o.height,6409,5121,o.data):4==this.format&&n.texSubImage2D(3553,0,0,o.top,i.width,o.height,6410,5121,o.data)}11==this.res.type&&n.generateMipmap(n.TEXTURE_2D),e()}}.bind(this)):c.download(this.url,1,this.cors,1,(function(i,r){if(!i)return this.setError(),void(e&&e());var n,a,o,s,h=r.slice(0,-4&r.byteLength),l=new Uint16Array(h,0),c=255&l[0],u=!!(l[0]>>8),f=l[1],d=l[2],p=l[3]>>8,g=255&l[3],m=8;if(c!=this.type)return Log.error("texture type mismatch!"),this.setError(),void(e&&e());if(this.width=f,this.height=d,this.invWidth=1/f,this.invHeight=1/d,u){this.isCube=!0,n=[];for(var _=0;_<6;_++)for(a=[],n.push(a),o=0;o<p;o++)s=new Uint32Array(h,m)[0],m+=4,a[o]=new Uint8Array(r,m,s),m+=s}else for(a=[],o=0;o<p;o++)s=new Uint32Array(h,m)[0],m+=4,a[o]=new Uint8Array(r,m,s),m+=s;var v=0;switch(this.format){case 6:v=t.Texture.CompressTextureType.pvr4;break;case 5:v=t.Texture.CompressTextureType.etc1;break;case 7:switch(g){case 4:v=t.Texture.CompressTextureType.astc4x4;break;case 5:v=t.Texture.CompressTextureType.astc5x5;break;case 6:v=t.Texture.CompressTextureType.astc6x6;break;case 8:v=t.Texture.CompressTextureType.astc8x8;break;default:Log.error("bpp error")}break;case 8:v=t.Texture.CompressTextureType.dxt1}this.res.state=3,u?(Log.debug("load cube texture "+this.name+" "+this.width+"x"+this.height),this.tex=t.Texture.createCompressCubeTexture(f,d,v,9729,n)):(Log.debug("load texture "+this.name+" "+this.width+"x"+this.height),this.tex=t.Texture.createCompressTexture(f,d,v,10497,9729,a)),this.memSize=m,e&&e()}),this)},e.prototype.release=function(){if(useWGL){var e=t.getGL();this.tex&&(e.deleteTexture(this.tex),this.tex=null)}else this.img=null;this.memSize=0,this.res.state=1},e}(),f=function(){function i(i,r,n){this.state=1,this._callbacks=[],this.name=this.id=this.url=i,this.type=r,this._dataType=d[e[this.type]],this.args=n||{},this.cors=!0,this.isTexture()&&(this.data=new t.Texture(new u(this)))}return i.prototype.isTexture=function(){return 4==this.type||13==this.type||11==this.type},i.prototype.toString=function(){return this.url},i.prototype.onload=function(i,r){if(i)switch(this.state=3,this.data=r,this.type){case 3:this.data=t.parse.CSV(r),this.rawData=r;break;case 2:this.data=JSON.parse(r),this.rawData=r}else Log.error("load res "+this.url+" failed!"),this.data=p.Fallbacks[e[this.type]],this.state=4;for(var n=this._callbacks,a=0;a<this._callbacks.length;a++)n[a](i);this._callbacks=[]},i.prototype.getData=function(){return this.data,this.data},i.prototype.release=function(){this.isTexture()&&this.data&&this.data.release(),this.state=1,this.data=null},i.prototype.loadAsync=function(){var t=this;return new Promise((function(e,i){t.load((function(r){r?e(t.getData()):i()}))}))},i.prototype.load=function(t,e){1==this.state||2==this.state?(t&&this._callbacks.push(e?t.bind(e):t),1==this.state&&(this.isTexture()?this.data.load():(this.state=2,c.download(this.url,this._dataType,!0,10,this.onload,this)))):t&&t.call(e,3==this.state)},i}(),d={image:2,binary:1,text:0,json:0,csv:0,sound:3,gltf:0,model:1,spine:1,texture:1},p=function(){function i(i,r){this._state=1,this._callbacks=[],this.id=i,this.name=r.name||i,this.url=r.url,this.type=r.type,this.args=r,this._dataType=d[e[this.type]],this.width=r.width,this.height=r.height,10==this.type&&(this.state=3,this.data=new t.Texture({id:this.id,name:r.name,width:r.width,height:r.height,memSize:0},r.width,r.height),this.data.empty=!0)}return i.prototype.createImg=function(){var e=this.args,i=new t.Texture(new u(this),e.width,e.height);e.margin&&(i.margin="string"==typeof e.margin?t.parse.Number4(e.margin):e.margin),e.s9&&(i.s9="string"==typeof e.s9?t.parse.Number4(e.s9):e.s9),this.data=i},i.prototype.createTex=function(){var e=this.args;this.data=new t.Texture(new u(this),e.width,e.height)},i.prototype.createSub=function(){var e=this.args,i=this.parentImage.getData(),r=t.parse.Number4(e.region),n=i.createSubTexture(new t.Rect(r[0],r[1],r[2],r[3]),e.width,e.height);e.margin&&(n.margin="string"==typeof e.margin?t.parse.Number4(e.margin):e.margin),e.s9&&(n.s9="string"==typeof e.s9?t.parse.Number4(e.s9):e.s9),e.transpose&&(n.transpose=!0),this.data=n},i.prototype.init=function(){if(5==this.type){var t=this.args;t.region||Log.error("the res "+this.name+" has no region argument!"),this.parentImage=r[t.parent],this.parentImage||Log.error("the parent "+this.args.parentName+" is not exist!")}},i.prototype.toString=function(){return this.name},Object.defineProperty(i.prototype,"state",{get:function(){return 5==this.type?this.parentImage.state:this._state},set:function(t){if(this._state=t,3==t||4==t){for(var e=3==t,i=this._callbacks,r=0;r<this._callbacks.length;r++)i[r](e);this._callbacks=[]}},enumerable:!0,configurable:!0}),i.prototype.onload=function(r,n){if(r){switch(this.data=n,this.type){case 3:this.rawData=n,this.data=t.parse.CSV(n);break;case 2:this.rawData=n,this.data=JSON.parse(n)}0,this.state=3}else Log.error("load res "+this.url+" failed!"),this.data=i.Fallbacks[e[this.type]],this.state=4},i.prototype.getData=function(){return this.data||(4==this.type||13==this.type?this.createImg():11==this.type?this.createTex():5==this.type&&this.createSub()),this.data},i.prototype.release=function(){if(11==this.type||13==this.type||4==this.type)this.data.release(),this.state=1;else{if(5==this.type||10==this.type)return;this.state=1,this.rawData&&(this.rawData=null),this.data=null,this._callbacks=[]}},i.prototype.loadAsync=function(){var t=this;return new Promise((function(e,i){t.load((function(r){r?e(t.getData()):i()}))}))},i.prototype.load=function(t,e,i){t&&(5==this.type||1!=this.state&&2!=this.state?t.call(e,3==this.state):this._callbacks.push(e?t.bind(e):t)),1==this.state&&(4==this.type||13==this.type||11==this.type?this.getData().load():5==this.type?this.parentImage.load(t,e,i):(this.state=2,8==this.type?c.download(this.url,0,!1,i||7,(function(t,e){if(t){this.data=JSON.parse(e),this.rawData=e;var r=v(this.args.bin);r?c.download(r.url,1,!1,i||7,(function(t,e){t&&(this.bin=e),this.onload(t,this.data)}),this):(Log.error("bin not exist"),this.onload(!1,null))}else this.onload(t,e)}),this):c.download(this.url,this._dataType,!1,i||9,this.onload,this)))},i.Fallbacks={image:null,binary:new ArrayBuffer(0),text:"",json:{},sound:null},i}();function g(t,i){for(var n=t.resources.length,s=0;s<n;s++){var h=t.resources[s],c=a(h.name);null!=r[c]&&Log.warn("id duplicated: "+r[c].name),void 0!==h.url&&(o&&o[h.url]?(Log.debug("set local url: "+o[h.url]),h.url=o[h.url]):h.url=i+h.url),h.type=e[h.type],r[c]=new p(c,h),h.parent&&(r[c].args.parentName=h.parent,r[c].args.parent=a(h.parent))}for(var u in r)r[u].init();function f(t){var e=t.lastIndexOf("/");if(!(e<0)){var i=t.substring(0,e);l[i]||(l[i]=[]),l[i].push(t)}}var d=t.groups;n=d.length;for(var g=0;g<n;g++){var m=d[g].name;l[m]||(l[m]=[]),f(m)}for(g=0;g<n;g++){var _=d[g];if(""!=_.keys)for(var v=l[_.name],y=_.name+"/",b=_.keys.split(","),x=0;x<b.length;x++)v.push(a(y+b[x]))}}function m(t){return t?14==t.length&&0==t.indexOf("R:")?t.substr(2):a(t):""}function _(t,e,i){return n[t]||(n[t]=new f(t,e,i)),n[t]}function v(t,e){if(!t)return null;if(0==t.indexOf("ext:"))return _(t.substring(4),e||4);if(0==t.indexOf("http:"))return _(t,e||4);if(0==t.indexOf("https:"))return _(t,e||4);var i=m(t);return r[i]}function y(t,e){var i=l[e];if(i)for(var n=0;n<i.length;n++)y(t,i[n]);else if(r[e])t.push(e);else{var o=a(e);r[o]&&t.push(o)}}t.loadPackage=g,t.loadJSONPackage=function(t,e,i,r){c.download(t,0,!1,20,(function(t,n){if(!t)return Log.error("load res pack failed."),void i.call(r,!1);g(JSON.parse(n),e),i.call(r,!0)}),null)},t.loadJSONPackageAsync=function(t,e){return new Promise((function(i,r){c.download(t,0,!1,20,(function(t,n){t?(g(JSON.parse(n),e),i()):r()}),null)}))},t.setLocalResList=function(t,e){for(var i in o={},e){var r=e[i];o[r]=t+r}},t.loadResPackage=function(t,e,i){var n={i:4,w:13,x:11,p:5,P:5,s:7,t:1,j:2,c:3,b:6,e:10,g:8,m:9,n:12};function a(t){for(var e=0,i=0;i<t.length;i++)e<<=5,e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdef".indexOf(t[i]);return e}function s(t){return t.split(",").map((function(t){return a(t)}))}function c(t){return o&&o[t]?o[t]:e+t}function u(t){var e={},i=t.split("|");if(!(i.length<3)){var o=n[i[1]],l="P"==i[1],u=i[0];e.type=o,5==o?(e.parent=i[2],e.region=s(i[3]),e.width=i[4]?a(i[4]):e.region[2],e.height=i[5]?a(i[5]):e.region[3],i[6]&&(e.s9=s(i[6])),i[7]&&(e.margin=s(i[7])),i[7]&&(e.format=a(i[7])),i[8]&&(e.hitMask=i[8]),l&&(e.transpose=!0)):8==o?(e.url=c(i[2]),e.bin="R:"+i[3]):12==o?(e.url=c(i[2]),e.atlas="R:"+i[3]):4==o||13==o?(e.url=c(i[2]),4==o&&(e.url+=h),e.width=a(i[3]),e.height=a(i[4]),i[5]&&(e.s9=s(i[5])),i[6]&&(e.margin=s(i[6])),i[7]&&(e.format=a(i[7])),i[8]&&(e.hitMask=i[8])):11==o?(e.url=c(i[2]),e.width=a(i[3]),e.height=a(i[4]),e.types=s(i[5])):10==o?(e.width=a(i[2]),e.height=a(i[3])):e.url=c(i[2]),r[u]=new p(u,e)}}for(var f=t.split(";"),d=0;d<f.length;d++)u(f[d]);for(var g in r)r[g].init();function m(t){var e=t.lastIndexOf("/");if(!(e<0)){var i=t.substring(0,e);l[i]||(l[i]=[]),l[i].push(t)}}for(var _ in i)l[_]||(l[_]=[]),m(_),l[_].concat(i[_].split(","))},t.addGroup=function(t,e){for(var i=[],r=0;r<e.length;r++)i[r]=a(e[r]);l[t]=i},t.hasRes=function(t){return!!r[m(t)]},t.getExternalRes=_,t.getRes=v,t.allRes=function(){var t=[];for(var e in r)t.push(r[e]);return t},t.groupForEach=function(t,e){function i(t){if(l[t])for(var n=l[t],a=0;a<n.length;a++){var o=n[a];l[o]?i(i):e(r[n[a]])}}if(Array.isArray(t))for(var n=0;n<t.length;n++)i(t[n]);else i(t)},t.loadGroup=function(t,e,i){var n=[];if(Array.isArray(t))for(var a=0;a<t.length;a++)y(n,t[a]);else y(n,t);var o=0,s=0,h=null;function l(){Log.debug(this.name+" loaded"),e&&e.call(i,++s,o),s>=o&&h&&h()}for(var c in n){var u=r[n[c]];!u||1!=u.state&&2!=u.state||(o++,u.load(l,u,1))}return e&&e.call(i,s,o),new Promise((function(t,e){h=t}))}}(ez||(ez={})),function(t){var e=function(e){function i(t,i){var r=e.call(this,t,i)||this;return r._interval=0,r._index=0,r._pos=0,r._state=0,r._speedInv=1,r.color="#ffffff",r._interval=33,r}return __extends(i,e),i.toFrames=function(t){var e=[];function i(t,e){var i=t.toString();return"0".repeat(e-i.length)+i}if(t.frames)for(var r=t.frames.split(","),n=0;n<r.length;n++)e.push(t.prefix+r[n]);else{var a=t.from;if("string"==typeof a)for(var o=a.length,s=parseInt(a),h=(n=s,s+t.count);n<h;n++)e.push(t.prefix+i(n,o));else for(n=a,h=a+t.count;n<h;n++)e.push(t.prefix+n)}return e},i.prototype.getType=function(){return i.Type},i._update=function(e){for(var r=i.playings.concat(),n=0;n<r.length;n++)try{r[n]._update(e)}catch(t){Log.error("seqframe update exception: "+t.message+"\ncall stack: "+t.stack)}0==i.playings.length&&(t.removeTicker(i.playTicker),i.playTicker=void 0)},Object.defineProperty(i.prototype,"currInterval",{get:function(){return this._frameTimes&&this._frameTimes[this._index]?this._frameTimes[this._index]*this._speedInv:this._interval*this._speedInv},enumerable:!0,configurable:!0}),i.prototype._draw=function(t,e){if(this._frames){var i=this._frames[this._index];i&&!i.empty&&(i.ready?(t.setFillColor(this.color),(e*=this.opacity)<.01||(useWGL&&this.applyEffect(t),t.setAlphaBlend(e,this.blendMode),t.drawImage(i,ezasm.getglobalTrans(this._handle),this.width,this.height,i.subRect))):i.load())}},i.prototype._update=function(t){if(1==this._state&&this._frames)for(this._pos+=t;this._pos>this.currInterval;)if(this._pos-=this.currInterval,this._index++,this.setDirty(),this._index>=this._frames.length){if(!this.loop)return this._index=this._frames.length-1,void this.stop();this._index=0}},i.prototype._dispose=function(){if(this.onStop=void 0,this._frames=void 0,1==this._state){this._state=0;var t=i.playings,r=t.indexOf(this);-1!=r&&t.splice(r,1)}e.prototype._dispose.call(this)},i.prototype._setWidth=function(t){var e=this._handle;e&&ezasm.setwidth(e,t)&&this.setDirty()},i.prototype._setHeight=function(t){var e=this._handle;e&&ezasm.setheight(e,t)&&this.setDirty()},Object.defineProperty(i.prototype,"width",{get:function(){return ezasm.getwidth(this._handle)},set:function(t){this._setWidth(t),this._width=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return ezasm.getheight(this._handle)},set:function(t){this._setHeight(t),this._height=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frames",{get:function(){return this._frames},set:function(t){if(this.stop(),t||(this._frames=void 0),!Array.isArray(t)){var e=t;t=i.toFrames(e),e.fps&&(this.fps=e.fps),e.loop&&(this.loop=e.loop)}this.loadFrames(t)},enumerable:!0,configurable:!0}),i.prototype.loadFrames=function(e){for(var i=[],r=function(t){void 0===this._width&&this._setWidth(a.width),void 0===this._height&&this._setHeight(a.height)}.bind(this),n=0;n<e.length;n++)if(e[n])if("string"==typeof e[n]){var a=t.getRes(e[n]).getData();r&&(r(a),r=null),i[n]=a,a.ready||a.load()}else i[n]=e[n],r&&(r(a),r=null);else i[n]=null;this._frames=i,this._autoPlay&&this.play()},Object.defineProperty(i.prototype,"autoPlay",{get:function(){return this._autoPlay},set:function(t){this._autoPlay=t,t&&this._frames&&0==this.state&&this.play()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frameIndex",{get:function(){return this._index},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._pos},set:function(t){this._pos!=t&&(this._pos=t,this.setDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"length",{get:function(){for(var t=0,e=0;e<this._frames.length;e++)this._frameTimes&&this._frameTimes[e]?t+=this._frameTimes[e]:t+=this._interval;return t*this._speedInv},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fps",{get:function(){return 1e3/this._interval},set:function(t){this._interval=1e3/t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),i.prototype.play=function(){if(1!=this._state){var e=i;0==this._state&&(this._pos=0,this._index=0,e.playings.push(this)),this._state=1,e.playTicker||(e.playTicker=t.addTicker(e._update))}},i.prototype.pause=function(){1==this._state&&(this._state=2)},i.prototype.stop=function(){if(0!=this._state){this._state=0;var t=i.playings,e=t.indexOf(this);-1!=e&&t.splice(e,1),this.onStop&&this.onStop(),this.autoRemove&&this.dispose()}},Object.defineProperty(i.prototype,"speed",{set:function(t){this._speedInv=1/t},enumerable:!0,configurable:!0}),i.prototype.setFrameDuration=function(t,e){this._frameTimes=this._frameTimes||[],this._frameTimes[t]=e},Object.defineProperty(i.prototype,"framesDuration",{set:function(t){this._frameTimes=t},enumerable:!0,configurable:!0}),i.playTicker=null,i.playings=[],i.Type="SeqFrame",i}(t.Sprite);t.SeqFrameSprite=e,t.Sprite.register(e.Type,(function(t,i){return new e(t,i)}))}(ez||(ez={})),function(t){var e;function i(){if(0!=e.length){o(e,a);for(var i,r,n=0;n<e.length;){for(var s=n+1;s<e.length&&!(e[n].zIndex<e[s].zIndex);s++)if(i=e[n],r=e[s],i.blendMode===r.blendMode&&i.gradient===r.gradient&&i.texture===r.texture&&i.shader===r.shader&&!i.params&&!r.params){for(var h=e[s],l=s;l>n;l--)e[l]=e[l-1];e[++n]=h}n++}var c=e[n=0];for(c.color&&t.RenderContext.setFillColor(c.color),t.RenderContext.setAlphaBlend(c.alpha,c.blendMode),c.gradient&&t.RenderContext.setFillGradient(c.gradient),t.RenderContext.setShader(c.shader,c.params),c.commit(),s=1;s<e.length;s++){var u=e[s];c.alpha==u.alpha&&c.blendMode==u.blendMode||t.RenderContext.setAlphaBlend(u.alpha,u.blendMode),u.gradient?t.RenderContext.setFillGradient(u.gradient):c.color!=u.color&&t.RenderContext.setFillColor(u.color),c.shader!==u.shader&&t.RenderContext.setShader(u.shader,u.params),u.commit(),c=u}}}var r={color:"",gradent:null,shader:null,alpha:0,blendMode:t.BlendMode.Normal,zIndex:0,toRS:function(){return{zIndex:this.zIndex,color:this.color,gradent:this.gradent,shader:this.shader,alpha:this.alpha,blendMode:this.blendMode}},setZ:function(t){this.zIndex=t},fillRect:function(i,r,n){var a=this.toRS();a.commit=function(){t.RenderContext.fillRect(i,r,n)},e.push(a)},drawImage:function(i,r,n,a,o){var s=this.toRS();s.texture=i.id,s.commit=function(){t.RenderContext.drawImage(i,r,n,a,o)},e.push(s)},drawImageRepeat:function(i,r,n,a,o){var s=this.toRS();s.texture=i.id,s.commit=function(){t.RenderContext.drawImageRepeat(i,r,n,a,o)},e.push(s)},drawImageS9:function(i,r,n,a,o,s){var h=this.toRS();h.texture=i.id,h.commit=function(){t.RenderContext.drawImageS9(i,r,n,a,o,s)},e.push(h)},setAlphaBlend:function(t,e){this.alpha=t,this.blendMode=e},setFillColor:function(t){this.color=t,this.gradient=null},setFillGradient:function(t){this.gradient=t},setShader:function(t,e){this.shader=t,this.params=e},drawText:function(i,r,n,a,o,s,h,l){var c=this.toRS();c.texture="_font",c.commit=function(){t.RenderContext.drawText(i,r,n,a,o,s,h,l)},e.push(c)},drawTextCache:function(i,r,n,a){var o=this.toRS();o.texture="_font",o.commit=function(){t.RenderContext.drawTextCache(i,r,n,a)},e.push(o)},bindTexture:function(t,e){throw new Error("unsupport bindTexture in bacth mode")}};function n(t,e,i,r,n){for(var a=i-e;a>0;){var o=a>>1;n(t[e+o],r)<=0?(e+=o+1,a-=o+1):a=o}return e}function a(t,e){return(t=t.zIndex)>(e=e.zIndex)?1:t==e?0:-1}function o(t,e){for(var i=[],r=t.length,a=0;a<t.length-1;a++)if(e(t[a+1],t[a])<0){r=a+1;break}for(;r<t.length;){var o=0;for(i[o++]=t[r],a=r;a<t.length-1&&0==e(t[a+1],t[a]);a++)i[o++]=t[a+1];var s=n(t,0,r,i[0],e);for(a=r-1;a>=s;a--)t[a+o]=t[a];for(a=0;a<o;a++)t[s+a]=i[a];for(r+=o;r<t.length&&!(e(t[r],t[r-1])<0);)++r}}var s=function(n){function a(t,e){var i=n.call(this,t,e)||this;return i._namedItems={},i._items=[],i._isDirty=!0,i._needSort=!0,i._bound=null,i}return __extends(a,n),a.prototype._dispose=function(){n.prototype._dispose.call(this),this.clear(),this.destroyBuffer()},a.prototype.setDirty=function(t){void 0===t&&(t=!1),this._parent&&(this._isDirty=!0,this.visible&&(this._parent.makeDirty(t),this.ownerBuffer&&this._parent.needPreRender(this)))},a.prototype.getType=function(){return a.Type},a.prototype.preRender=function(n){if(!(this.disposed||!this.ownerBuffer||this.width<=0||this.height<=0)){this._rtBuffer||(this._rtBuffer=t.RenderTexture.create(this.width,this.height)),t.RenderContext._textScale=1,ezasm.setGlobalTransform(ezasm.getglobalTrans(this._handle)),t.RenderContext.beginRender(this._rtBuffer,n);var a=t.RenderContext;this.batchMode&&(a=r,e=[]),this._render(a,1),this.batchMode&&(i(),e=null),t.RenderContext.endRender(),ezasm.setGlobalTransform(0)}},a.prototype._prepare=function(e,i,r){var n=this._handle,a=!0;if(this._buildTransform(),r||!ezasm.getglobalTrans(n)){if(r=!0,ezasm.buildGlobalTrans(n,i),this.width>0){var o=ezasm.handleToFloatArray(ezasm.calcBound(n),4);this._bound=new t.Rect(o[0],o[1],o[2]-o[0],o[3]-o[1])}else this._bound=e;this._cachedCommands&&(this._cachedCommands=null),a=!1}this._isDirty&&(a=!1,this._cachedCommands&&(this._cachedCommands=null)),this.drawCache&&(this._noChange=a),this.culled=this._parent.culling&&this.width>0&&(this._bound.left>=e.right||this._bound.right<=e.left||this._bound.top>=e.bottom||this._bound.bottom<=e.top),this.culled||this._prepareRender(this.clip?t.Rect.intersect(this._bound,e):e,ezasm.getglobalTrans(n),r)},a.prototype._draw=function(n,a){var o;if(!((a*=this.opacity)<.01))if(this._rtBuffer)useWGL&&this.applyEffect(n),n.setAlphaBlend(a,this.blendMode),n.setFillColor(this.color),ezasm.saveTempStack(),useWGL?(o=ezasm.tempAllocMat2x3(1,0,0,-1,0,this.height),ezasm.mat2x3Append(o,ezasm.getglobalTrans(this._handle))):o=ezasm.getglobalTrans(this._handle),n.drawImage(this._rtBuffer,o,this.width,this.height),ezasm.restoreTempStack();else if(!this.ownerBuffer){if(this._cachedCommands){if(this._cachedCommands.fontRev==t.FontCache.rev)return void t.RenderContext.replay(this._cachedCommands);this._cachedCommands=null}var s=useWGL&&this.drawCache&&n==t.RenderContext&&this._noChange;s&&(s=n.beginRecorder());var h=!0;this.clip&&(h=n.pushClipRect(this._bound)),h&&(this.batchMode&&(n!=t.RenderContext?Log.error("batch mode can't be nested!"):(n=r,e=[])),this._render(n,a),this.batchMode&&(n=t.RenderContext,i(),e=null)),this.clip&&n.popClipRect(),s&&(this._cachedCommands=t.RenderContext.endRecorder(),this._cachedCommands&&Log.debug("geneate draw cache cmd:"+this._cachedCommands.length))}},a.prototype.destroyBuffer=function(){this._rtBuffer&&(this._rtBuffer.dispose(),this._rtBuffer=null)},Object.defineProperty(a.prototype,"clip",{get:function(){return ezasm.getClip(this._handle)},set:function(t){this.clip!=t&&(ezasm.setClip(this._handle,t),this.setDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"width",{get:function(){return ezasm.getwidth(this._handle)},set:function(t){this.width!=t&&(this.destroyBuffer(),ezasm.setwidth(this._handle,t))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"height",{get:function(){return ezasm.getheight(this._handle)},set:function(t){this.height!=t&&(this.destroyBuffer(),ezasm.setheight(this._handle,t))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ownerBuffer",{get:function(){return ezasm.getOwnerBuffer(this._handle)},set:function(t){t!=this.ownerBuffer&&(ezasm.setOwnerBuffer(this._handle,t),this.setDirty(),t||this.destroyBuffer())},enumerable:!0,configurable:!0}),a.prototype.saveToCanvas=function(){if(!this._rtBuffer)return null;var e=t.internal.createCanvas(),i=e.width=this._rtBuffer.width,r=e.height=this._rtBuffer.height,n=e.getContext("2d");if(useWGL){var a=n.createImageData(i,r),o=t.getGL();o.bindFramebuffer(36160,this._rtBuffer.framebuffer),o.readPixels(0,0,i,r,o.RGBA,o.UNSIGNED_BYTE,a.data),o.bindFramebuffer(36160,null);for(var s=4*i,h=new Uint8ClampedArray(s),l=r>>1,c=0;c<l;c++){var u=a.data.subarray(c*s,(c+1)*s),f=a.data.subarray((r-c-1)*s,(r-c)*s);h.set(f),f.set(u),u.set(h)}n.putImageData(a,0,0)}else n.drawImage(this._rtBuffer.canvas,0,0);return e},a.prototype.makeDirty=function(t){this._needSort=t||this._needSort,this._isDirty||(this._isDirty=!0,this.setDirty(!1))},a.Type="SubStage",a}(t.Sprite);t.SubStageSprite=s;var h=function(){function e(){this._namedItems={},this._items=[],this._isDirty=!0,this._needSort=!0,this._preRenderList=[]}return e.prototype._render=function(t,e){this._isDirty=!1;for(var i=0;i<this._items.length;i++){var r=this._items[i];r.visible&&!r.culled&&r._draw(t,e)}},e.prototype._prepareRender=function(t,e,i){this._needSort&&(o(this._items,a),this._needSort=!1);for(var r=0;r<this._items.length;r++){var n=this._items[r];n.visible&&n._prepare(t,e,i)}},e.prototype.needPreRender=function(t){this._preRenderList?this._preRenderList.push(t):this._parent.needPreRender(t)},e.prototype.render=function(e,i){if(t.RenderContext.scale=e.scale,ezasm.saveTempStack(),this._prepareRender(new t.Rect(0,0,e.width,e.height),ezasm.tempAllocMat2x3(1,0,0,1,0,0),!1),ezasm.restoreTempStack(),this._preRenderList&&this._preRenderList.length>0){for(var r=0;r<this._preRenderList.length;r++)this._preRenderList[r].preRender(i);this._preRenderList=[]}t.RenderContext.beginRender(e,i),this._render(t.RenderContext,1),t.RenderContext.endRender()},e.prototype.addChild=function(t,e){if(e){if(this._namedItems[e])throw new Error("id conflict! id:"+e);this._namedItems[e]=t}this._needSort=!0,this._items.push(t)},e.prototype.makeDirty=function(t){this._needSort=t||this._needSort,this._isDirty=!0},Object.defineProperty(e.prototype,"count",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty",{get:function(){return this._isDirty},enumerable:!0,configurable:!0}),e.prototype.getItem=function(t){return this._items[t]},e.prototype._remove=function(t){var e=this._items.indexOf(t);if(-1==e)throw new Error("this sprite is not exist in stage!");this._items.splice(e,1),t.id&&delete this._namedItems[t.id],this.makeDirty(!1)},e.prototype.remove=function(t){this._remove(t),t._dispose()},e.prototype.bringToTop=function(t){var e=this._items.indexOf(t);if(-1==e)throw new Error("this sprite is not exist in stage!");for(var i=0;i<e;i++)this._items[i+1]=this._items[i];this._items[0]=t,this.makeDirty(!0)},e.prototype.bringToBottom=function(t){var e=this._items.indexOf(t);if(-1==e)throw new Error("this sprite is not exist in stage!");for(var i=e;i<this._items.length-1;i++)this._items[i]=this._items[i+1];this._items[this._items.length-1]=t,this.makeDirty(!0)},e.prototype.load=function(e){for(var i=[],r=0;r<e.length;r++){var n=e[r],a=t.Sprite.create(n.type,this,n.id);for(var o in i.push(a),n)"id"!==o&&"type"!==o&&"onLoad"!==o&&(a[o]=n[o]);"SubStage"==n.type&&n.childs&&a.load(n.childs),n.onLoad&&n.onLoad.call(a)}return i},e.prototype.find=function(t){if(this._namedItems[t])return this._namedItems[t];for(var e=0;e<this._items.length;e++){var i=this._items[e];if(i.stage){var r=i.stage.find(t);if(r)return r}}return null},e.prototype.clear=function(){if(this._namedItems={},this._items.length>0)for(var t=this._items.concat(),e=0;e<t.length;e++)t[e]._dispose();this._items=[]},e.prototype.hitFind=function(t,e,i){if(this._needSort&&(o(this._items,a),this._needSort=!1),i){for(var r=[],n=this._items.length-1;n>=0;n--){if((h=this._items[n]).visible){(l=h.localTransform.clone()).invert();var s=[t,e];l.transform(s),h.hitTest(s[0],s[1])&&r.push(h)}}return r}for(n=this._items.length-1;n>=0;n--){var h;if((h=this._items[n]).visible){var l;(l=h.localTransform.clone()).invert();s=[t,e];if(l.transform(s),h.hitTest(s[0],s[1]))return h}}return null},e}();t.createStage=function(){return new h},Object.getOwnPropertyNames(h.prototype).forEach((function(t){if(!s.prototype[t]){var e=Object.getOwnPropertyDescriptor(h.prototype,t);e.value?s.prototype[t]=h.prototype[t]:Object.defineProperty(s.prototype,t,e)}})),t.Sprite.register(s.Type,(function(t,e){return new s(t,e)}))}(ez||(ez={})),function(t){var e=null,i=[],r=[],n=function(){function t(e,i,r){this._data=e,this._width=i,this._height=r,(e.tex||e.img)&&e.maxAge<0&&t.addTextureData(e)}return t.addTextureAge=function(){i.forEach((function(t){return t.age++}))},t.init=function(i){e=i;var r=new Image;if(r.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAB3RJTUUH3wUYDBYenXyFigAAAYZJREFUeJy11sHKgkAUhuFTCyGI2gaVEQiCIAlCEHSdbVtEd1CbVt1EEASCICiCEHQB37+Y+bXSGY9lZ9Pg4PuYStQBQL+crvzc7ShJWqsmCR2Pcg0A2y2I4DiIY3w/cQzHgWHgcABA8pBtSyNNW6gTwbbF5ZLciKIWjDQt6lEkjlGx/aVRVX8FhGFZIILrNjMU9RLwmaGuVwFNjbxuWeW6AhDGfA4ieJ7OSFO4rqauBjgGo64F3ows+6BeBwAIwwqDXWcAZaNJnQcIwzRBhMVCvjPzOafOBoQxmYAIRJjNmHUAXe3P7tP0ejQYyPVwSP0+90TWZaQpPA9EmE4xHoMIvo/7nXMqA8jr4r4HgXwePKMOeKuLCQL5PZbLWkMLZFlRD8OXLbahBjT1JoYCqK2Lud2ksVqpjCqAWecZJaBRvWw8Hlogr5smty7melUZT0CWwfc/qWuNf+DLem6MRiDCep0b1FpdYRAAnM8wjBbqb8Z+j+IWnU7t1MVcLthsxLKDH/99/wOjNVTQK+4QyQAAAABJRU5ErkJggg==",t.errorFallback={id:"_fallback",name:"fallback",width:r.width,height:r.height,memSize:0,maxAge:-1,invWidth:1/r.width,invHeight:1/r.height},useWGL){r.onload=function(){t.errorFallback.tex=t.createGLTextureFromImage(r,33071,!1)};var n=e.getExtension("EXT_texture_filter_anisotropic");n&&(t.TEXTURE_MAX_ANISOTROPY_EXT=n.TEXTURE_MAX_ANISOTROPY_EXT,t.anisotropicMax=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));var a=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc"),o=e.getExtension("WEBGL_compressed_texture_astc"),s=e.getExtension("WEBGL_compressed_texture_etc1"),h=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");s&&(t.CompressTextureType.etc1=s.COMPRESSED_RGB_ETC1_WEBGL,t.compressFormat=5),a&&(t.CompressTextureType.dxt1=a.COMPRESSED_RGB_S3TC_DXT1_EXT,t.compressFormat=8),h&&(t.CompressTextureType.pvr4=h.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,t.compressFormat=6),o&&(t.CompressTextureType.astc4x4=o.COMPRESSED_RGBA_ASTC_4x4_KHR,t.CompressTextureType.astc5x5=o.COMPRESSED_RGBA_ASTC_5x5_KHR,t.CompressTextureType.astc6x6=o.COMPRESSED_RGBA_ASTC_6x6_KHR,t.CompressTextureType.astc8x8=o.COMPRESSED_RGBA_ASTC_8x8_KHR,t.compressFormat=7),t.compressFormat||(t.compressFormat=1),Log.info("compressFormat: "+t.compressFormat)}else t.errorFallback.img=r},t.addTextureData=function(t){t.maxAge<0?r.push(t):(t.age=0,i.push(t))},t.profile=function(){var t=0;return i.forEach((function(e){return t+=e.memSize})),r.forEach((function(e){return t+=e.memSize})),{activeTextueres:i.map((function(t){return{name:t.name,width:t.width,height:t.height,size:t.memSize,age:t.age}})),permanentTextures:r.map((function(t){return{name:t.name,width:t.width,height:t.height,size:t.memSize}})),totalMemory:t}},t.releaseUnusedTexture=function(t){for(var e=0;e<r.length;e++){(n=r[e]).tex||n.img||(r.splice(e,1),e--)}for(e=0;e<i.length;e++){var n;(n=i[e]).age>=(n.maxAge||t)&&(n.release(),i.splice(e,1),e--)}},Object.defineProperty(t.prototype,"isCube",{get:function(){return this._data.isCube},enumerable:!0,configurable:!0}),t.prototype.release=function(){this._data.release()},Object.defineProperty(t.prototype,"name",{get:function(){return this._data.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._data.id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleX",{get:function(){var t=this._width;return this.margin&&(t-=this.margin[0]+this.margin[2]),this.subRect?t/this.subRect.width:t/this._data.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleY",{get:function(){var t=this._height;return this.margin&&(t-=this.margin[1]+this.margin[3]),this.subRect?t/this.subRect.height:t/this._data.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memSize",{get:function(){return this._data.memSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ready",{get:function(){return useWGL?!!this._data.tex:!!this._data.img},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"invWidth",{get:function(){return this._data.invWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"invHeight",{get:function(){return this._data.invHeight},enumerable:!0,configurable:!0}),t.prototype.load=function(e){var i=this._data;this._data.load((function(){t.addTextureData(i),e&&e()}))},Object.defineProperty(t.prototype,"image",{get:function(){return this._data.img},enumerable:!0,configurable:!0}),t.prototype.bindTexture=function(t){this._data.tex?(this._data.age=0,e.activeTexture(33984+t),this._data.isCube?e.bindTexture(34067,this._data.tex):e.bindTexture(3553,this._data.tex)):Log.error("the texture "+this.name+" is not loaded.")},t.prototype.createSubTexture=function(e,i,r){(e.left<0||e.top<0||e.right>this.width||e.bottom>this.height)&&Log.warn("subrect("+e.left+","+e.top+","+e.right+","+e.bottom+") out of bound of '"+this.name+"'."),this.subRect&&(e.left+=this.subRect.left,e.top+=this.subRect.top);var n=new t(this._data,i||e.width,r||e.height);return n.subRect=e,n},t.createFromImage=function(i){if(useWGL){var r=t.createGLTextureFromImage(i,33071,!1);return new t(a={id:n="image"+Date.now(),name:n,maxAge:-1,width:i.width,height:i.height,memSize:i.width*i.height*4,invWidth:1/i.width,invHeight:1/i.height,tex:r,release:function(){e.deleteTexture(this.tex),this.tex=null}},a.width,a.height)}var n,a;return new t(a={id:n="image"+Date.now(),name:n,maxAge:-1,width:i.width,height:i.height,memSize:i.width*i.height*4,img:i,release:function(){this.img=null}},a.width,a.height)},t.createGLTextureFromImage=function(t,i,r){var n=e.createTexture();return e.bindTexture(3553,n),e.pixelStorei(37441,1),e.texImage2D(3553,0,6408,6408,5121,t),e.texParameteri(3553,10242,i),e.texParameteri(3553,10243,i),e.texParameteri(3553,10240,9729),r?(e.texParameteri(3553,10241,9987),e.generateMipmap(3553)):e.texParameteri(3553,10241,9729),n},t.createCompressTexture=function(t,i,r,n,a,o){var s=e.createTexture();e.bindTexture(3553,s);for(var h=0;h<o.length;h++)e.compressedTexImage2D(3553,h,r,t,i,0,o[h]),t=Math.max(1,t>>1),i=Math.max(1,i>>1);return e.texParameteri(3553,10242,n),e.texParameteri(3553,10243,n),e.texParameteri(3553,10240,a),e.texParameteri(3553,10241,o.length>1?9985:a),s},t.createCubeTextureFromImage=function(t){var i=e.createTexture();e.bindTexture(e.TEXTURE_CUBE_MAP,i);for(var r=0;r<6;r++)e.texImage2D(34069+r,0,6408,6408,5121,t[r]);return e.texParameteri(34067,10240,9729),e.texParameteri(34067,10241,9729),e.generateMipmap(e.TEXTURE_CUBE_MAP),e.bindTexture(e.TEXTURE_CUBE_MAP,null),i},t.createCompressCubeTexture=function(t,i,r,n,a){var o=e.createTexture();e.bindTexture(e.TEXTURE_CUBE_MAP,o);for(var s=0;s<6;s++)for(var h=a[s],l=t,c=i,u=0;u<h.length;u++)e.compressedTexImage2D(34069+s,u,r,l,c,0,h[u]),l=Math.max(1,l>>1),c=Math.max(1,c>>1);return e.texParameteri(34067,10240,n),e.texParameteri(34067,10241,h.length>1?9985:n),e.bindTexture(e.TEXTURE_CUBE_MAP,null),o},t.createGLTexture=function(t,i,r,n,a,o,s,h){var l=e.createTexture();return e.bindTexture(3553,l),e.pixelStorei(37441,o?1:0),e.pixelStorei(3317,1),0==r?e.texImage2D(3553,0,6408,t,i,0,6408,5121,h):1==r?e.texImage2D(3553,0,6407,t,i,0,6407,33635,h):2==r?e.texImage2D(3553,0,6408,t,i,0,6408,32819,h):3==r?e.texImage2D(3553,0,6409,t,i,0,6409,5121,h):4==r&&e.texImage2D(3553,0,6410,t,i,0,6410,5121,h),e.texParameteri(3553,10242,n),e.texParameteri(3553,10243,n),e.texParameteri(3553,10240,a),s?e.texParameteri(3553,10241,9987):e.texParameteri(3553,10241,a),s&&e.generateMipmap(e.TEXTURE_2D),l},t.CompressTextureType={dxt1:0,astc4x4:0,astc5x5:0,astc6x6:0,astc8x8:0,etc1:0,pvr4:0},t}();t.Texture=n;var a=function(t){function i(e,i,r){return t.call(this,e,i,r)||this}return __extends(i,t),Object.defineProperty(i.prototype,"glTex",{get:function(){return this._data.tex},enumerable:!0,configurable:!0}),i.create=function(t,r,n,a,o,s,h){var l=e.createTexture();return e.activeTexture(33984),e.bindTexture(3553,l),e.pixelStorei(37441,1),e.texImage2D(3553,0,a,r,n,0,a,5121,h),e.texParameteri(3553,10242,o),e.texParameteri(3553,10243,o),e.texParameteri(3553,10240,s),e.texParameteri(3553,10241,s),new i({id:t,name:t,width:r,height:n,memSize:r*n*4,maxAge:-1,tex:l,invWidth:1/r,invHeight:1/n},r,n)},i.prototype.release=function(){e.deleteTexture(this._data.tex),this._data.tex=null},i}(n);t.RawTexture=a;var o=function(i){function r(t,e,r){var n=i.call(this,t,e,r)||this;return n.scale=1,n}return __extends(r,i),r.prototype.dispose=function(){this._data.release()},Object.defineProperty(r.prototype,"framebuffer",{get:function(){return this._data.fb},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"canvas",{get:function(){return this._data.canvas},enumerable:!0,configurable:!0}),r.prototype.resize=function(t,i){this._width==t&&this._height==i||(useWGL?(this._data.tex&&(e.bindTexture(3553,this._data.tex),e.texImage2D(3553,0,6408,t,i,0,6408,5121,null)),this._data.width=t,this._data.height=i):(this._data.canvas.width=t,this._data.canvas.height=i),this._width=t,this._height=i)},r.createFromCanvas=function(t){r.allocId++;var e="_rt"+r.allocId,i={id:e,name:e,width:t.width,height:t.height,memSize:t.width*t.height*4,img:t,canvas:t,release:function(){this.img=null,this.canvas.width=0,this.canvas.height=0,this.canvas=null}};return new r(i)},r.create=function(i,n,a){void 0===a&&(a=!1),r.allocId++;var o="_rt"+r.allocId;if(i|=0,n|=0,useWGL){if((s={id:o,name:o,width:i,height:n,memSize:i*n*4,maxAge:-1,invWidth:1/i,invHeight:1/n}).tex=e.createTexture(),s.fb=e.createFramebuffer(),s.release=function(){e.deleteTexture(this.tex),e.deleteFramebuffer(this.fb),this.depth&&e.deleteRenderbuffer(this.depth),this.tex=null,this.fb=null},e.bindTexture(3553,s.tex),e.pixelStorei(37441,1),e.texParameteri(3553,10242,33071),e.texParameteri(3553,10243,33071),e.texParameteri(3553,10240,9729),e.texParameteri(3553,10241,9729),e.texImage2D(3553,0,6408,i,n,0,6408,5121,null),e.bindFramebuffer(36160,s.fb),e.framebufferTexture2D(36160,36064,3553,s.tex,0),a&&(s.depth=e.createRenderbuffer(),e.bindRenderbuffer(36161,s.depth),e.renderbufferStorage(36161,34041,i,n),e.framebufferRenderbuffer(36160,33306,36161,s.depth)),36053!=e.checkFramebufferStatus(36160))throw Log.error("create framebuffer failed. status: "+e.checkFramebufferStatus(36160)),s.release(),new Error("create frame buffer failed!");return e.bindTexture(3553,null),e.bindFramebuffer(36160,null),new r(s,i,n)}var s,h=t.internal.createCanvas();return h.width=i,h.height=n,new r(s={id:o,name:o,width:i,height:n,memSize:i*n*4,maxAge:-1,canvas:h,invWidth:1/i,invHeight:1/n},i,n)},r.allocId=0,r}(n);t.RenderTexture=o}(ez||(ez={})),function(t){var e=function(){function t(){}return t.get=function(t){return t<-1&&(t=-1),t>1&&(t=1),function(e){return 0==t?e:t<0?e*(e*-t+1+t):e*((2-e)*t+(1-t))}},t.getPowIn=function(t){return function(e){return Math.pow(e,t)}},t.getPowOut=function(t){return function(e){return 1-Math.pow(1-e,t)}},t.getPowInOut=function(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}},t.sineIn=function(t){return 1-Math.cos(t*Math.PI/2)},t.sineOut=function(t){return Math.sin(t*Math.PI/2)},t.sineInOut=function(t){return-.5*(Math.cos(Math.PI*t)-1)},t.getBackIn=function(t){return function(e){return e*e*((t+1)*e-t)}},t.getBackOut=function(t){return function(e){return e*e*((t+1)*e+t)+1}},t.getBackInOut=function(t){return t*=1.525,function(e){return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},t.circIn=function(t){return-(Math.sqrt(1-t*t)-1)},t.circOut=function(t){return Math.sqrt(1- --t*t)},t.circInOut=function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},t.bounceIn=function(e){return 1-t.bounceOut(1-e)},t.bounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},t.bounceInOut=function(e){return e<.5?.5*t.bounceIn(2*e):.5*t.bounceOut(2*e-1)+.5},t.getElasticIn=function(t,e){var i=2*Math.PI;return function(r){if(0==r||1==r)return r;var n=e/i*Math.asin(1/t);return-t*Math.pow(2,10*(r-=1))*Math.sin((r-n)*i/e)}},t.getElasticOut=function(t,e){var i=2*Math.PI;return function(r){if(0==r||1==r)return r;var n=e/i*Math.asin(1/t);return t*Math.pow(2,-10*r)*Math.sin((r-n)*i/e)+1}},t.getElasticInOut=function(t,e){var i=2*Math.PI;return function(r){var n=e/i*Math.asin(1/t);return(r*=2)<1?t*Math.pow(2,10*(r-=1))*Math.sin((r-n)*i/e)*-.5:t*Math.pow(2,-10*(r-=1))*Math.sin((r-n)*i/e)*.5+1}},t.linear=function(t){return t},t.quadIn=t.getPowIn(2),t.quadOut=t.getPowOut(2),t.quadInOut=t.getPowInOut(2),t.cubicIn=t.getPowIn(3),t.cubicOut=t.getPowOut(3),t.cubicInOut=t.getPowInOut(3),t.quartIn=t.getPowIn(4),t.quartOut=t.getPowOut(4),t.quartInOut=t.getPowInOut(4),t.quintIn=t.getPowIn(5),t.quintOut=t.getPowOut(5),t.quintInOut=t.getPowInOut(5),t.elasticIn=t.getElasticIn(1,.3),t.elasticInOut=t.getElasticInOut(1,.3*1.5),t.elasticOut=t.getElasticOut(1,.3),t.backIn=t.getBackIn(1.7),t.backOut=t.getBackOut(1.7),t.backInOut=t.getBackInOut(1.7),t}();t.Ease=e;var i=function(){function i(t,e){if(this.steps=[],this._state=0,this.stepPos=0,this.currStep=0,this.loop=!1,this._target=t,t&&this.steps.push({action:5,target:t}),e)for(var r=0;r<e.length;r++){var n=e[r];n.set?this.steps.push({action:1,props:Array.isArray(n.set)?n.set[0]:n.set}):n.move?this.steps.push({action:2,props:n.move[0],duration:n.move[1],ease:n.move[2]||i.defaultEase}):n.wait?this.steps.push({action:3,duration:n.wait}):n.call?this.steps.push({action:4,props:{func:n.call[0],ctx:n.call[1]}}):n.to?this.to(n.to[0],n.to[1],n.to[2]):n.target&&this.steps.push({action:5,target:n.target})}}return i.add=function(t,e){return new i(t,e)},i.stopTweens=function(t){for(var e=i.playings.concat(),r=0;r<e.length;r++){var n=e[r];n._target===t&&n.stop()}},i.update=function(e){for(var r=i.playings.concat(),n=0;n<r.length;n++)r[n].advance(e);0==i.playings.length&&(t.removeTicker(i.playTicker),i.playTicker=void 0)},i.prototype.set=function(t){return this.steps.push({action:1,props:t}),this},i.prototype.move=function(t,e,r){return this.steps.push({action:2,props:t,duration:e,ease:r||i.defaultEase}),this},i.prototype.to=function(t,e,r){var n=null,a={};for(var o in t){var s;for(s=this.steps.length-1;s>=0;s--){var h=this.steps[s];if(h.target){n=h.target,s=-1;break}if(h.props){if(Array.isArray(h.props[o]))a[o]=[h.props[o][1],t[o]];else{if("number"!=typeof h.props[o])continue;a[o]=[h.props[o],t[o]]}break}}if(s<0){var l=n[o];"number"!=typeof l?(Log.warn("Tween.to "+o+" has no initial pos."),a[o]=[0,t[o]]):a[o]=[l,t[o]]}}return this.steps.push({action:2,props:a,duration:e,ease:r||i.defaultEase}),this},i.prototype.target=function(t){return t?(this.steps.push({action:5,target:t}),this):this},i.prototype.wait=function(t){return this.steps.push({action:3,duration:t}),this},i.prototype.call=function(t,e){return this.steps.push({action:4,props:{func:t,ctx:e}}),this},i.prototype.disposeTarget=function(){return this.steps.push({action:7}),this},i.prototype.func=function(t,e,r,n){return this.steps.push({action:6,duration:t,props:{func:e,ctx:r},ease:n||i.defaultEase}),this},i.prototype.append=function(t){return this.steps=this.steps.concat(t.steps),this},i.prototype.config=function(t){for(var e in t)this[e]=t[e];return this},i.prototype.play=function(){if(1!=this._state)return 0==this._state&&i.playings.push(this),this._state=1,i.playTicker||(i.playTicker=t.addTicker(i.update)),this},i.prototype.waitForEnd=function(){var t=this;return this.play(),new Promise((function(e,i){t._promise={resolve:e,reject:i}}))},i.prototype.stop=function(){if(0!=this._state){var t=this.currStep>=this.steps.length;this.stepPos=0,this.currStep=0,this._state=0;var e=i.playings.indexOf(this);if(-1!=e&&i.playings.splice(e,1),this._promise){var r=this._promise;this._promise=null,t?r.resolve():r.reject()}}},i.prototype.pause=function(){0!=this._state&&(this._state=2)},Object.defineProperty(i.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),i.prototype.do=function(t){switch(t.action){case 1:for(var e in t.props)this._target[e]=t.props[e];break;case 2:for(var e in t.props)this._target[e]=t.props[e][1];break;case 4:t.props.func.call(t.props.ctx);break;case 5:this._target=t.target;break;case 6:t.props.func.call(t.props.ctx,this._target,1);break;case 7:this._target.dispose()}},i.prototype.advance=function(t){try{if(1!=this._state)return;if(this._target&&this._target.disposed)return void this.stop();if(this.currStep>=this.steps.length)return this.stop(),void(this.loop&&this.play());for(var e=this.stepPos+t,i=this.steps[this.currStep];!i.duration||e>=i.duration;){if(this.currStep++,this.do(i),this.stepPos=e,1!=this._state)return;if(this.currStep>=this.steps.length)return this.stop(),void(this.loop&&this.play());i.duration&&(e-=i.duration),i=this.steps[this.currStep]}if(this.stepPos=e,2==i.action){var r=i.ease(e/i.duration);for(var n in i.props){var a=i.props[n];this._target[n]=a[0]+(a[1]-a[0])*r}}else if(6==i.action){r=i.ease(e/i.duration);i.props.func.call(i.props.ctx,this._target,r)}}catch(t){Log.error("tween error: "+t.message),this.stop()}},i.playings=[],i.playTicker=null,i.defaultEase=e.linear,i}();t.Tween=i;var r=function(){function e(){this.tracks=[]}return e.prototype._onStop=function(){this.isLoop?t.callNextFrame((function(){this.play(!0)}),this):this._promise&&this._promise.resolve()},e.prototype.load=function(t,e){for(var r=0;r<e.length;r++){var n=e[r],a=t.find(n.target),o=new i(a,n.steps);n.loop&&r>0&&(o.loop=!0),this.tracks.push(o)}this.tracks[0].call(this._onStop,this)},Object.defineProperty(e.prototype,"state",{get:function(){return this.tracks[0].state},enumerable:!0,configurable:!0}),e.prototype.waitForEnd=function(){var t=this;return new Promise((function(e,i){t._promise={resolve:e,reject:i}}))},e.prototype.play=function(t){for(var e=0;e<this.tracks.length;e++)this.tracks[e].play();this.isLoop=!!t},e.prototype.stop=function(){for(var t=0,e=this.tracks.length;t<e;t++)this.tracks[t].stop();this.isLoop=!1,this._promise&&this._promise.reject()},e.prototype.dispose=function(){this.stop(),this.tracks=[]},e}();t.KeyframeAnimation=r}(ez||(ez={})),function(t){var e;e=t.internal||(t.internal={}),t.loadEZMDecoder=function(t,i){if(void 0===i&&(i=2),!t)return null;var r,n,a;e.ezmDecoder=i>1?function(){for(var e=[],r=0;r<i;r++)e[r]={id:r,worker:new Worker(t),tasks:[],load:0,queue:[]},e[r].worker.onmessage=function(t){if(this.queue){Log.debug("thread"+this.id+" ready");for(var e=0;e<this.queue.length;e++)this.worker.postMessage(this.queue[e]);this.queue=void 0}else{var i=t.data,r=this.tasks[i.id];i.subImg&&(r.subsets||(r.subsets=[]),r.subsets.push(i.subImg)),i.status<=0&&(r.subsets&&(i.subsets=r.subsets),this.load-=r.load,i.status?Log.error("decode ["+r.url+"] failed."):Log.debug("thread:"+this.id+" ["+r.url+"] decode time: "+i.time),r.onResult(i),i.data=null,i.subImg=null,i.subsets=null,this.tasks[i.id]=null)}}.bind(e[r]);return{load:function(t,i,r,n,a){for(var o,s=1e8,h=0;h<e.length;h++)e[h].load<s&&(s=e[h].load,o=e[h]);o.load+=r;var l=o.tasks,c=l.indexOf(null),u={id:c,url:t,onResult:a,load:r};c<0?(u.id=l.length,l.push(u)):l[c]=u,Log.debug("thread:"+o.id+" begin load image["+t+"]. format:"+i+" workload:"+o.load);var f={id:u.id,url:t,format:i};o.queue?o.queue.push(f):o.worker.postMessage(f)}}}():(r=new Worker(t),n=[],a=[],r.onmessage=function(t){if(a){Log.debug("ezmDecoder ready");for(var e=0;e<a.length;e++)r.postMessage(a[e]);a=void 0}else{var i=t.data,o=n[i.id];i.subImg&&(o.subsets||(o.subsets=[]),o.subsets.push(i.subImg)),i.status<=0&&(o.subsets&&(i.subsets=o.subsets),o.onResult(i),n[i.id]=null)}},{load:function(t,e,i,o,s){var h=n.indexOf(null),l={id:h,event:o,onResult:s};h<0?(l.id=n.length,n.push(l)):n[h]=l;var c={id:l.id,url:t,format:e,profile:!!o};a?a.push(c):r.postMessage(c)}})}}(ez||(ez={})),function(t){!function(e){e.highlight=function(e,i,r,n,a,o,s,h){var l;t.Effect.has("highlight")||(l=t.getGL(),t.Effect.register("highlight",new t.Effect("\nprecision mediump float;\nuniform sampler2D texture0;\nuniform float offset;\nuniform float width;\nuniform float acos;\nuniform float asin;\nuniform vec3 color;\nvarying vec2 v_tc;\nvarying vec2 v_pos;\nvarying vec4 v_color;\nvoid main(){\n\tvec4 col = texture2D(texture0, v_tc);\n\tfloat flow = 1.0 - (abs(v_pos.x * acos + v_pos.y * asin - offset) / width);\n\tflow = max(flow, 0.0);\n\tcol *= v_color;\n\tcol.rgb += color * flow * col.a;\n\tgl_FragColor = col;\n}",{offset:l.uniform1f,width:l.uniform1f,acos:l.uniform1f,asin:l.uniform1f,color:l.uniform3fv}))),s=s||0,h=h||[0,1];var c={offset:0,width:r,acos:Math.cos(n*t.Matrix.Deg2Rad),asin:Math.sin(n*t.Matrix.Deg2Rad),color:i.toVec3()};e.effectParams=c;var u,f=0,d=0;return u=t.addTicker((function(i){if(e.disposed)t.removeTicker(u);else if(d>0)d-=i;else{if(e.effect="highlight",(f+=i)>a){if(0==--s)return e.effect=null,void t.removeTicker(u);o>0&&(d=o,e.effect=null),f=0}c.offset=h[0]+(h[1]-h[0])*f/a,e.effectParams=c}}))}}(t.effect||(t.effect={}))}(ez||(ez={}));var __extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),game;!function(t){var e=ez.ui,i=["UIStage","Control","Group","RectFill","Image","game.Button","Label","game.Checkbox","game.StartPage","game.RankPage","ScrollView","ListView"],r=["R:JCF2OQOGMT7O","R:B0LVRU4VENJS","R:1EF948RMIQRD","R:4PGJIM7IPCOV","R:QJ204MMAGROF","R:LAO8Q29LE1TO","R:4LVSPIK3B203","R:S9IQLHG3U700","R:INH1T34JAHE4","R:G503ILGF8S28","R:O123T11GLFK9","R:CTDCID13AB9F","R:U7VJ9SGIHTNO","R:FOTVN4BTL6M7","R:P637DGG88RRB","R:307B8VJHSQ38","R:O18PU18DTSMO","R:UFGMTQLP3H5J","R:85GD560O0A62","R:RGDNTIFOJEJ1","R:PQF1C511M1BQ","R:5A1F5RDNRR3D","R:SPMG8J9324MB","R:6VBE1JLANTMV","R:52OMU7AEFJE8","R:MFP4S2F9MF7F","R:F45FD2M7NRMS","R:EN6PH70VD7LV","R:M3F90V7UJL03","R:EJRRQ2IU0JS0","R:LMIPDLENLMJG","R:VCP8LGVCL71S"];e.registerTextStyle([{id:"normal",font:"28px",color:"#bbadfb"},{id:"normalCenter",font:"28px",color:"#bbadfb",align:1},{id:"rankPage",font:"28px",color:"#757981"},{id:"gameHead",font:"28px",color:"#fff"}]);var n={GamePage:{name:"game.GamePage",init:function(t){},childs:[[i[0],,"game",0,0,,,710,1280,,,,,,,,,,,,,[{type:"Image",src:r[0]},{type:"Image",src:r[1],anchorX:.5,anchorY:.5,x:242,y:920.5},{type:"Image",src:r[2],angle:-33,x:738,y:535,anchorX:.5,anchorY:.5},{type:"Image",src:r[2],angle:32,x:562,y:95,anchorX:.5,anchorY:.5}]],[i[1],,"touch",,,,,"100%","100%"],[i[2],,"intro",,,,,"100%","100%",,,,,,,,,,,,,[[i[3],{color:"#000"},,,,,,"100%","100%",,,.3],[i[2],,,,,,,"100%",600,,"50%",,,,,,,,,,,[[i[4],{src:r[3]},,,,,,,,"50%"],[i[5],{label:""},"ok2Btn",,400,,,195,70,"50%"]]]]],[i[2],,"helpPage",,,,,"100%","100%",,,,!1,,,,,,,,,[[i[3],{color:"#000"},,,,,,"100%","100%",,,.3],[i[4],{src:r[4]},,,160,,,,,"50%"],[i[2],,,,900,,0,"100%",,,,,,,,,,,,,,[[i[5],{label:""},"okBtn",,"30%",,,195,70,"50%"]]]]],[i[2],,"clock",,,,,66,66,611,127,,!1,,,,,,,,,[[i[4],{src:r[5]}],[i[6],{font:"34px",color:"#fff",align:5,text:"0"},"time",,,,,"100%","100%"]]],[i[4],{src:r[6]},"disk",,,,,,,,,,!1],[i[2],{textStyle:"gameHead"},,,,,,"100%",70,,,,,,,,,,,,,[[i[3],{color:"#2c296e"},,,,,,"100%",70],[i[3],{color:"#6854aa"},,,70,,,"100%",2],[i[4],,"avatar",10,13,,,50,50],[i[6],{text:" 0"},"level",70,24,,,100,27],[i[6],{text:" 0"},"score",180,24,,,220,27],[i[6],{text:" 5"},"chance",400,24,,,120,27],[i[5],{label:""},"help",520,24,,,120,30,,,,,,,,,,,{bk:{src:""},label:{color:"#5186ff"}}],[i[7],,"sound",650,8,,,56,,,,,,,,,,,,{icon:{src:r[7]},checkImg:{src:r[8]}}]]]]}};e.registerTemplates(n);var a=function(t){function e(i,r){var n=t.call(this,i)||this;n._init(e),r?(n._createChilds(r.childs),r.init(n)):n._createChilds(e._childs);var a=n.namedChilds;return n._initStates("normal",e.States),n.bind("label",a.label,"text"),n.width=194,n.height=70,n}return __extends(e,t),Object.defineProperty(e.prototype,"namedChilds",{get:function(){return this._namedChilds},enumerable:!1,configurable:!0}),e.ClassName="game.Button",e.Styles={blue:{childsProperty:{bk:{src:r[9]}}},purple:{childsProperty:{bk:{src:r[10]}}},yellow:{childsProperty:{bk:{src:r[11]},label:{gradient:{y0:0,y1:30,colors:["#a54800","#ce7300"]}}}}},e.Properties=[{name:"label",type:"string"},{name:"style",type:"string",customProperty:!0}],e.States={normal:{},down:{}},e._childs=[[i[4],{src:r[9]},"bk",,,,,"100%","100%"],[i[6],{font:"30px",color:"#fff",align:1},"label",,,,,"100%",30,,"50%"]],e}(e.Control);t.Button=a,e.initUIClass(a,e.Control),e.addButtonEventHandler(a,.8);var o=function(t){function e(i,r){var n=t.call(this,i)||this;r?(n._createChilds(r.childs),r.init(n)):n._createChilds(e._childs);n.namedChilds;return n._initStates("uncheck",e.States),n}return __extends(e,t),Object.defineProperty(e.prototype,"namedChilds",{get:function(){return this._namedChilds},enumerable:!1,configurable:!0}),e.ClassName="game.Checkbox",e.States={check:{props:{childsProperty:{checkImg:{visible:!0}}}},uncheck:{props:{childsProperty:{checkImg:{visible:!1}}}}},e._childs=[[i[4],,"icon",,,,,"100%","100%"],[i[4],,"checkImg",,,,,"100%","100%"]],e}(e.Control);t.Checkbox=o,e.initUIClass(o,e.Control),e.addCheckboxEventHandler(o,.8);var s=function(t){function e(e,i){var r=t.call(this,e)||this;return i&&(r._createChilds(i.childs),i.init(r)),r}return __extends(e,t),e.ClassName="game.templates",e}(e.Container);t.templates=s,e.initUIClass(s,e.Container);var h=function(t){function e(i,r){var a=t.call(this,i)||this;(r=r||n.GamePage)?(a._createChilds(r.childs),r.init(a)):a._createChilds(e._childs);a.namedChilds;return a.width="100%",a.height="100%",a}return __extends(e,t),Object.defineProperty(e.prototype,"namedChilds",{get:function(){return this._namedChilds},enumerable:!1,configurable:!0}),e.ClassName="game.GamePage",e._childs=[[i[0],,"game",0,0,,,710,1280,,,,,,,,,,,,,[{type:"Image",src:r[0]},{type:"Image",src:r[1],anchorX:.5,anchorY:.5,x:242,y:920.5},{type:"Image",src:r[2],angle:-33,x:738,y:535,anchorX:.5,anchorY:.5},{type:"Image",src:r[2],angle:32,x:562,y:95,anchorX:.5,anchorY:.5}]],[i[1],,"touch",,,,,"100%","100%"],[i[2],,"intro",,,,,"100%","100%",,,,,,,,,,,,,[[i[3],{color:"#000"},,,,,,"100%","100%",,,.3],[i[2],,,,,,,"100%",600,,"50%",,,,,,,,,,,[[i[4],{src:r[3]},,,,,,,,"50%"],[i[5],{label:""},"ok2Btn",,400,,,195,70,"50%"]]]]],[i[2],,"helpPage",,,,,"100%","100%",,,,!1,,,,,,,,,[[i[3],{color:"#000"},,,,,,"100%","100%",,,.3],[i[4],{src:r[4]},,,160,,,,,"50%"],[i[2],,,,900,,0,"100%",,,,,,,,,,,,,,[[i[5],{label:""},"okBtn",,"30%",,,195,70,"50%"]]]]],[i[2],,"clock",,,,,66,66,611,127,,!1,,,,,,,,,[[i[4],{src:r[5]}],[i[6],{font:"34px",color:"#fff",align:5,text:"0"},"time",,,,,"100%","100%"]]],[i[4],{src:r[6]},"disk",,,,,,,,,,!1],[i[2],{textStyle:"gameHead"},,,,,,"100%",70,,,,,,,,,,,,,[[i[3],{color:"#2c296e"},,,,,,"100%",70],[i[3],{color:"#6854aa"},,,70,,,"100%",2],[i[4],,"avatar",10,13,,,50,50],[i[6],{text:" 0"},"level",70,24,,,100,27],[i[6],{text:" 0"},"score",180,24,,,220,27],[i[6],{text:" 5"},"chance",400,24,,,120,27],[i[5],{label:""},"help",520,24,,,120,30,,,,,,,,,,,{bk:{src:""},label:{color:"#5186ff"}}],[i[7],,"sound",650,8,,,56,,,,,,,,,,,,{icon:{src:r[7]},checkImg:{src:r[8]}}]]]],e}(e.Container);t._GamePage=h,ez.initCall((function(){e.initUIClass(t.GamePage,e.Container)}));var l=function(t){function e(i,r){var n=t.call(this,i)||this;r?(n._createChilds(r.childs),r.init(n)):n._createChilds(e._childs);n.namedChilds;return n.width="100%",n.height="100%",n}return __extends(e,t),Object.defineProperty(e.prototype,"namedChilds",{get:function(){return this._namedChilds},enumerable:!1,configurable:!0}),e.ClassName="game.MainFrame",e._childs=[[i[3],{gradient:{y1:1280,colors:["#010036","#4e004f"]}},"bg",,,,,"100%","100%"],[i[2],,"frame",,,,,"100%","100%",,,,,,,,,,,,,[[i[8]]]]],e}(e.Container);t.MainFrame=l,e.initUIClass(l,e.Container);var c=function(t){function e(i,r){var n=t.call(this,i)||this;r?(n._createChilds(r.childs),r.init(n)):n._createChilds(e._childs);n.namedChilds;return n.width="100%",n.height="100%",n.textStyle="normalCenter",n}return __extends(e,t),Object.defineProperty(e.prototype,"namedChilds",{get:function(){return this._namedChilds},enumerable:!1,configurable:!0}),e.ClassName="game.ResultPage",e._childs=[[i[4],{src:r[12]},"picSucc",198,77,,,336,322,,,,!0],[i[4],{src:r[13]},"picFail",198,77,,,296,200,,,,!1],[i[6],{text:"",align:1,font:"50px"},"picFailTxt",,320,,,240,29,"50%",,,!1],[i[6],{text:"",align:1},,,462,,,119,29,"50%"],[i[6],{text:"1000",strokeWidth:4,strokeColor:"#9b8ddd",font:"50px",gradient:{y1:50,colors:["#a995ff","#8670f4"]}},"score",,395,,,280,58,"50%"],[i[6],,"info",,530,,,283,32,"50%"],[i[4],{src:r[14]},,177,503,,,360,2],[i[4],{src:r[14]},,177,579,,,360,2],[i[5],{label:"",style:"blue"},"rank",,669,,,195,70,"50%"],[i[5],{label:"",style:"blue"},"result",,769,,,195,70,"50%"],[i[2],,,,900,,0,"100%",,,,,,,,,,,,,,[[i[5],{label:"",style:"purple"},"replay",,,,,195,70,"50%","50%"]]],[i[9],,"rankPage",,,,,,,,,,!1]],e}(e.Container);t.ResultPage=c,e.initUIClass(c,e.Container);var u=function(t){function e(i,r){var n=t.call(this,i)||this;r?(n._createChilds(r.childs),r.init(n)):n._createChilds(e._childs);n.namedChilds;return n.width="100%",n.height="100%",n.textStyle="normal",n.ownerBuffer=!0,n}return __extends(e,t),Object.defineProperty(e.prototype,"namedChilds",{get:function(){return this._namedChilds},enumerable:!1,configurable:!0}),e.ClassName="game.SharePage",e._childs=[[i[3],{gradient:{y1:1280,colors:["#010036","#4e004f"]}},"bg",,,,,"100%","100%"],[i[4],{src:r[15]},,64,92,,,323,46],[i[4],{src:r[16]},,81,300,,,522,231],[i[6],{text:""},"name",114,337,,,383,37],[i[6],{text:"10000"},"score",114,387,,,383,37],[i[6],,"info",114,439,,,383,37],[i[5],,"closeShare",650,40,,,39,38,,,,,,,,,,,{bk:{src:r[17]}}],[i[4],{src:r[18]},,65,165],[i[6],{font:"28px",color:"#bbadfb",lineHeight:48,format:2,text:"2020 \n47 10 \n"},,68,575,,,585,137],[i[2],,,,700,,0,300,,"50%",,,,,,,,,,,,[[i[2],,,,,,,300,332,,"50%",,,,,,,,,,,[[i[4],{src:r[19]},"share",,,,,300,332]]]]]],e}(e.Container);t.SharePage=u,e.initUIClass(u,e.Container);var f=function(t){function e(i,r){var n=t.call(this,i)||this;return r?(n._createChilds(r.childs),r.init(n)):n._createChilds(e._childs),n.width="100%",n.height="100%",n}return __extends(e,t),e.ClassName="game.Splash",e._childs=[[i[4],{src:r[20]},,,,,,,,"50%","50%"]],e}(e.Container);t.Splash=f,e.initUIClass(f,e.Container);var d=function(t){function e(i,r){var n=t.call(this,i)||this;r?(n._createChilds(r.childs),r.init(n)):n._createChilds(e._childs);n.namedChilds;return n.width=530,n.height=88,n}return __extends(e,t),Object.defineProperty(e.prototype,"namedChilds",{get:function(){return this._namedChilds},enumerable:!1,configurable:!0}),e.ClassName="game.RankItem",e._childs=[[i[6],{color:"#42464d",align:1,format:8},"name",217,24,,,180,25],[i[6],{color:"#42464d",align:1},"rank",20,23,,,50,17,,,,!1],[i[6],{color:"#e04f00",align:1},"score",409,24,,,112,25],[i[4],{effect:"mask",effectParams:{mask:"mask"}},"avatar",127,7,,,74,74],[i[3],{color:"#F0F0F0"},,0,86,,,530,2],[i[4],{src:r[21]},"rankIcon",27,15,,,44,48]],e}(e.Container);t._RankItem=d,ez.initCall((function(){e.initUIClass(t.RankItem,e.Container)}));var p=function(t){function e(i,r){var n=t.call(this,i)||this;r?(n._createChilds(r.childs),r.init(n)):n._createChilds(e._childs);n.namedChilds;return n.width=640,n.height=1300,n.left=33,n.top=0,n.textStyle="rankPage",n}return __extends(e,t),Object.defineProperty(e.prototype,"namedChilds",{get:function(){return this._namedChilds},enumerable:!1,configurable:!0}),e.ClassName="game.RankPage",e._childs=[[i[4],{src:r[22]},,0,0,,,640,1300],[i[4],{src:r[23]},,45,219,,,540,806],[i[5],,"closeRank",566,200,,,39,38,,,,,,,,,,,{bk:{src:r[17]}}],[i[3],{color:"#F2F2F4"},,45,319,,,540,78],[i[6],{text:""},,74,344,,,58,28],[i[6],{text:""},,190,344,,,58,28],[i[6],{text:""},,334,344,,,58,28],[i[6],{text:""},,478,344,,,58,28],[i[6],{font:"32px",text:"TOP50",color:"#494b59"},,246,253,,,220,34],[i[4],{src:r[24]},,187,246,,,44,49],[i[10],{scrollMode:2},,50,402,,,532,617,,,,,,,,,,,,,[[i[11],{itemClass:"game.RankItem",culling:!0},"rankList",,,,,532]]]],e}(e.Container);t.RankPage=p,e.initUIClass(p,e.Container);var g=function(t){function e(i,r){var n=t.call(this,i)||this;r?(n._createChilds(r.childs),r.init(n)):n._createChilds(e._childs);n.namedChilds;return n.width="100%",n.height="100%",n}return __extends(e,t),Object.defineProperty(e.prototype,"namedChilds",{get:function(){return this._namedChilds},enumerable:!1,configurable:!0}),e.ClassName="game.StartPage",e._childs=[[i[4],{src:r[0]}],[i[2],,"mainPage",,,,,"100%","100%",,,,,,,,,,,,,[[i[0],,"stage",,,,,"100%",1280,,"50%",,,,,,,,,,,[{type:"Image",id:"",src:r[25],x:515,y:812,anchorX:.5,anchorY:.5},{type:"Image",id:"",src:r[26],x:38,y:112},{type:"Image",src:r[27],x:132,y:538},{type:"Image",src:r[28],x:103,y:402}]],[i[4],{src:r[29]},,,,,"10%",237,34,"50%"],[i[5],,"help",80,,,"15%",218,85,,,,,,,,,,,{bk:{src:r[30]}}],[i[5],,"start",,,80,"15%",218,85,,,,,,,,,,,{bk:{src:r[31]}}],[i[5],{style:"yellow",label:""},"rank",44,92,,,146,54]]],[i[7],,"sound",570,92,,,56,59,,,,,,,,,,,{icon:{src:r[7]},checkImg:{src:r[8]}}],[i[2],,"helpPage",,,,,"100%","100%",,,,!1,,,,,,,,,[[i[4],{src:r[4]},,,160,,,,,"50%"],[i[2],,,,900,,0,"100%",,,,,,,,,,,,,,[[i[5],{label:""},"okBtn",,"30%",,,195,70,"50%"]]]]],[i[9],,"rankPage",,,,,,,,,,!1]],e}(e.Container);t._StartPage=g,ez.initCall((function(){e.initUIClass(t.StartPage,e.Container)}))}(game||(game={}));var __awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))((function(n,a){function o(t){try{h(r.next(t))}catch(t){a(t)}}function s(t){try{h(r.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,s)}h((r=r.apply(t,e||[])).next())}))},__generator=this&&this.__generator||function(t,e){var i,r,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&a[0]?r.return:a[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,a[1])).done)return n;switch(r=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},url_online="https://xwfintech.qingke.io/_api/5f172e0de25bdc002d9a5abf",url_debug="http://127.0.0.1:7000",url=url_debug;function ajax(t,e){var i=new XMLHttpRequest;i.open("GET",t),i.onload=function(){i.status>=400||!i.status&&!i.responseText?(alert("failed: "+i.status+" "+i.responseText),e(!1)):e(!0,JSON.parse(i.responseText))};try{i.send()}catch(t){e(!1)}}var PlayerInfo={},EnemyType;function isWechat(){var t=navigator.userAgent.toLowerCase();return/micromessenger/i.test(t)||/windows phone/i.test(t)}function createPlayerInfo(){PlayerInfo.openid="A"+parseInt(Math.random().toString()),PlayerInfo.nickname="Tom",PlayerInfo.sex="whoMan",PlayerInfo.headimgurl="image/111222"}function isSuccessful(){return score>=target}function commitScore(t){return new Promise((function(e,i){var r=Date.now(),n=md5.hex("zxdqwopenid"+PlayerInfo.openid+"score"+t+r);ajax(url+"/openapi/pinball/add/measy?key=zxdqw&sign="+n+"&openid="+PlayerInfo.openid+"&score="+t+"&timestamp="+r,(function(t,r){r.code?(alert(r.msg),i()):e(r.data)}))}))}function length1(t,e,i){var r=t.x-e,n=t.y-i;return Math.sqrt(r*r+n*n)}function intersect(t,e,i,r){var n,a,o,s,h,l,c=(t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)<=r*r,u=(e.x-i.x)*(e.x-i.x)+(e.y-i.y)*(e.y-i.y)<=r*r;return(!c||!u)&&(!(!c&&!u)||(n=t.y-e.y,a=e.x-t.x,o=t.x*e.y-e.x*t.y,s=n*i.x+a*i.y+o,!((s*=s)>(n*n+a*a)*r*r)&&(h=(i.x-t.x)*(e.x-t.x)+(i.y-t.y)*(e.y-t.y),l=(i.x-e.x)*(t.x-e.x)+(i.y-e.y)*(t.y-e.y),h>0&&l>0)))}function reflect(t,e,i,r,n){var a=e.y-t.y,o=t.x-e.x,s=e.x*t.y-t.x*e.y,h=1/(a*a+o*o),l=(o*o*i.x-a*o*i.y-a*s)*h,c=(a*a*i.y-a*o*i.x-o*s)*h,u=i.x-l,f=i.y-c,d=1/Math.sqrt(u*u+f*f),p=r*(u*=d)+n*(f*=d);return[r-2*u*p,n-2*f*p]}function addScore(t,e){return __awaiter(this,void 0,void 0,(function(){var i,r,n,a;return __generator(this,(function(o){switch(o.label){case 0:i=score,score+=t,r=t/10|0,n=0,o.label=1;case 1:return n<10?(a=(i+=r)+" / "+target,e.score.text=" "+a,[4,ez.delay(30)]):[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return a=score+" / "+target,e.score.text=" "+a,[2]}}))}))}function shulffle(t){var e,i=Date.now();for(var r=0;r<t.length;r++){var n=(e=t.length-1,((i=22695477*i+1&134217727)>>16)%(e+1)),a=t[r];t[r]=t[n],t[n]=a}}function createXY(){return[Math.floor(675*Math.random())+25,Math.floor(1255*Math.random())+25]}function createEnemyData(){for(var t=[],e=0;e<enemyData.length;e++)for(var i=enemyData[e].num*enemyNum,r=0;r<i;r++){var n=createXY(),a={type:enemyData[e].type,x:n[0],y:n[1]};t.push(a)}return t}function createPlayer(t){var e=new ez.SubStageSprite(t),i=new ez.ImageSprite(e),r=new ez.ImageSprite(e);return i.src="game/playerlight",r.src="game/player",i.anchorX=.5,r.anchorX=.5,i.anchorY=.66,i.scale=.9,r.anchorY=.7,e.scale=.7,new ez.Tween(i).move({opacity:[.5,1]},1e3).to({opacity:.5},1e3).config({loop:!0}).play(),e}function createHole(t,e){var i=new ez.ImageSprite(e);i.anchorX=.5,i.anchorY=.5,i.x=t.x,i.y=t.y;var r={};i.data=r,r.type=t.type,i.src="game/hole",r.radius=60}function createEnemy(t,e){var i=new ez.ImageSprite(e);i.anchorX=.5,i.anchorY=.5,i.x=t.x,i.y=t.y;var r={};switch(i.data=r,r.type=t.type,t.type){case EnemyType.Hole:i.src="game/hole",r.radius=60;break;case EnemyType.Mask:i.src="game/mask",r.score=30,r.radius=20,ez.setTimer(1e3*Math.random(),(function(){return ez.Tween.add(i).move({scale:[.9,1.1]},1e3).to({scale:.9},1e3).config({loop:!0}).play()}));break;case EnemyType.Boom:i.src="game/boom",r.score=-10,r.radius=20;break;case EnemyType.Logo:i.src="game/logo",r.score=20,r.radius=13;break;case EnemyType.Batman:i.src="game/batman",i.scale=.7,r.score=10,r.radius=13,ez.setTimer(1e3*Math.random(),(function(){return ez.Tween.add(i).move({scale:[1,1.2]},2e3).to({scale:1},2e3).config({loop:!0}).play()}));break;case EnemyType.BatmanKing:i.src="game/batman",i.scale=1.8,r.score=100,r.radius=36,ez.Tween.add(i).move({scale:[1.8,2.1]},2e3).to({scale:1.8},1e3).config({loop:!0}).play();break;case EnemyType.clone:i.src="game/clone",i.scale=1,r.score=0,r.radius=13;var n=getRandomNumInt(-20,20),a=getRandomNumInt(-20,20);ez.Tween.add(i).move({y:[i.y,i.y+a],x:[i.x,i.x+n],angle:[-180,180],scale:[.95,1.05]},1200,ez.Ease.sineInOut).to({y:i.y,x:i.x,angle:-180,scale:.95},1200,ez.Ease.sineInOut).config({loop:!0}).play()}return i}function createHoleData(){var t=createXY(),e=t[0],i=t[1],r=new Array(1),n={type:EnemyType.Batman,x:e,y:i};return r[0]=n,r}function getRandomNumInt(t,e){var i=e-t,r=Math.random();return t+Math.round(r*i)}!function(t){t[t.Batman=0]="Batman",t[t.Boom=1]="Boom",t[t.Mask=2]="Mask",t[t.BatmanKing=3]="BatmanKing",t[t.clone=4]="clone",t[t.Logo=5]="Logo",t[t.Hole=6]="Hole"}(EnemyType||(EnemyType={}));var __extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))((function(n,a){function o(t){try{h(r.next(t))}catch(t){a(t)}}function s(t){try{h(r.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,s)}h((r=r.apply(t,e||[])).next())}))},__generator=this&&this.__generator||function(t,e){var i,r,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&a[0]?r.return:a[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,a[1])).done)return n;switch(r=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},game;!function(t){var e,i=180/Math.PI,r=null;var n=function(n){function a(a){var o=n.call(this,a)||this,s=lines[lines.length-1];s[0].y=s[1].y=a.getBound().height-0;var h=o.namedChilds;score=0,initEverTime(),h.level.text=" "+level;var l=score+" / "+target;h.score.text=" "+l,isWechat()&&(h.avatar.src=PlayerInfo.headimgurl);var c=localStorage.getItem("sound");null==c&&(c="1"),h.sound.state="1"==c?"check":"uncheck";var u=h.game.stage;h.touch.hitTest=function(){return!0};var f=new ez.ImageSprite(u);f.src="game/arrow",f.anchorY=.5,f.visible=!1,f.zIndex=1;var d,p=f.width,g=o;return PlayerInfo&&(h.avatar.src=PlayerInfo.headimgurl),h.chance.text=" "+chanceMax.toString(),h.touch.onTouchBegin=function(t){if(r){var e=t.screenX,i=t.screenY;d=[e,i],h.disk.x=e,h.disk.y=i,h.disk.visible=!0,t.capture()}},h.touch.onTouchMove=function(t){if(d){var r=t.screenX-d[0],n=t.screenY-d[1],a=Math.sqrt(r*r+n*n),o=Math.max(12,Math.min(60,a));f.width=p*o/60,f.visible=!0,f.x=e.x,f.y=e.y,f.angle=n>=0?Math.acos(r/a)*i+180:180-Math.acos(r/a)*i}},h.touch.onTouchEnd=function(t){if(d){var e=t.screenX-d[0],i=t.screenY-d[1],n=Math.sqrt(e*e+i*i)+.01,a=Math.max(10,Math.min(60,n));f.visible=!1;f.angle;d=null,h.disk.visible=!1,r&&r([-e*a/n,-i*a/n])}},function(t,i,n){__awaiter(this,void 0,void 0,(function(){function a(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:if(!o)return s=maxTime,[2];o=!1,i.clock.visible=!0,s=maxTime,i.time.text=""+s,t.label=1;case 1:return s>0?(i.time.text=""+s,[4,ez.delay(100)]):[3,3];case 2:return t.sent(),s-=1,[3,1];case 3:return o=!0,i.clock.visible=!1,l=!1,[2]}}))}))}var o,s,h,l,c,u,f,d,p,g,m,_,v,y,b,x,w,T,C,S,A,P,k,M,I,E,B,R,O,D,L,z,F;return __generator(this,(function(H){switch(H.label){case 0:for(o=!0,s=maxTime,h=[],ajax(url+"/openapi/statistics/add?openid="+PlayerInfo.openid+"&fps="+ez.fps,(function(){})),l=!1,c=createEnemyData(),F=0;F<c.length;F++)h[F]=createEnemy(c[F],t);createHole((u=createHoleData())[0],t),f=[u[0].x,u[0].y],(e=createPlayer(t)).x=104,e.y=144,e.scale=1.2,(d=new ez.ImageSprite(t)).src="game/circle",d.anchorX=d.anchorY=.5,d.x=104,d.y=144,new ez.Tween(d).move({scale:[.4,1.2],opacity:[.1,.6]},800).config({loop:!0}).play(),p=[104,144],g=chanceMax,H.label=1;case 1:return g--<=0?[3,16]:(e.scale=1.2,m=new Promise((function(t){r=t})),p=[e.x,e.y],[4,m]);case 2:_=H.sent(),d&&(d.dispose(),d=null),i.chance.text=" "+g,r=null,v=_[0]*rate,y=_[1]*rate,H.label=3;case 3:if(e.scale=.7,e.x+=v,e.y+=y,Math.abs(v)<1&&Math.abs(y)<1)return[3,15];for(F=0;F<h.length;F++)if(b=h[F],x=b.data,w=b.x-e.x,T=b.y-e.y,w*w+T*T<(30+x.radius)*(30+x.radius)){if(v=v>=10?v:1.05*v,y=y>=10?y:1.05*y,C=x.score,(S=new ez.LabelSprite(t)).align=ez.AlignMode.Center,S.anchorX=.5,S.anchorY=1,S.width=200,S.height=30,S.x=b.x,S.font="Arial 30px",x.type==EnemyType.clone)for(A=0;A<2*level;A++)P=createXY(),k={type:0+Math.round(4*Math.random()),x:P[0],y:P[1]},h.push(createEnemy(k,t));if(x.type!=EnemyType.BatmanKing||l||(C=30),C>0?(S.text="+"+C,S.gradient={y1:30,colors:["#ff8","#fa8"]}):(S.text=""+C,S.gradient={y1:30,colors:["#8ff","#8af"]}),x.type!=EnemyType.Logo||l||(g+=1,i.chance.text=" "+g),ez.Tween.add(S).move({y:[b.y,b.y-30],opacity:[.5,1]},300,ez.Ease.bounceOut).move({opacity:[1,0]},2e3).disposeTarget().play(),addScore(C,i),ez.playSFX(C>0?"sound/add":"sound/lose"),b.dispose(),h.splice(F,1),x.type==EnemyType.Mask){for(l=!0,shulffle(M=h.concat()),I=0;I<2;I++)(E=M.findIndex((function(t){return t.data.type==EnemyType.Batman})))>=0&&(ez.Tween.add(M[E]).move({opacity:[1,0]},800).disposeTarget().play(),h.splice(h.indexOf(M[E]),1),M.splice(E,1));a()}break}for(F=0;F<lines.length;F++)if(intersect((B=lines[F])[0],B[1],e,30)){e.x-=v,e.y-=y,R=reflect(B[0],B[1],e,v,y),v=R[0]*alpha,y=R[1]*alpha;break}if((e.x<0||e.y<0||e.x>710||e.y>1400)&&(O=createXY(),e.x=O[0],e.y=O[1]),D=f[0]-e.x,L=f[1]-e.y,!((z=D*D+L*L)<500))return[3,12];v=0,y=0,F=0,H.label=4;case 4:return F<30?(e.opacity=1-F/30,[4,ez.nextFrame()]):[3,7];case 5:H.sent(),H.label=6;case 6:return F++,[3,4];case 7:g=Math.max(0,g-1),e.x=p[0],e.y=p[1],F=0,H.label=8;case 8:return F<=30?(e.opacity=F/30,[4,ez.nextFrame()]):[3,11];case 9:H.sent(),H.label=10;case 10:return F++,[3,8];case 11:return[3,13];case 12:z<5e4&&(z=1/z,D*=Math.sqrt(z),L*=Math.sqrt(z),v+=1e3*D*z,y+=1e3*L*z),H.label=13;case 13:return v>.15?v-=.1:v<.15&&(v+=.1),y>.15?y-=.1:y<.15&&(y+=.1),[4,ez.nextFrame()];case 14:return H.sent(),[3,3];case 15:return[3,1];case 16:return n(),[2]}}))}))}(u,h,(function(){!function(e){__awaiter(this,void 0,void 0,(function(){var i,r,n;return __generator(this,(function(a){switch(a.label){case 0:return i=e.parent.createChild(t.ResultPage),r=i.namedChilds,isSuccessful()?r.replay.label="":(r.picFailTxt.visible=!0,r.picSucc.visible=!1,r.picFail.visible=!0),r.score.text=""+score,[4,commitScore(score)];case 1:return n=a.sent(),t.getRank(r.rankPage),n&&(r.info.text=""+n+""),i.addEventHandler("click",(function(e){switch(e.sender.id){case"rank":r.rankPage.visible=!0;break;case"closeRank":r.rankPage.visible=!1;break;case"replay":isSuccessful()&&level<=maxLevel?(score=0,(level+=1)>7&&(level=1),initEverTime(),i.parent.createChild(t.GamePage),i.dispose()):(score=0,level=1,initEverTime(),i.parent.createChild(t.MainFrame),i.dispose());break;case"result":ajax(url+"/openapi/statistics/add?openid="+PlayerInfo.openid+"&playTime="+(Date.now()-startTime),(function(){}));var a=i.parent.createChild(t.SharePage);i.visible=!1;var o=a.namedChilds;n&&(o.info.text=""+n+""),o.name.text=""+PlayerInfo.nickname,o.score.text=""+score,ez.setTimer(100,(function(){navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);var t=document.getElementById("game").getElementsByTagName("canvas")[0].toDataURL("image/png");window.parent.postMessage({msg:"show",src:t},"*")})),a.addEventHandler("click",(function(t){switch(t.sender.id){case"closeShare":a.dispose(),i.visible=!0}}))}})),e.dispose(),[2]}}))}))}(g)})),o.addEventHandler("click",(function(e){switch(e.sender.id){case"help":h.helpPage.visible=!0;break;case"okBtn":h.helpPage.visible=!1;break;case"ok2Btn":h.intro.visible=!1;break;case"sound":var i=e.sender.state;t.soundEnable("check"==i)}})),o}return __extends(a,n),a}(t._GamePage);t.GamePage=n}(game||(game={}));var levelMax=10,chanceMax=5,score=0,level=1,maxLevel=7,rate=.5,alpha=.9,maxTime=20,lines=[[0,70,490,70],[490,70,710,205],[490,70,710,205],[710,205,710,524],[710,524,446,695],[446,695,466,723],[466,723,710,564],[710,564,710,1280],[0,70,0,1280],[120,902,361,902],[361,902,361,934],[361,934,120,939],[120,902,120,939],[710,1280,0,1280]].map((function(t){return[{x:t[0],y:t[1]},{x:t[2],y:t[3]}]})),enemyData=[{type:EnemyType.Batman,num:.78},{type:EnemyType.BatmanKing,num:.05},{type:EnemyType.Boom,num:.06},{type:EnemyType.Mask,num:.04},{type:EnemyType.Logo,num:.05},{type:EnemyType.clone,num:.02}],enemyNum=50+30*(level-1),target=9*enemyNum;function initEverTime(){enemyNum=50+30*(level-1),target=getTarget(level);var t=level<=6?level:6;rate+=.01*t,alpha-=.01*(t-1)}function getTarget(t){return[420,800,1200,2e3,3890,6010,9999][t-1]}var __awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))((function(n,a){function o(t){try{h(r.next(t))}catch(t){a(t)}}function s(t){try{h(r.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,s)}h((r=r.apply(t,e||[])).next())}))},__generator=this&&this.__generator||function(t,e){var i,r,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&a[0]?r.return:a[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,a[1])).done)return n;switch(r=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},mainFrame,md5,game;function main(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return window.parent.postMessage({msg:"login"},"*"),ez.initialize({width:710,height:1280,minHeight:1100,maxHeight:1400,highDPI:!0,wglOptions:{preserveDrawingBuffer:!0},scaleMode:3}),ez.loadEZMDecoder("undefined"==typeof WebAssembly?"ezm.asm.js":"ezm.wasm.js",1),isWechat()||createPlayerInfo(),console.log(""),ez.loadResPackage(game.resData,"res/",game.resGroups),ez.loadGroup(["ui","start","image/bg"],(function(t,e){if(t>=e){var i=Date.now()-startTime;ajax((url=url_online)+"/openapi/statistics/add?openid="+PlayerInfo.openid+"&loadTime="+i,(function(){})),mainFrame=ez.getRoot().createChild(game.MainFrame);var r=document.getElementById("loading");r&&document.body.removeChild(r),ez.loadGroup(["game","image/","image/","share"])}else console.log("progress<tatal")})),[3,3];case 1:return console.log(""),[4,ez.loadJSONPackageAsync("assets/resource.json","assets/res/")];case 2:t.sent(),ez.loadGroup(["ui","start","image/bg"],(function(t,e){if(t>=e){var i=Date.now()-startTime;ajax(url+"/openapi/statistics/add?openid="+PlayerInfo.openid+"&loadTime="+i,(function(){})),mainFrame=ez.getRoot().createChild(game.MainFrame);var r=document.getElementById("loading");r&&document.body.removeChild(r),ez.loadGroup(["game","image/","image/","share"])}})),t.label=3;case 3:return[2]}}))}))}window.onmessage=function(t){var e=t.data;"login"==e.msg&&e.info&&(PlayerInfo=JSON.parse(e.info)),"back"==e.msg&&(mainFrame.clearChilds(),mainFrame.createChild(game.GamePage))},function(t){var e=1,i="";function r(t){return h(l(s(t),8*t.length))}function n(t){for(var i,r=e?"0123456789ABCDEF":"0123456789abcdef",n="",a=0;a<t.length;a++)i=t.charCodeAt(a),n+=r.charAt(i>>>4&15)+r.charAt(15&i);return n}function a(t){for(var e="",r=t.length,n=0;n<r;n+=3)for(var a=t.charCodeAt(n)<<16|(n+1<r?t.charCodeAt(n+1)<<8:0)|(n+2<r?t.charCodeAt(n+2):0),o=0;o<4;o++)8*n+6*o>8*t.length?e+=i:e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>6*(3-o)&63);return e}function o(t){for(var e,i,r="",n=-1;++n<t.length;)e=t.charCodeAt(n),i=n+1<t.length?t.charCodeAt(n+1):0,55296<=e&&e<=56319&&56320<=i&&i<=57343&&(e=65536+((1023&e)<<10)+(1023&i),n++),e<=127?r+=String.fromCharCode(e):e<=2047?r+=String.fromCharCode(192|e>>>6&31,128|63&e):e<=65535?r+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|63&e):e<=2097151&&(r+=String.fromCharCode(240|e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|63&e));return r}function s(t){for(var e=Array(t.length>>2),i=0;i<e.length;i++)e[i]=0;for(i=0;i<8*t.length;i+=8)e[i>>5]|=(255&t.charCodeAt(i/8))<<i%32;return e}function h(t){for(var e="",i=0;i<32*t.length;i+=8)e+=String.fromCharCode(t[i>>5]>>>i%32&255);return e}function l(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;for(var i=1732584193,r=-271733879,n=-1732584194,a=271733878,o=0;o<t.length;o+=16){var s=i,h=r,l=n,c=a;i=u(i,r,n,a,t[o+0],7,-680876936),a=u(a,i,r,n,t[o+1],12,-389564586),n=u(n,a,i,r,t[o+2],17,606105819),r=u(r,n,a,i,t[o+3],22,-1044525330),i=u(i,r,n,a,t[o+4],7,-176418897),a=u(a,i,r,n,t[o+5],12,1200080426),n=u(n,a,i,r,t[o+6],17,-1473231341),r=u(r,n,a,i,t[o+7],22,-45705983),i=u(i,r,n,a,t[o+8],7,1770035416),a=u(a,i,r,n,t[o+9],12,-1958414417),n=u(n,a,i,r,t[o+10],17,-42063),r=u(r,n,a,i,t[o+11],22,-1990404162),i=u(i,r,n,a,t[o+12],7,1804603682),a=u(a,i,r,n,t[o+13],12,-40341101),n=u(n,a,i,r,t[o+14],17,-1502002290),i=f(i,r=u(r,n,a,i,t[o+15],22,1236535329),n,a,t[o+1],5,-165796510),a=f(a,i,r,n,t[o+6],9,-1069501632),n=f(n,a,i,r,t[o+11],14,643717713),r=f(r,n,a,i,t[o+0],20,-373897302),i=f(i,r,n,a,t[o+5],5,-701558691),a=f(a,i,r,n,t[o+10],9,38016083),n=f(n,a,i,r,t[o+15],14,-660478335),r=f(r,n,a,i,t[o+4],20,-405537848),i=f(i,r,n,a,t[o+9],5,568446438),a=f(a,i,r,n,t[o+14],9,-1019803690),n=f(n,a,i,r,t[o+3],14,-187363961),r=f(r,n,a,i,t[o+8],20,1163531501),i=f(i,r,n,a,t[o+13],5,-1444681467),a=f(a,i,r,n,t[o+2],9,-51403784),n=f(n,a,i,r,t[o+7],14,1735328473),i=d(i,r=f(r,n,a,i,t[o+12],20,-1926607734),n,a,t[o+5],4,-378558),a=d(a,i,r,n,t[o+8],11,-2022574463),n=d(n,a,i,r,t[o+11],16,1839030562),r=d(r,n,a,i,t[o+14],23,-35309556),i=d(i,r,n,a,t[o+1],4,-1530992060),a=d(a,i,r,n,t[o+4],11,1272893353),n=d(n,a,i,r,t[o+7],16,-155497632),r=d(r,n,a,i,t[o+10],23,-1094730640),i=d(i,r,n,a,t[o+13],4,681279174),a=d(a,i,r,n,t[o+0],11,-358537222),n=d(n,a,i,r,t[o+3],16,-722521979),r=d(r,n,a,i,t[o+6],23,76029189),i=d(i,r,n,a,t[o+9],4,-640364487),a=d(a,i,r,n,t[o+12],11,-421815835),n=d(n,a,i,r,t[o+15],16,530742520),i=p(i,r=d(r,n,a,i,t[o+2],23,-995338651),n,a,t[o+0],6,-198630844),a=p(a,i,r,n,t[o+7],10,1126891415),n=p(n,a,i,r,t[o+14],15,-1416354905),r=p(r,n,a,i,t[o+5],21,-57434055),i=p(i,r,n,a,t[o+12],6,1700485571),a=p(a,i,r,n,t[o+3],10,-1894986606),n=p(n,a,i,r,t[o+10],15,-1051523),r=p(r,n,a,i,t[o+1],21,-2054922799),i=p(i,r,n,a,t[o+8],6,1873313359),a=p(a,i,r,n,t[o+15],10,-30611744),n=p(n,a,i,r,t[o+6],15,-1560198380),r=p(r,n,a,i,t[o+13],21,1309151649),i=p(i,r,n,a,t[o+4],6,-145523070),a=p(a,i,r,n,t[o+11],10,-1120210379),n=p(n,a,i,r,t[o+2],15,718787259),r=p(r,n,a,i,t[o+9],21,-343485551),i=g(i,s),r=g(r,h),n=g(n,l),a=g(a,c)}return Array(i,r,n,a)}function c(t,e,i,r,n,a){return g((o=g(g(e,t),g(r,a)))<<(s=n)|o>>>32-s,i);var o,s}function u(t,e,i,r,n,a,o){return c(e&i|~e&r,t,e,n,a,o)}function f(t,e,i,r,n,a,o){return c(e&r|i&~r,t,e,n,a,o)}function d(t,e,i,r,n,a,o){return c(e^i^r,t,e,n,a,o)}function p(t,e,i,r,n,a,o){return c(i^(e|~r),t,e,n,a,o)}function g(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}t.hex=function(t){return n(r(o(t)))},t.b64=function(t){return a(r(o(t)))}}(md5||(md5={})),function(t){t.resData="4LVSPIK3B203|p|2JS362HMIVJ6|EZ,A,FU,FU||||||;HA8GLOB3BT28|p|2JS362HMIVJ6|KO,CM,HW,DX||||||;1EF948RMIQRD|p|2JS362HMIVJ6|CA,Ha,VD,BG||||||;56UQPADE1Q3L|p|2JS362HMIVJ6|SS,A,FD,DZ|Bb|BM||||;CD2USR5HDCIB|p|2JS362HMIVJ6|KO,A,ID,CL|Ce|c||||;ER7C5K9MCR91|p|2JS362HMIVJ6|SF,Da,FJ,DG|CW|BU||||;674HLN92PH6C|p|2JS362HMIVJ6|A,Cb,EV,DQ|CE|BT||||;STU2ANJ65A4I|p|2JS362HMIVJ6|A,A,EY,Ca|Ba|BC||||;B0LVRU4VENJS|p|2JS362HMIVJ6|JU,GE,HU,BF||||||;U3D0VPUF90K5|p|2JS362HMIVJ6|EW,FV,Ca,CE|EP|De||||;LAO8Q29LE1TO|p|2JS362HMIVJ6|HR,FV,CC,CC||||||;384C1JUD8MIS|p|2JS362HMIVJ6|A,GM,Bf,Bf|CA|CA||A,A,B,B||;Q3IOEMMM9HV3|p|2JS362HMIVJ6|CA,GM,BW,BI||||||;2JS362HMIVJ6|w|BEI5ATEOKD8IRL3K|XW|JB||||;4TR3NPOOD9FC|w|SJZTVNDSHTCSEN0K|CK|CK||||;RGDNTIFOJEJ1|p|3430TB8UBRS5|A,A,JM,KL||KM||A,B,A,A||;85GD560O0A62|p|3430TB8UBRS5|A,KL,Od,BZ||||||;307B8VJHSQ38|p|3430TB8UBRS5|A,ME,KD,BO||||||;O18PU18DTSMO|p|3430TB8UBRS5|JM,A,CF,Bf|||W,Y,X,X|||;3430TB8UBRS5|w|YAR4IF5QCFBT3P0Y|Od|NS||||;F45FD2M7NRMS|p|M33L9BH2LKJ4|A,A,Ja,Kd||||||;EN6PH70VD7LV|p|M33L9BH2LKJ4|Ja,A,MB,HZ||||||;MFP4S2F9MF7F|p|M33L9BH2LKJ4|Vb,A,KF,IM||||||;M3F90V7UJL03|p|M33L9BH2LKJ4|QU,IM,NQ,FI||||||;LMIPDLENLMJG|p|M33L9BH2LKJ4|Ja,HZ,Ga,CV||||||;VCP8LGVCL71S|p|M33L9BH2LKJ4|Ja,KO,Ga,CV||||||;EJRRQ2IU0JS0|p|M33L9BH2LKJ4|A,Kd,HN,BC||||||;M33L9BH2LKJ4|w|33A5CZI9WIQLPWC5|BAA|NU||||;U7VJ9SGIHTNO|p|EB50KH7ATNKU|A,A,KQ,KC||||||;S9IQLHG3U700|p|EB50KH7ATNKU|KR,GF,BY,Bb||||||;52OMU7AEFJE8|p|EB50KH7ATNKU|KR,A,BM,BR||||||;5A1F5RDNRR3D|p|EB50KH7ATNKU|KR,EU,BM,BQ||||||;PI6ME5HEHD40|p|EB50KH7ATNKU|KR,DD,BM,BQ||||||;MR7EA6RAGT5R|p|EB50KH7ATNKU|KR,BS,BM,BQ||||||;UFGMTQLP3H5J|p|EB50KH7ATNKU|KR,IB,BH,BG||||||;CTDCID13AB9F|p|EB50KH7ATNKU|KR,JI,BS,Z|||J,J,K,N|||;G503ILGF8S28|p|EB50KH7ATNKU|Le,BE,e,BD|||I,N,J,P|||;O123T11GLFK9|p|EB50KH7ATNKU|Le,A,e,BD|||I,N,J,P|||;DQ8AU90MGHMI|p|EB50KH7ATNKU|Le,CI,e,e||||||;P637DGG88RRB|p|EB50KH7ATNKU|A,KD,LI,C||||||;SPMG8J9324MB|p|EB50KH7ATNKU|Le,DH,V,Z|||F,G,F,G|||;6VBE1JLANTMV|p|EB50KH7ATNKU|Le,EB,V,Z|||F,G,F,G|||;INH1T34JAHE4|p|EB50KH7ATNKU|MU,DH,I,f|BY|Bb||BE,M,M,Q||;EB50KH7ATNKU|w|CCUH93QNYUMF4OQ7|Md|KG||||;FOTVN4BTL6M7|i|232MAT6ON9HE0IXW.0|KQ|KC||||;JCF2OQOGMT7O|w|DCXNROQW5H6N4QVK|WG|BIA||||;QJ204MMAGROF|i|QJMT8BJ3L8J327XN.0|RB|ZX||||;JCUPEPU1E9EG|i|GN5K3X6THHX5LTIZ.0|BS|BS||||;QVIBRGFQPTT2|i|GZDU6T2E16POLB7A.0|BS|BS||||;4PGJIM7IPCOV|w|GKBV7HI7HJNVC69E|QW|MF||||;1QO2CBOCQIBD|s|JA0G81AQV8EXMINP;UVOHVF14P3C8|s|NK0L2XPG4EDO1XAQ;JS4KKPVSP9K1|s|QMN8L7P4QXAI5M47",t.resGroups=[]}(game||(game={}));var __extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),game;!function(t){function e(t){var e=0,i="2";t&&(e=1,i="1"),ez.setBGMVolume(e),ez.setSFXVolume(e),localStorage.setItem("sound",i)}function i(e){var i=Date.now();ajax(url+"/openapi/pinball/list?pageSize=50",(function(r,n){if(r){ajax(url+"/openapi/statistics/add?openid="+PlayerInfo.openid+"\n\t\t\t\t\t&interfaceName="+encodeURIComponent("")+"\n\t\t\t\t\t&responseTime="+(Date.now()-i),(function(){}));var a=1;t.ranks=n.rows.map((function(t){return t.score||0})),e.namedChilds.rankList.items=n.rows.map((function(t){return{rank:a++,name:t.nickname,avatar:t.avatar,score:t.score||0}}))}}))}t.ranks=[],t.soundEnable=e,t.getRank=i;var r=function(r){function n(n){var a=r.call(this,n)||this,o=a.namedChilds,s=a,h=localStorage.getItem("sound");return null!=h&&"2"!=h||(h="1"),o.sound.state="2"==h?"check":"uncheck",e("1"==h),i(o.rankPage),ez.playMusic(0,"sound/bgm",!0),new ez.Tween(o.stage.stage.find("")).move({x:[38,42],y:[120,108]},1e3).to({x:38,y:120},1e3).config({loop:!0}).play(),new ez.Tween(o.stage.stage.find("")).move({y:[760,770],angle:[-5,6],scale:[.95,1.05]},1200,ez.Ease.sineInOut).to({y:760,angle:-5,scale:.95},1200,ez.Ease.sineInOut).config({loop:!0}).play(),ez.effect.highlight(o.start.namedChilds.bk,new ez.Color(128,100,50),.1,10,1e3,2e3,0,[-.3,1.2]),ez.setTimer(1e3,(function(){s.disposed||ez.effect.highlight(o.help.namedChilds.bk,new ez.Color(50,100,128),.1,10,1e3,2e3,0,[-.3,1.2])})),ez.effect.highlight(o.rank.namedChilds.label,new ez.Color(128,100,50),.3,0,1e3,1500,0,[-.3,1]),a.addEventHandler("click",(function(i){switch(i.sender.id){case"help":o.helpPage.visible=!0,o.mainPage.visible=!1;break;case"okBtn":o.helpPage.visible=!1,o.mainPage.visible=!0;break;case"rank":o.rankPage.visible=!0;break;case"closeRank":o.rankPage.visible=!1;break;case"start":s.parent.createChild(t.GamePage),s.dispose(),window.parent.postMessage({msg:"gamestart"},"*");break;case"sound":e("check"==i.sender.state)}})),a}return __extends(n,r),n}(t._StartPage);t.StartPage=r;var n=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),Object.defineProperty(e.prototype,"dataSource",{set:function(t){var e=this.namedChilds;if(t.rank<=3){e.rankIcon.src="ui/icon/"+["","1st","2nd","3rd"][t.rank]}else e.rankIcon.visible=!1,e.rank.visible=!0,e.rank.text=""+t.rank;e.name.text=t.name,e.avatar.src=t.avatar,e.score.text=t.score+""},enumerable:!1,configurable:!0}),e}(t._RankItem);t.RankItem=n}(game||(game={})),main();